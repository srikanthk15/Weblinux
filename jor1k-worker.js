var requirejs,require,define;!function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(e,t,i,r){return t&&eachProp(t,function(t,s){!i&&hasProp(e,s)||(!r||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[s]=t:(e[s]||(e[s]={}),mixin(e[s],t,i,r)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,r){var s=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return s.requireType=e,s.requireModules=r,i&&(s.originalError=i),s}function newContext(e){function t(e){var t,i;for(t=0;t<e.length;t++)if(i=e[t],"."===i)e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,r){var s,a,n,o,c,h,u,d,f,p,l,b,v=i&&i.split("/"),m=w.map,k=m&&m["*"];if(e&&(e=e.split("/"),u=e.length-1,w.nodeIdCompat&&jsSuffixRegExp.test(e[u])&&(e[u]=e[u].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&v&&(b=v.slice(0,v.length-1),e=b.concat(e)),t(e),e=e.join("/")),r&&m&&(v||k)){n=e.split("/");e:for(o=n.length;o>0;o-=1){if(h=n.slice(0,o).join("/"),v)for(c=v.length;c>0;c-=1)if(a=getOwn(m,v.slice(0,c).join("/")),a&&(a=getOwn(a,h))){d=a,f=o;break e}!p&&k&&getOwn(k,h)&&(p=getOwn(k,h),l=o)}!d&&p&&(d=p,f=l),d&&(n.splice(0,f,d),e=n.join("/"))}return s=getOwn(w.pkgs,e),s?s:e}function r(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===R.contextName)return t.parentNode.removeChild(t),!0})}function s(e){var t=getOwn(w.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),R.require.undef(e),R.makeRequire(null,{skipMap:!0})([e]),!0}function a(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function n(e,t,r,s){var n,o,c,h,u=null,d=t?t.name:null,f=e,p=!0,l="";return e||(p=!1,e="_@r"+(_+=1)),h=a(e),u=h[0],e=h[1],u&&(u=i(u,d,s),o=getOwn(I,u)),e&&(u?l=o&&o.normalize?o.normalize(e,function(e){return i(e,d,s)}):e.indexOf("!")===-1?i(e,d,s):e:(l=i(e,d,s),h=a(l),u=h[0],l=h[1],r=!0,n=R.nameToUrl(l))),c=!u||o||r?"":"_unnormalized"+(C+=1),{prefix:u,name:l,parentMap:t,unnormalized:!!c,url:n,originalName:f,isDefine:p,id:(u?u+"!"+l:l)+c}}function o(e){var t=e.id,i=getOwn(D,t);return i||(i=D[t]=new R.Module(e)),i}function c(e,t,i){var r=e.id,s=getOwn(D,r);!hasProp(I,r)||s&&!s.defineEmitComplete?(s=o(e),s.error&&"error"===t?i(s.error):s.on(t,i)):"defined"===t&&i(I[r])}function h(e,t){var i=e.requireModules,r=!1;t?t(e):(each(i,function(t){var i=getOwn(D,t);i&&(i.error=e,i.events.error&&(r=!0,i.emit("error",e)))}),r||req.onError(e))}function u(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(R.defQueueMap[t]=!0),E.push(e)}),globalDefQueue=[])}function d(e){delete D[e],delete T[e]}function f(e,t,i){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,s){var a=r.id,n=getOwn(D,a);!n||e.depMatched[s]||i[a]||(getOwn(t,a)?(e.defineDep(s,I[a]),e.check()):f(n,t,i))}),i[r]=!0)}function p(){var e,t,i=1e3*w.waitSeconds,a=i&&R.startTime+i<(new Date).getTime(),n=[],o=[],c=!1,u=!0;if(!k){if(k=!0,eachProp(T,function(e){var i=e.map,h=i.id;if(e.enabled&&(i.isDefine||o.push(e),!e.error))if(!e.inited&&a)s(h)?(t=!0,c=!0):(n.push(h),r(h));else if(!e.inited&&e.fetched&&i.isDefine&&(c=!0,!i.prefix))return u=!1}),a&&n.length)return e=makeError("timeout","Load timeout for modules: "+n,null,n),e.contextName=R.contextName,h(e);u&&each(o,function(e){f(e,{},{})}),a&&!t||!c||!isBrowser&&!isWebWorker||S||(S=setTimeout(function(){S=0,p()},50)),k=!1}}function l(e){hasProp(I,e[0])||o(n(e[0],null,!0)).init(e[1],e[2])}function b(e,t,i,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(i,t,!1)}function v(e){var t=e.currentTarget||e.srcElement;return b(t,R.onScriptLoad,"load","onreadystatechange"),b(t,R.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function m(){var e;for(u();E.length;){if(e=E.shift(),null===e[0])return h(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));l(e)}R.defQueueMap={}}var k,g,R,y,S,w={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},D={},T={},x={},E=[],I={},j={},A={},_=1,C=1;return y={require:function(e){return e.require?e.require:e.require=R.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?I[e.map.id]=e.exports:e.exports=I[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(w.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},g=function(e){this.events=getOwn(x,e.id)||{},this.map=e,this.shim=getOwn(w.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},g.prototype={init:function(e,t,i,r){r=r||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,R.startTime=(new Date).getTime();var e=this.map;return this.shim?void R.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;j[e]||(j[e]=!0,R.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,r=this.depExports,s=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){try{s=R.execCb(i,a,r,s)}catch(n){e=n}if(this.map.isDefine&&void 0===s&&(t=this.module,t?s=t.exports:this.usingExports&&(s=this.exports)),e){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",h(this.error=e);"undefined"!=typeof console&&console.error?console.error(e):req.onError(e)}}else s=a;if(this.exports=s,this.map.isDefine&&!this.ignore&&(I[i]=s,req.onResourceLoad)){var o=[];each(this.depMaps,function(e){o.push(e.normalizedMap||e)}),req.onResourceLoad(R,this.map,o)}d(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(R.defQueueMap,i)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,r=n(e.prefix);this.depMaps.push(r),c(r,"defined",bind(this,function(r){var s,a,u,f=getOwn(A,this.map.id),p=this.map.name,l=this.map.parentMap?this.map.parentMap.name:null,b=R.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(r.normalize&&(p=r.normalize(p,function(e){return i(e,l,!0)})||""),a=n(e.prefix+"!"+p,this.map.parentMap),c(a,"defined",bind(this,function(e){this.map.normalizedMap=a,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),u=getOwn(D,a.id),void(u&&(this.depMaps.push(a),this.events.error&&u.on("error",bind(this,function(e){this.emit("error",e)})),u.enable()))):f?(this.map.url=R.nameToUrl(f),void this.load()):(s=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),s.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(D,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&d(e.map.id)}),h(e)}),s.fromText=bind(this,function(i,r){var a=e.name,c=n(a),u=useInteractive;r&&(i=r),u&&(useInteractive=!1),o(c),hasProp(w.config,t)&&(w.config[a]=w.config[t]);try{req.exec(i)}catch(d){return h(makeError("fromtexteval","fromText eval for "+t+" failed: "+d,d,[t]))}u&&(useInteractive=!0),this.depMaps.push(c),R.completeLoad(a),b([a],s)}),void r.load(e.name,b,s,w))})),R.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){T[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,r,s;if("string"==typeof e){if(e=n(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,s=getOwn(y,e.id))return void(this.depExports[t]=s(this));this.depCount+=1,c(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?c(e,"error",bind(this,this.errback)):this.events.error&&c(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,r=D[i],hasProp(y,i)||!r||r.enabled||R.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(D,e.id);t&&!t.enabled&&R.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},R={config:w,contextName:e,registry:D,defined:I,urlFetched:j,defQueue:E,defQueueMap:{},Module:g,makeModuleMap:n,nextTick:req.nextTick,onError:h,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=w.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(w[t]||(w[t]={}),mixin(w[t],e,!0,!0)):w[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(A[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,i){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=R.makeShimExports(e)),t[i]=e}),w.shim=t),e.packages&&each(e.packages,function(e){var t,i;e="string"==typeof e?{name:e}:e,i=e.name,t=e.location,t&&(w.paths[i]=e.location),w.pkgs[i]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(D,function(e,t){e.inited||e.map.unnormalized||(e.map=n(t,null,!0))}),(e.deps||e.callback)&&R.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,s){function a(i,r,c){var u,d,f;return s.enableBuildCallback&&r&&isFunction(r)&&(r.__requireJsBuild=!0),"string"==typeof i?isFunction(r)?h(makeError("requireargs","Invalid require call"),c):t&&hasProp(y,i)?y[i](D[t.id]):req.get?req.get(R,i,t,a):(d=n(i,t,!1,!0),u=d.id,hasProp(I,u)?I[u]:h(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(m(),R.nextTick(function(){m(),f=o(n(null,t)),f.skipMap=s.skipMap,f.init(i,r,c,{enabled:!0}),p()}),a)}return s=s||{},mixin(a,{isBrowser:isBrowser,toUrl:function(e){var r,s=e.lastIndexOf("."),a=e.split("/")[0],n="."===a||".."===a;return s!==-1&&(!n||s>1)&&(r=e.substring(s,e.length),e=e.substring(0,s)),R.nameToUrl(i(e,t&&t.id,!0),r,!0)},defined:function(e){return hasProp(I,n(e,t,!1,!0).id)},specified:function(e){return e=n(e,t,!1,!0).id,hasProp(I,e)||hasProp(D,e)}}),t||(a.undef=function(e){u();var i=n(e,t,!0),s=getOwn(D,e);s.undefed=!0,r(e),delete I[e],delete j[i.url],delete x[e],eachReverse(E,function(t,i){t[0]===e&&E.splice(i,1)}),delete R.defQueueMap[e],s&&(s.events.defined&&(x[e]=s.events),d(e))}),a},enable:function(e){var t=getOwn(D,e.id);t&&o(e).enable()},completeLoad:function(e){var t,i,r,a=getOwn(w.shim,e)||{},n=a.exports;for(u();E.length;){if(i=E.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);l(i)}if(R.defQueueMap={},r=getOwn(D,e),!t&&!hasProp(I,e)&&r&&!r.inited){if(!(!w.enforceDefine||n&&getGlobal(n)))return s(e)?void 0:h(makeError("nodefine","No define call for "+e,null,[e]));l([e,a.deps||[],a.exportsFn])}p()},nameToUrl:function(e,t,i){var r,s,a,n,o,c,h,u=getOwn(w.pkgs,e);if(u&&(e=u),h=getOwn(A,e))return R.nameToUrl(h,t,i);if(req.jsExtRegExp.test(e))o=e+(t||"");else{for(r=w.paths,s=e.split("/"),a=s.length;a>0;a-=1)if(n=s.slice(0,a).join("/"),c=getOwn(r,n)){isArray(c)&&(c=c[0]),s.splice(0,a,c);break}o=s.join("/"),o+=t||(/^data\:|\?/.test(o)||i?"":".js"),o=("/"===o.charAt(0)||o.match(/^[\w\+\.\-]+:/)?"":w.baseUrl)+o}return w.urlArgs?o+((o.indexOf("?")===-1?"?":"&")+w.urlArgs):o},load:function(e,t){req.load(R,e,t)},execCb:function(e,t,i,r){return t.apply(r,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=v(e);R.completeLoad(t.id)}},onScriptError:function(e){var t=v(e);if(!s(t.id)){var i=[];return eachProp(D,function(e,r){0!==r.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id&&i.push(r),!0})}),h(makeError("scripterror",'Script error for "'+t.id+(i.length?'", needed by: '+i.join(", "):'"'),e,[t.id]))}}},R.require=R.makeRequire(),R}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.22",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,r){var s,a,n=defContextName;return isArray(e)||"string"==typeof e||(a=e,isArray(t)?(e=t,t=i,i=r):e=[]),a&&a.context&&(n=a.context),s=getOwn(contexts,n),s||(s=contexts[n]=req.s.newContext(n)),a&&s.configure(a),s.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var r=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return r.type=e.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r},req.load=function(e,t,i){var r,s=e&&e.config||{};if(isBrowser)return r=req.createNode(s,t,i),s.onNodeCreated&&s.onNodeCreated(r,s,t,i),r.setAttribute("data-requirecontext",e.contextName),r.setAttribute("data-requiremodule",t),!r.attachEvent||r.attachEvent.toString&&r.attachEvent.toString().indexOf("[native code")<0||isOpera?(r.addEventListener("load",e.onScriptLoad,!1),r.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,r.attachEvent("onreadystatechange",e.onScriptLoad)),r.src=i,currentlyAddingScript=r,baseElement?head.insertBefore(r,baseElement):head.appendChild(r),currentlyAddingScript=null,r;if(isWebWorker)try{importScripts(i),e.completeLoad(t)}catch(a){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,a,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,i){var r,s;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=null),!t&&isFunction(i)&&(t=[],i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),s=contexts[r.getAttribute("data-requirecontext")])),s?(s.defQueue.push([e,t,i]),s.defQueueMap[e]=!0):globalDefQueue.push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),define("amd-loader",[],function(){var e=function(t,i,r,s){return 3==arguments.length?(s=r,r=void 0):2==arguments.length&&(s=i,i=r=void 0),{buildCache:{},load:function(a,n,o,c){var h=n.toUrl(a);if(c.precompiled instanceof Array){for(var u=0;u<c.precompiled.length;u++)if(h.substr(0,c.precompiled[u].length)==c.precompiled[u])return require([h+"."+t+".js"],o,o.error)}else if(c.precompiled===!0)return require([h+"."+t+".js"],o,o.error);if(i&&"/"!=a.substr(0,1)&&!a.match(/:\/\//)){var d=!1;if(r)for(var u=0;u<r.length;u++)a.substr(a.length-r[u].length-1)=="."+r[u]&&(d=!0);d||(h+="."+i)}var f=this;e.fetch(h,function(e){s(a,e,n,function(e){"string"==typeof e?(c.isBuild&&(f.buildCache[a]=e),o.fromText(e)):o(e)},o.error,c)},o.error)},write:function(e,t,i){var r=this.buildCache[t];r&&i.asModule(e+"!"+t,r)},writeFile:function(e,i,r,s){s.asModule(e+"!"+i,r.toUrl(i+"."+t+".js"),this.buildCache[i])}}};if("undefined"!=typeof window){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],i=function(e){var i=!0,r=/^(\w+:)?\/\/([^\/]+)/.exec(e);"undefined"!=typeof window&&r&&(i=r[2]===window.location.host,r[1]&&(i&=r[1]===window.location.protocol));var s;if("undefined"!=typeof XMLHttpRequest)s=new XMLHttpRequest;else for(var a,n=0;n<3;n+=1){a=t[n];try{s=new ActiveXObject(a)}catch(o){}if(s){t=[a];break}}if(!i)if("undefined"!=typeof XDomainRequest)s=new XDomainRequest;else if(!("withCredentials"in s))throw new Error("getXhr(): Cross Origin XHR not supported.");if(!s)throw new Error("getXhr(): XMLHttpRequest not available");return s};e.fetch=function(e,t,r){var s=i(e);s.open("GET",e,!requirejs.inlineRequire),s.onreadystatechange=function(i){var a,n;if(4===s.readyState)if(a=s.status,a>399&&a<600)n=new Error(e+" HTTP status: "+a),n.xhr=s,r&&r(n);else{if(""==s.responseText)return r(new Error(e+" empty response"));t(s.responseText)}},s.send(null)}}else if("undefined"!=typeof process&&process.versions&&process.versions.node){var r=requirejs.nodeRequire("fs");e.fetch=function(e,t){t(r.readFileSync(e,"utf8"))}}else"undefined"!=typeof Packages?e.fetch=function(e,t,i){var r,s,a="utf-8",n=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),c=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),a)),h="";try{for(r=new java.lang.StringBuffer,s=c.readLine(),s&&s.length()&&65279===s.charAt(0)&&(s=s.substring(1)),r.append(s);null!==(s=c.readLine());)r.append(o),r.append(s);h=String(r.toString())}catch(u){i&&i(u)}finally{c.close()}t(h)}:e.fetch=function(){throw new Error("Environment unsupported.")};return e}),define("cjs",["amd-loader"],function(e){var t=/\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g;return e("cjs","js",function(e,i,r,s,a,n){i=i.replace(t,function(e,t){return"."==t.substr(0,1)?" require('cjs!"+t+"')":" require('"+t+"')"}),s("define(function(require, exports, module) { (function(){var define=undefined;"+i+" \n//# sourceURL="+r.toUrl(e)+"\n})() });")})}),define("cjs!jor1k/worker/messagehandler",["require","exports","module"],function(e,t,i){!function(){function e(e,t){postMessage({command:e,data:t})}function t(t){e("Debug",t)}function r(){throw t("Worker: Abort execution."),"function"==typeof h.PrintOnAbort&&h.PrintOnAbort(),e("Abort",{}),o=!1,new Error("Kill worker")}function s(t){e("Debug","Error: "+t),r()}function a(t){e("Debug","Warning: "+t)}function n(e,t){h[e]=t}var o=!0,c="",h=new Object;onmessage=function(e){if(o){var i=e.data.command;if("function"!=typeof h[i]);else try{h[i](e.data.data)}catch(r){t('Worker: Unhandled exception in command "'+i+'": '+r.message),o=!1}}},n("Abort",function(){o=!1}),n("WorkingPath",function(e){c=e}),i.exports.Register=n,i.exports.Debug=t,i.exports.Error=s,i.exports.Warning=a,i.exports.Abort=r,i.exports.Send=e,i.exports.GetWorkingPath=function(){return c}}()}),define("cjs!jor1k/worker/utils",["require","exports","module"],function(e,t,i){!function(){function e(){return(new Date).getTime()}function t(e){return(255&e)<<24|(65280&e)<<8|e>>>8&65280|e>>>24&255}function r(e){return(255&e)<<8|e>>8&255}function s(e){return e>>0}function a(e){return e>>>0}function n(e){var t=a(e);return"0x"+("00000000"+t.toString(16)).substr(-8).toUpperCase()}function o(e){var t=a(e),i=("00000000000000000000000000000000"+t.toString(2)).substr(-32)+"b";return i.replace(/./g,function(e,t){return 3==(3&t)?e+" ":e})}function c(e,t,i){var r=new XMLHttpRequest;try{r.open("GET",e,!0)}catch(s){return void i(s)}r.responseType="arraybuffer",r.onreadystatechange=function(){if(4==r.readyState){if(200!=r.status&&0!=r.status)return void i("Error: Could not load file "+e);var s=r.response;s?t(s):i("Error: No data received from: "+e)}},r.send(null)}function h(e,t,i,r){var s=new XMLHttpRequest;try{s.open("GET",e,i)}catch(a){return void r(a)}s.responseType="arraybuffer",s.onreadystatechange=function(){if(4==s.readyState){if(200!=s.status&&0!=s.status)return void r("Error: Could not load file "+e);var i=s.response;i?t(i):r("Error: No data received from: "+e)}},s.send(null)}function u(e,t,i){var r=new XMLHttpRequest;console.log("url "+e),r.open("GET",e,!0),r.onreadystatechange=function(){if(4==r.readyState)return 200!=r.status&&0!=r.status?void i("Error: Could not load text file "+e):void t(r.responseText)},r.send(null)}i.exports.GetMilliseconds=e,i.exports.Swap32=t,i.exports.Swap16=r,i.exports.int32=s,i.exports.uint32=a,i.exports.ToHex=n,i.exports.ToBin=o,i.exports.LoadBinaryResource=c,i.exports.LoadBinaryResourceII=h,i.exports.LoadTextResource=u}()}),define("cjs!jor1k/worker/ram",["require","exports","module","cjs!./messagehandler","cjs!./utils"],function(e,t,i){!function(){function t(e,t){this.heap=e,this.int32mem=new Int32Array(this.heap,t),this.uint8mem=new Uint8Array(this.heap,t),this.sint8mem=new Int8Array(this.heap,t),this.devices=new Array(256),this.nativeendian="little",this.Read32Little=this.Read32LittleTemplate,this.Write32Little=this.Write32LittleTemplate,this.Read16Little=this.Read16LittleTemplate,this.Write16Little=this.Write16LittleTemplate,this.Read8Little=this.Read8LittleTemplate,this.Write8Little=this.Write8LittleTemplate,this.Read32=this.Read32LittleTemplate,this.Write32=this.Write32LittleTemplate,this.Read16=this.Read16LittleTemplate,this.Write16=this.Write16LittleTemplate,this.Read8=this.Read8LittleTemplate,this.Write8=this.Write8LittleTemplate,this.Read32Big=this.Read32BigTemplate,this.Write32Big=this.Write32BigTemplate,this.Read16Big=this.Read16BigTemplate,this.Write16Big=this.Write16BigTemplate,this.Read8Big=this.Read8BigTemplate,this.Write8Big=this.Write8BigTemplate}var r=e("cjs!./messagehandler"),s=e("cjs!./utils");t.prototype.AddDevice=function(e,t,i){16777215&t&&(r.Debug("Error: The device address not in the allowed memory region"),r.Abort()),this.devices[t>>24&255]=e},t.prototype.Little2Big=function(e){for(var t=0;t<e>>2;t++)this.int32mem[t]=s.Swap32(this.int32mem[t]);this.Read32=this.Read32BigTemplate,this.Write32=this.Write32BigTemplate,this.Read16=this.Read16BigTemplate,this.Write16=this.Write16BigTemplate,this.Read8=this.Read8BigTemplate,this.Write8=this.Write8BigTemplate,this.Read32Little=function(e){return s.Swap32(this.Read32BigTemplate(e))}.bind(this),this.Write32Little=function(e,t){this.Write32BigTemplate(e,s.Swap32(t))}.bind(this),this.Read16Little=function(e){return s.Swap16(this.Read16BigTemplate(e))}.bind(this),this.Write16Little=function(e,t){this.Write16BigTemplate(e,s.Swap16(t))}.bind(this),this.Read8Little=this.Read8BigTemplate.bind(this),this.Write8Little=this.Write8BigTemplate.bind(this),this.nativeendian="big"},t.prototype.Read32BigTemplate=function(e){return e=0|e,e>=0?(this.int32mem.byteLength<=e&&(r.Debug("Error in Read32Big: read above upper boundary"),r.Abort()),this.int32mem[e>>2]):this.devices[e>>24&255].ReadReg32(16777215&e)},t.prototype.Read32LittleTemplate=function(e){return e=0|e,e<0?(e=2147483648^e,this.int32mem.byteLength<=e&&(r.Debug("Error in Read32Little: read above upper boundary"),r.Abort()),this.int32mem[e>>2]):this.devices[e>>24&255].ReadReg32(16777215&e)},t.prototype.Write32BigTemplate=function(e,t){return e=0|e,e>=0?(this.int32mem.byteLength<=e&&(r.Debug("Error in Write32Big: write above upper boundary"),r.Abort()),void(this.int32mem[e>>2]=0|t)):void this.devices[e>>24&255].WriteReg32(16777215&e,0|t)},t.prototype.Write32LittleTemplate=function(e,t){return e=0|e,e<0?(e=2147483648^e,this.int32mem.byteLength<=e&&(r.Debug("Error in Write32Little: write above upper boundary"),r.Abort()),void(this.int32mem[e>>2]=0|t)):void this.devices[e>>24&255].WriteReg32(16777215&e,0|t)},t.prototype.Read8BigTemplate=function(e){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(r.Debug("Error in Read8Big: read above upper boundary"),r.Abort()),this.uint8mem[3^e]):this.devices[e>>24&255].ReadReg8(16777215&e)},t.prototype.Read8LittleTemplate=function(e){return e=0|e,e<0?(e=2147483648^e,this.uint8mem.byteLength<=e&&(r.Debug("Error in Read8Little: read above upper boundary"),r.Abort()),this.uint8mem[e]):this.devices[e>>24&255].ReadReg8(16777215&e)},t.prototype.Write8BigTemplate=function(e,t){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(r.Debug("Error in Write8Big: write above upper boundary"),r.Abort()),void(this.uint8mem[3^e]=0|t)):void this.devices[e>>24&255].WriteReg8(16777215&e,0|t)},t.prototype.Write8LittleTemplate=function(e,t){return e=0|e,e<0?(e=2147483648^e,this.uint8mem.byteLength<=e&&(r.Debug("Error in Write8Little: write above upper boundary"),r.Abort()),void(this.uint8mem[e]=0|t)):void this.devices[e>>24&255].WriteReg8(16777215&e,0|t)},t.prototype.Read16BigTemplate=function(e){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(r.Debug("Error in Read16Big: read above upper boundary"),r.Abort()),this.uint8mem[(2^e)+1]<<8|this.uint8mem[2^e]):this.devices[e>>24&255].ReadReg16(16777215&e)},t.prototype.Read16LittleTemplate=function(e){return e=0|e,e<0?(e=2147483648^e,this.uint8mem.byteLength<=e&&(r.Debug("Error in Read16Little: read above upper boundary"),r.Abort()),this.uint8mem[e+1]<<8|this.uint8mem[e]):this.devices[e>>24&255].ReadReg16(16777215&e)},t.prototype.Write16BigTemplate=function(e,t){return e=0|e,e>=0?(this.uint8mem.byteLength<=e&&(r.Debug("Error in Write16Big: write above upper boundary"),r.Abort()),this.uint8mem[(2^e)+1]=t>>8&255,void(this.uint8mem[2^e]=255&t)):void this.devices[e>>24&255].WriteReg16(16777215&e,0|t)},t.prototype.Write16LittleTemplate=function(e,t){return e=0|e,e<0?(e=2147483648^e,this.uint8mem.byteLength<=e&&(r.Debug("Error in Write16Little: write above upper boundary"),r.Abort()),this.uint8mem[e+1]=t>>8&255,void(this.uint8mem[e]=255&t)):void this.devices[e>>24&255].WriteReg16(16777215&e,0|t)},i.exports=t}()}),define("cjs!jor1k/worker/bzip2",["require","exports","module","cjs!./messagehandler"],function(e,t,i){!function(){var t=e("cjs!./messagehandler"),r={};r.crcTable=[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188],r.array=function(e){var t=0,i=0,r=[0,1,3,7,15,31,63,127,255];return function(s){for(var a=0;s>0;){var n=8-t;s>=n?(a<<=n,a|=r[n]&e[i++],t=0,s-=n):(a<<=s,a|=(e[i]&r[s]<<8-s-t)>>8-s-t,t+=s,s=0)}return a}},r.IsBZIP2=function(e){return 66==e[0]&&90==e[1]&&104==e[2]},r.simple=function(e,t){var i=r.array(e),s=r.header(i),a=!1,n=1e5*s,o=new Int32Array(n);this.byteCount=new Int32Array(256),this.symToByte=new Uint8Array(256),this.mtfSymbol=new Int32Array(256),this.selectors=new Uint8Array(32768);do a=r.decompress(i,t,o,n);while(!a)},r.header=function(e){4348520!=e(24)&&t.Error("No magic number found");var i=e(8)-48;return(i<1||i>9)&&t.Error("Not a BZIP archive"),i},r.decompress=function(e,i,r,s){for(var a=20,n=258,o=0,c=1,h=50,u=-1,d="",f=0;f<6;f++)d+=e(8).toString(16);if("177245385090"==d)return!0;"314159265359"!=d&&t.Error("eek not valid bzip data");var p=0|e(32);e(1)&&t.Error("unsupported obsolete version");var l=e(24);l>s&&t.Error("Initial position larger than buffer size");var b=e(16),v=0;for(f=0;f<16;f++)if(b&1<<15-f){
var m=e(16);for(R=0;R<16;R++)m&1<<15-R&&(this.symToByte[v++]=16*f+R)}var k=e(3);(k<2||k>6)&&t.Error("another error");var g=e(15);0==g&&t.Error("meh");for(var f=0;f<k;f++)this.mtfSymbol[f]=f;for(var f=0;f<g;f++){for(var R=0;e(1);R++)R>=k&&t.Error("whoops another error");for(var y=this.mtfSymbol[R],m=R-1;m>=0;m--)this.mtfSymbol[m+1]=this.mtfSymbol[m];this.mtfSymbol[0]=y,this.selectors[f]=y}for(var S,w=v+2,D=[],T=new Uint8Array(n),x=new Uint8Array(a+1),R=0;R<k;R++){b=e(5);for(var f=0;f<w;f++){for(;;){if((b<1||b>a)&&t.Error("I gave up a while ago on writing error messages"),!e(1))break;e(1)?b--:b++}T[f]=b}var E,I;E=I=T[0];for(var f=1;f<w;f++)T[f]>I?I=T[f]:T[f]<E&&(E=T[f]);S=D[R]={},S.permute=new Int32Array(n),S.limit=new Int32Array(a+1),S.base=new Int32Array(a+1),S.minLen=E,S.maxLen=I;for(var j=S.base.subarray(1),A=S.limit.subarray(1),_=0,f=E;f<=I;f++)for(var b=0;b<w;b++)T[b]==f&&(S.permute[_++]=b);for(f=E;f<=I;f++)x[f]=A[f]=0;for(f=0;f<w;f++)x[T[f]]++;for(_=b=0,f=E;f<I;f++)_+=x[f],A[f]=_-1,_<<=1,j[f+1]=_-(b+=x[f]);A[I]=_+x[I]-1,j[E]=0}for(var f=0;f<256;f++)this.mtfSymbol[f]=f,this.byteCount[f]=0;var C,M,w,L;for(C=M=w=L=0;;){for(w--||(w=h-1,L>=g&&t.Error("meow i'm a kitty, that's an error"),S=D[this.selectors[L++]],j=S.base.subarray(1),A=S.limit.subarray(1)),f=S.minLen,R=e(f);;){if(f>S.maxLen&&t.Error("rawr i'm a dinosaur"),R<=A[f])break;f++,R=R<<1|e(1)}R-=j[f],(R<0||R>=n)&&t.Error("moo i'm a cow");var q=S.permute[R];if(q!=o&&q!=c){if(C)for(C=0,M+b>=s&&t.Error("Boom."),y=this.symToByte[this.mtfSymbol[0]],this.byteCount[y]+=b;b--;)r[M++]=y;if(q>v)break;M>=s&&t.Error("I can't think of anything. Error"),f=q-1,y=this.mtfSymbol[f];for(var m=f-1;m>=0;m--)this.mtfSymbol[m+1]=this.mtfSymbol[m];this.mtfSymbol[0]=y,y=this.symToByte[y],this.byteCount[y]++,r[M++]=y}else C||(C=1,b=0),b+=q==o?C:2*C,C<<=1}(l<0||l>=M)&&t.Error("I'm a monkey and I'm throwing something at someone, namely you");for(var R=0,f=0;f<256;f++)m=R+this.byteCount[f],this.byteCount[f]=R,R=m;for(var f=0;f<M;f++)y=255&r[f],r[this.byteCount[y]]|=f<<8,this.byteCount[y]++;var U=0,F=0,P=0;M&&(U=r[l],F=255&U,U>>=8,P=-1),M=M;for(var B,W,H;M;){for(M--,W=F,U=r[U],F=255&U,U>>=8,3==P++?(B=F,H=W,F=-1):(B=1,H=F);B--;)u=4294967295&(u<<8^this.crcTable[255&(u>>24^H)]),i(H);F!=W&&(P=0)}return u=(u^-1)>>>0,(0|u)!=(0|p)&&t.Error("Error in bzip2: crc32 do not match"),!1},i.exports=r}()}),define("cjs!jor1k/lib/utf8",["require","exports","module"],function(e,t,i){!function(){function e(){this.stream=new Uint8Array(5),this.ofs=0,this.Put=function(e){switch(this.stream[this.ofs]=e,this.ofs++,this.ofs){case 1:if(this.stream[0]<128)return this.ofs=0,this.stream[0];break;case 2:if(192==(224&this.stream[0])&&128==(192&this.stream[1]))return this.ofs=0,(31&this.stream[0])<<6|(63&this.stream[1])<<0;break;case 3:if(224==(240&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2]))return this.ofs=0,(15&this.stream[0])<<12|(63&this.stream[1])<<6|(63&this.stream[2])<<0;break;case 4:return 240==(248&this.stream[0])&&128==(192&this.stream[1])&&128==(192&this.stream[2])&&128==(192&this.stream[3])?(this.ofs=0,(7&this.stream[0])<<18|(63&this.stream[1])<<12|(63&this.stream[2])<<6|(63&this.stream[3])<<0):(this.ofs=0,-1);default:return this.ofs=0,-1}return-1}}function t(e){return e=0|e,e<128?[e]:e<=2047?[e>>6|192,63&e|128]:e<=65535?[e>>12|224,e>>6&63|128,63&e|128]:e<=1114111?[e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128]:[]}function r(e){for(var t=0,i=0;i<e.length;i++){var r=e.charCodeAt(i);r<128?t+=1:r<=2047?t+=2:r<=65535?t+=3:r<=1114111&&(t+=4)}return t}i.exports.UTF8StreamToUnicode=e,i.exports.UTF8Length=r,i.exports.UnicodeToUTF8Stream=t}()}),define("cjs!jor1k/worker/dev/virtio/marshall",["require","exports","module","cjs!../../../lib/utf8","cjs!../../messagehandler"],function(e,t,i){!function(){function t(e,i,r,s){for(var o,c=0,h=0;h<e.length;h++)switch(o=i[h],e[h]){case"w":r[s++]=255&o,r[s++]=o>>8&255,r[s++]=o>>16&255,r[s++]=o>>24&255,c+=4;break;case"d":r[s++]=255&o,r[s++]=o>>8&255,r[s++]=o>>16&255,r[s++]=o>>24&255,r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0,c+=8;break;case"h":r[s++]=255&o,r[s++]=o>>8,c+=2;break;case"b":r[s++]=o,c+=1;break;case"s":var u=s,d=0;r[s++]=0,r[s++]=0,c+=2;for(var f in o){var p=a.UnicodeToUTF8Stream(o.charCodeAt(f));p.forEach(function(e){r[s++]=e,c+=1,d++})}r[u+0]=255&d,r[u+1]=d>>8&255;break;case"Q":t(["b","w","d"],[o.type,o.version,o.path],r,s),s+=13,c+=13;break;default:n.Debug("Marshall: Unknown type="+type[h])}return c}function r(e,t,i){for(var r=[],s=0;s<e.length;s++)switch(e[s]){case"w":var o=t[i++];o+=t[i++]<<8,o+=t[i++]<<16,o+=t[i++]<<24>>>0,r.push(o);break;case"d":var o=t[i++];o+=t[i++]<<8,o+=t[i++]<<16,o+=t[i++]<<24>>>0,i+=4,r.push(o);break;case"h":var o=t[i++];r.push(o+(t[i++]<<8));break;case"b":r.push(t[i++]);break;case"s":var c=t[i++];c+=t[i++]<<8;for(var h="",u=new a.UTF8StreamToUnicode,d=0;d<c;d++){var f=u.Put(t[i++]);f!=-1&&(h+=String.fromCharCode(f))}r.push(h);break;default:n.Debug("Error in Unmarshall: Unknown type="+e[s])}return r}function s(e,t){for(var i=[],r=0;r<e.length;r++)switch(e[r]){case"w":var s=t();s+=t()<<8,s+=t()<<16,s+=t()<<24>>>0,i.push(s);break;case"d":var s=t();s+=t()<<8,s+=t()<<16,s+=t()<<24>>>0,t(),t(),t(),t(),i.push(s);break;case"h":var s=t();i.push(s+(t()<<8));break;case"b":i.push(t());break;case"s":var o=t();o+=t()<<8;for(var c="",h=new a.UTF8StreamToUnicode,u=0;u<o;u++){var d=h.Put(t());d!=-1&&(c+=String.fromCharCode(d))}i.push(c);break;default:n.Debug("Error in Unmarshall2: Unknown type="+e[r])}return i}var a=e("cjs!../../../lib/utf8"),n=e("cjs!../../messagehandler");i.exports.Marshall=t,i.exports.Unmarshall=r,i.exports.Unmarshall2=s}()}),define("cjs!jor1k/worker/elf",["require","exports","module","cjs!./messagehandler","cjs!./utils","cjs!./dev/virtio/marshall"],function(e,t,i){!function(){var t=e("cjs!./messagehandler"),r=(e("cjs!./utils"),e("cjs!./dev/virtio/marshall")),s={};s.IsELF=function(e){return 127==e[0]&&69==e[1]&&76==e[2]&&70==e[3]},s.Extract=function(e,i){var s=0,a=[];a=r.Unmarshall(["w","b","b","b","b"],e,s);var n=a[1];1!=n&&(t.Debug("Error reading elf binary: 64-Bit not supported"),t.Abort()),s=16,a=r.Unmarshall(["h","h","w","w","w","w"],e,s);var o=(a[3],a[4]),c=a[5];s=40,a=r.Unmarshall(["h","h","h"],e,s);var h=(a[0],a[1]),u=a[2];s=46,a=r.Unmarshall(["h","h","h"],e,s);for(var d=a[0],f=a[1],p=(a[2],[]),l=0;l<u;l++){s=o+l*h,a=r.Unmarshall(["w","w","w","w","w","w","w","w"],e,s);var b={};b.type=a[0],b.offset=a[1],b.vaddr=a[2],b.paddr=a[3],b.filesz=a[4],b.memsz=a[5],b.flags=a[6],b.align=a[7],p.push(b)}for(var v=[],l=0;l<f;l++){s=c+l*d,a=r.Unmarshall(["w","w","w","w","w","w"],e,s);var b={};b.name=a[0],b.type=a[1],b.flags=a[2],b.addr=a[3],b.offset=a[4],b.size=a[5],v.push(b)}for(var l=0;l<p.length;l++)if(1==p[l].type&&0!=p[l].memsz){if(p[l].filesz>0)for(var m=0;m<p[l].filesz;m++)i.Write8(p[l].paddr+m,e[p[l].offset+m]);for(var m=0;m<p[l].memsz-p[l].filesz;m++)i.Write8(p[l].paddr+p[l].filesz+m,0)}},i.exports=s}()}),define("cjs!jor1k/worker/timer",["require","exports","module","cjs!./messagehandler","cjs!./utils"],function(e,t,i){!function(){function t(e,t){this.ticksperms=e,this.loopspersecond=t,this.baserealtime=0,this.realtime=0,this.lastsystemticks=0,this.systemtime=0,this.correction=1,this.oldcorrection=1,this.steps=0,this.nins=0,this.lastlooptime=-1,this.ipms=1e4,this.instructionsperloop=0,this.timercyclesperinstruction=10,this.UpdateTimings()}var r=(e("cjs!./messagehandler"),e("cjs!./utils"));t.prototype.Update=function(e,t,i){this.GlobalUpdate(t),this.LocalUpdate(e,i)},t.prototype.UpdateTimings=function(e,t){this.instructionsperloop=Math.floor(1e3*this.ipms/this.loopspersecond),this.instructionsperloop=this.instructionsperloop<2e3?2e3:this.instructionsperloop,this.instructionsperloop=this.instructionsperloop>1e8?1e8:this.instructionsperloop,this.timercyclesperinstruction=Math.floor(64*this.ticksperms/this.ipms*this.correction),this.timercyclesperinstruction=this.timercyclesperinstruction<=1?1:this.timercyclesperinstruction,this.timercyclesperinstruction=this.timercyclesperinstruction>=1e3?1e3:this.timercyclesperinstruction},t.prototype.LocalUpdate=function(e,t){if(this.nins+=e,t)return this.lastlooptime=-1,void(this.nins=0);if(this.lastlooptime<0)return this.lastlooptime=r.GetMilliseconds(),void(this.nins=0);var i=r.GetMilliseconds()-this.lastlooptime;i>50&&this.nins>2e3&&(this.ipms=this.nins/i,this.UpdateTimings(),this.lastlooptime=r.GetMilliseconds(),this.nins=0)},t.prototype.GlobalUpdate=function(e){if(!(e<0)){e/=this.ticksperms,this.baserealtime<=0&&(this.baserealtime=r.GetMilliseconds()),this.realtime=r.GetMilliseconds()-this.baserealtime,this.lastsystemticks>e?this.systemtime+=e-this.lastsystemticks+268435456/this.ticksperms:this.systemtime+=e-this.lastsystemticks,this.lastsystemticks=e;var t=Math.abs(this.systemtime-this.realtime);t>500&&(this.baserealtime=r.GetMilliseconds(),this.systemtime=0,this.lastsystemticks=0),this.correction=1,this.systemtime>this.realtime+50&&(this.correction=.9),this.realtime>this.systemtime+50&&(this.correction=1.1),t>200&&(this.correction=this.correction*this.correction),t>400&&(this.correction=this.correction*this.correction),this.oldcorrection!=this.correction&&(this.UpdateTimings(),this.oldcorrection=this.correction)}},i.exports=t}()}),define("cjs!jor1k/worker/imul",["require","exports","module"],function(e,t,i){!function(){i.exports=Math.imul||function(e,t){var i=e>>>16&65535,r=65535&e,s=t>>>16&65535,a=65535&t;return r*a+(i*a+r*s<<16>>>0)|0}}()}),define("cjs!jor1k/worker/or1k/fastcpu",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e,t,i){"use asm";var r=e.Math.floor;var s=t.imul;var a=t.DebugMessage;var n=t.abort;var o=t.Read32;var c=t.Write32;var h=t.Read16;var u=t.Write16;var d=t.Read8;var f=t.Write8;var p=0;var l=1;var b=2;var v=3;var m=4;var k=5;var g=6;var R=7;var y=8;var S=1;var w=17;var D=48;var T=32;var x=64;var E=4;var I=3;var j=6;var A=5;var _=0;var C=0xA00;var M=0x400;var L=0x100;var q=0x900;var U=0x300;var F=0x200;var P=0x500;var B=0x800;var W=0xC00;var H=0xE00;var O=new e.Int32Array(i);var z=new e.Float32Array(i);var G=new e.Int32Array(i);var N=new e.Uint8Array(i);var V=new e.Uint16Array(i);var X=0x0;var Q=0x100000;var K=0x2000;var Y=0x4000;var J=0x6000;var Z=0x0;var $=0;var ee=0;var te=-4;var ie=0;var re=0;var se=0x0;var ae=0x0;var ne=0;var oe=-1;var ce=-1;var he=-1;var ue=-1;var de=-1;var fe=-1;var pe=-1;var le=-1;var be=-1;var ve=-1;var me=-1;var ke=-1;var ge=-1;var Re=-1;var ye=-1;var Se=-1;var we=-1;var De=-1;var Te=-1;var xe=0x0;var Ee=0x0;var Ie=0x3;var je=0x0;var Ae=1;var _e=0;var Ce=0;var Me=0;var Le=0;var qe=0;var Ue=0;var Fe=0;var Pe=0;var Be=0;var We=0;var He=0;var Oe=0;var ze=0;var Ge=0;var Ne=1;var Ve=0;var Xe=0x0;var Qe=0x0;var Ke=0x0;var Ye=0x0;var Je=0;var Ze=0x0;function $e(){nt();et()}function et(){xe=0x0;Ee=0x0;Ie=0x3;je=0x0;G[K+(E<<2)>>2]=0x18;G[K+(I<<2)>>2]=0x18;G[K+(j<<2)>>2]=0x48;G[K+(A<<2)>>2]=0x48;G[K+(_<<2)>>2]=0x12000001;G[K+(S<<2)>>2]=0x619;$=0;ee=0;te=-4;lt(L,0x0)}function tt(){oe=-1;ce=-1;he=-1;ue=-1;de=-1;fe=-1;pe=-1;le=-1;be=-1;ve=-1;me=-1;ke=-1;ge=-1;Re=-1;ye=-1;Se=-1;we=-1;De=-1}function it(){return Z>>>2|0}function rt(){var e=0x0;if(xe>>30==0)return-1;e=(xe&0xFFFFFFF)-(Ee&0xFFFFFFF)|0;return e|0}function st(e){e=e|0;Ee=Ee+e|0}function at(){if(xe>>30==0)return-1;return Ee&0xFFFFFFF|0}function nt(){Qe=G[Q+0x900>>2]|0;Ke=G[Q+0xA00>>2]|0;Ye=(G[Q+0x2010>>2]&0xFFF)<<16|G[Q+0x2014>>2]&0xFFFF|0}function ot(e){e=e|0;Ae=e&1<<0;_e=e&1<<1;Ce=e&1<<2;Me=e&1<<3;Le=e&1<<4;qe=e&1<<5;Ue=e&1<<6;Fe=e&1<<7;Pe=e&1<<8;Be=e&1<<9;We=e&1<<10;He=e&1<<11;Oe=e&1<<12;ze=e&1<<13;Ge=e&1<<14;Ne=1;Ve=e&1<<16;Xe=e>>28&0xF;if(Fe){a(p|0);n()}if(Xe){a(l|0);n()}if(Ge){a(b|0);n()}if(ze){a(v|0);n()}}function ct(){var e=0x0;e=e|(Ae?1<<0:0);e=e|(_e?1<<1:0);e=e|(Ce?1<<2:0);e=e|(Me?1<<3:0);e=e|(Le?1<<4:0);e=e|(qe?1<<5:0);e=e|(Ue?1<<6:0);e=e|(Fe?1<<7:0);e=e|(Pe?1<<8:0);e=e|(Be?1<<9:0);e=e|(We?1<<10:0);e=e|(He?1<<11:0);e=e|(Oe?1<<12:0);e=e|(ze?1<<13:0);e=e|(Ge?1<<14:0);e=e|(Ne?1<<15:0);e=e|(Ve?1<<16:0);e=e|Xe<<28;return e|0}function ht(){Je=Ie&je}function ut(e,t){e=e|0;t=t|0;var i=0;i=1<<e|0;je=je|i;ht()}function dt(e,t){e=e|0;t=t|0;je=je&~(1<<e);Je=Ie&je}function ft(e,t){e=e|0;t=t|0;var i=0;var r=0;i=e&0x7FF;r=e>>11&0x1F;switch(r|0){case 0:if((i|0)==(w|0)){ot(t)}G[K+(i<<2)>>2]=t;break;case 1:G[Y+(i<<2)>>2]=t;break;case 2:G[J+(i<<2)>>2]=t;break;case 3:case 4:break;case 8:Ze=0x1;break;case 9:switch(i|0){case 0:Ie=t|0x3;ht();if(Ce){if(Je){a(m|0);n()}}break;case 2:break;default:a(k|0);n()}break;case 10:switch(i|0){case 0:xe=t|0;if((xe>>30&3)!=0x3){a(g|0);n()}break;case 1:Ee=t|0;break;default:a(y|0);n();break}break;default:a(y|0);n();break}}function pt(e){e=e|0;var t=0;var i=0;t=e&0x7FF;i=e>>11&0x1F;switch(i|0){case 0:if((t|0)==(w|0)){return ct()|0}return G[K+(t<<2)>>2]|0;case 1:return G[Y+(t<<2)>>2]|0;case 2:return G[J+(t<<2)>>2]|0;case 8:return 0x0;case 9:switch(t|0){case 0:return Ie|0;case 2:return je|0;default:a(y|0);n();break}break;case 10:switch(t|0){case 0:return xe|0;case 1:return Ee|0;default:a(y|0);n();break}break;default:a(y|0);n();break}return 0|0}function lt(e,t){e=e|0;t=t|0;var i=0;i=e|(Ge?0xf0000000:0x0);ft(D,t);ft(x,ct()|0);Te=-1;Oe=0;Ae=1;Ce=0;_e=0;qe=0;oe=0;ce=0;he=0;ue=0;de=0;fe=0;pe=0;le=0;be=0;ve=0;me=0;ge=0;ke=0;ye=0;Re=0;Se=0;we=0;De=0;ie=$|0;se=i;switch(e|0){case 0x100:break;case 0x300:case 0x900:case 0xE00:case 0x200:Z=te+$|0;ft(T,Z-(re?4:0)|0);break;case 0xA00:case 0x400:case 0x500:case 0x800:ft(T,Z-(re?4:0)|0);break;case 0xC00:Z=te+$|0;ft(T,Z+4-(re?4:0)|0);break;default:a(R|0);n()}re=0;ne=0;Ue=0}function bt(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;var a=0;if((G[Q+0x900>>2]|0)==(Qe|0)){lt(q,e);return 0|0}i=e;r=G[Q+Ye>>2]|0;s=i>>>0x18<<2;a=s+r|0;s=0x40000000+a&0xFFFFFFFF;r=G[Q+s>>2]|0;if((r|0)==0){lt(U,e);return 0|0}r=0xffffe000;s=G[Q+s>>2]|0;s=s&r;a=i>>>0xD;r=a&0x7FF;r=r<<0x2;r=r+s|0;i=G[Q+r>>2]|0;if((i&1)==0){lt(U,e);return 0|0}s=i&0xFFFFe3fa;a=a&t-1;G[Y+((0x280|a)<<2)>>2]=s;i=e;s=i&0xFFFFE000;s=s|0x1;G[Y+((0x200|a)<<2)>>2]=s;return 1|0}function vt(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;var a=0;if((G[Q+0xA00>>2]|0)==(Ke|0)){lt(C,e);return 0|0}i=e;r=G[Q+Ye>>2]|0;s=i>>>0x18<<2;a=s+r|0;s=0x40000000+a&0xFFFFFFFF;r=G[Q+s>>2]|0;if((r|0)==0){lt(M,e);return 0|0}r=0xffffe000;s=G[Q+s>>2]|0;s=s&r;a=i>>>0xD;r=a&0x7FF;r=r<<0x2;r=r+s|0;i=G[Q+r>>2]|0;if((i&1)==0){lt(M,e);return 0|0}s=i&0xFFFFe03a;r=i&0x7c0;if((r|0)!=0x0){a=a&t-1;s=s|0xc0}G[J+((0x280|a)<<2)>>2]=s;i=e;s=i&0xFFFFE000;s=s|0x1;G[J+((0x200|a)<<2)>>2]=s;return 1|0}function mt(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;if(!qe){return e|0}i=e>>13&63;r=G[Y+((0x200|i)<<2)>>2]|0;if((r&1)==0){if(bt(e,64)|0){r=G[Y+(0x200+i<<2)>>2]|0}else{return-1|0}}if(r>>19!=e>>19){if(bt(e,64)|0){r=G[Y+(0x200+i<<2)>>2]|0}else{return-1|0}}s=G[Y+((0x280|i)<<2)>>2]|0;if(Ae){if(!t){if(!(s&0x100)){lt(U,e);return-1|0}}else{if(!(s&0x200)){lt(U,e);return-1|0}}}else{if(!t){if(!(s&0x40)){lt(U,e);return-1|0}}else{if(!(s&0x80)){lt(U,e);return-1|0}}}return s&0xFFFFE000|e&0x1FFF|0}function kt(e,t){e=e|0;t=t|0;var i=0x0;var p=0x0;var l=0;var b=0x0;var v=0x0,m=0x0,k=0x0;var g=0x0;var R=0x0;var S=0x0;var w=0x0;var E=0x0;var I=0x0;var j=-1;for(;;){if(($|0)!=(ie|0)){i=G[$>>2]|0;$=$+4|0;switch(i>>26&0x3F){case 0x0:Z=te+$|0;ae=Z+(i<<6>>4)|0;if((ie|0)==($|0)){ne=1}else{ie=$+4|0;se=ae|0}re=1;continue;case 0x1:Z=te+$|0;ae=Z+(i<<6>>4)|0;O[9]=Z+8|0;if((ie|0)==($|0)){ne=1}else{ie=$+4|0;se=ae|0}re=1;continue;case 0x3:if(Be){continue}Z=te+$|0;ae=Z+(i<<6>>4)|0;if((ie|0)==($|0)){ne=1}else{ie=$+4|0;se=ae|0}re=1;continue;case 0x4:if(!Be){continue}Z=te+$|0;ae=Z+(i<<6>>4)|0;if((ie|0)==($|0)){ne=1}else{ie=$+4|0;se=ae|0}re=1;continue;case 0x5:continue;case 0x6:b=i>>21&0x1F;O[b<<2>>2]=(i&0xFFFF)<<16;continue;case 0x8:if((i&0xFFFF0000)==0x21000000){lt(H,G[K+D>>2]|0)}else{lt(W,G[K+D>>2]|0)}continue;case 0x9:ae=pt(T)|0;tt();ie=$;se=ae;ot(pt(x)|0);continue;case 0x11:ae=O[(i>>9&0x7C)>>2]|0;if((ie|0)==($|0)){ne=1}else{ie=$+4|0;se=ae|0}re=1;continue;case 0x12:Z=te+$|0;ae=O[(i>>9&0x7C)>>2]|0;O[9]=Z+8|0;if((ie|0)==($|0)){ne=1}else{ie=$+4|0;se=ae|0}re=1;continue;case 0x1B:g=(O[(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((me^g)>>13){R=mt(g,0)|0;if((R|0)==-1){break}me=g;ce=(R^g)>>13<<13}R=ce^g;Te=R;O[(i>>19&0x7C)>>2]=(R|0)>0?G[Q+R>>2]|0:o(R|0)|0;continue;case 0x21:g=(O[(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((me^g)>>13){R=mt(g,0)|0;if((R|0)==-1){break}me=g;ce=(R^g)>>13<<13}R=ce^g;O[(i>>19&0x7C)>>2]=(R|0)>0?G[Q+R>>2]|0:o(R|0)|0;continue;case 0x23:g=(O[(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((ge^g)>>13){R=mt(g,0)|0;if((R|0)==-1){break}ge=g;ue=(R^g)>>13<<13}R=ue^g;if((R|0)>=0){O[(i>>19&0x7C)>>2]=N[Q+(R^3)|0]|0}else{O[(i>>19&0x7C)>>2]=d(R|0)|0}continue;case 0x24:g=(O[(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((ke^g)>>13){R=mt(g,0)|0;if((R|0)==-1){break}ke=g;he=(R^g)>>13<<13}R=he^g;if((R|0)>=0){O[(i>>19&0x7C)>>2]=N[Q+(R^3)|0]<<24>>24}else{O[(i>>19&0x7C)>>2]=(d(R|0)|0)<<24>>24}continue;case 0x25:g=(O[(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((ye^g)>>13){R=mt(g,0)|0;if((R|0)==-1){break}ye=g;fe=(R^g)>>13<<13}R=fe^g;if((R|0)>=0){O[(i>>19&0x7C)>>2]=V[Q+(R^2)>>1]}else{O[(i>>19&0x7C)>>2]=h(R|0)|0}continue;case 0x26:g=(O[(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((Re^g)>>13){R=mt(g,0)|0;if((R|0)==-1){break}Re=g;de=(R^g)>>13<<13}R=de^g;if((R|0)>=0){O[(i>>19&0x7C)>>2]=V[Q+(R^2)>>1]<<16>>16}else{O[(i>>19&0x7C)>>2]=(h(R|0)|0)<<16>>16}continue;case 0x27:v=O[(i>>14&0x7C)>>2]|0;b=i>>19&0x7C;O[b>>2]=v+(i<<16>>16)|0;We=O[b>>2]>>>0<v>>>0;continue;case 0x28:v=O[(i>>14&0x7C)>>2]|0;b=i>>19&0x7C;O[b>>2]=(v+(i<<16>>16)|0)+(We?1:0)|0;if(We){We=O[b>>2]>>>0<=v>>>0}else{We=O[b>>2]>>>0<v>>>0}continue;case 0x29:O[(i>>19&0x7C)>>2]=O[(i>>14&0x7C)>>2]&(i&0xFFFF);continue;case 0x2A:O[(i>>19&0x7C)>>2]=O[(i>>14&0x7C)>>2]|i&0xFFFF;continue;case 0x2B:v=O[(i>>14&0x7C)>>2]|0;O[(i>>19&0x7C)>>2]=v^i<<16>>16;continue;case 0x2C:v=O[(i>>14&0x7C)>>2]|0;O[(i>>19&0x7C)>>2]=s(v|0,i<<16>>16)|0;break;case 0x2D:O[(i>>19&0x7C)>>2]=pt(O[(i>>14&0x7C)>>2]|i&0xFFFF)|0;continue;case 0x2E:switch(i>>6&0x3){case 0:O[(i>>19&0x7C)>>2]=O[(i>>14&0x7C)>>2]<<(i&0x1F);continue;case 1:O[(i>>19&0x7C)>>2]=O[(i>>14&0x7C)>>2]>>>(i&0x1F);continue;case 2:O[(i>>19&0x7C)>>2]=O[(i>>14&0x7C)>>2]>>(i&0x1F);continue;default:a(y|0);n();break}break;case 0x2F:p=i<<16>>16;switch(i>>21&0x1F){case 0x0:Be=(O[(i>>14&0x7C)>>2]|0)==(p|0);continue;case 0x1:Be=(O[(i>>14&0x7C)>>2]|0)!=(p|0);continue;case 0x2:Be=O[(i>>14&0x7C)>>2]>>>0>p>>>0;continue;case 0x3:Be=O[(i>>14&0x7C)>>2]>>>0>=p>>>0;continue;case 0x4:Be=O[(i>>14&0x7C)>>2]>>>0<p>>>0;continue;case 0x5:Be=O[(i>>14&0x7C)>>2]>>>0<=p>>>0;continue;case 0xa:Be=(O[(i>>14&0x7C)>>2]|0)>(p|0);continue;case 0xb:Be=(O[(i>>14&0x7C)>>2]|0)>=(p|0);continue;case 0xc:Be=(O[(i>>14&0x7C)>>2]|0)<(p|0);continue;case 0xd:Be=(O[(i>>14&0x7C)>>2]|0)<=(p|0);continue;default:a(y|0);n();break}break;case 0x30:p=i&0x7FF|i>>10&0xF800;ft(O[(i>>14&0x7C)>>2]|p,O[(i>>9&0x7C)>>2]|0);if(Ze|0){Ze=0x0;if(xe&1<<28)if(_e|0){lt(P,G[K+(D<<2)>>2]|0);continue}if(Ce|0)if(Je|0){lt(B,G[K+(D<<2)>>2]|0);continue}return e|0}continue;case 0x32:v=i>>14&0x7C;m=i>>9&0x7C;k=i>>19&0x7C;switch(i&0xFF){case 0x0:z[k>>2]=+z[v>>2]+ +z[m>>2];continue;case 0x1:z[k>>2]=+z[v>>2]-+z[m>>2];continue;case 0x2:z[k>>2]=+z[v>>2]*+z[m>>2];continue;case 0x3:z[k>>2]=+z[v>>2]/+z[m>>2];continue;case 0x4:z[k>>2]=+(O[v>>2]|0);continue;case 0x5:O[k>>2]=~~+r(+z[v>>2]);continue;case 0x7:z[k>>2]=+z[k>>2]+ +z[v>>2]*+z[m>>2];continue;case 0x8:Be=+z[v>>2]==+z[m>>2];continue;case 0x9:Be=+z[v>>2]!=+z[m>>2];continue;case 0xa:Be=+z[v>>2]>+z[m>>2];continue;case 0xb:Be=+z[v>>2]>=+z[m>>2];continue;case 0xc:Be=+z[v>>2]<+z[m>>2];continue;case 0xd:Be=+z[v>>2]<=+z[m>>2];continue;default:a(y|0);n();break}break;case 0x33:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(O[(i>>14&0x7C)>>2]|0)+p|0;if((Se^g)>>13){R=mt(g,1)|0;if((R|0)==-1){break}Se=g;pe=(R^g)>>13<<13}R=pe^g;Be=(R|0)==(Te|0)?1|0:0|0;Te=-1;if((Be|0)==0){break}if((R|0)>0){G[Q+R>>2]=O[(i>>9&0x7C)>>2]|0}else{c(R|0,O[(i>>9&0x7C)>>2]|0)}continue;case 0x35:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(O[(i>>14&0x7C)>>2]|0)+p|0;if((Se^g)>>13){R=mt(g,1)|0;if((R|0)==-1){break}Se=g;pe=(R^g)>>13<<13}R=pe^g;if((R|0)>0){G[Q+R>>2]=O[(i>>9&0x7C)>>2]|0}else{c(R|0,O[(i>>9&0x7C)>>2]|0)}continue;case 0x36:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(O[(i>>14&0x7C)>>2]|0)+p|0;if((we^g)>>13){R=mt(g,1)|0;if((R|0)==-1){break}we=g;le=(R^g)>>13<<13}R=le^g;if((R|0)>0){N[Q+(R^3)|0]=O[(i>>9&0x7C)>>2]|0}else{f(R|0,O[(i>>9&0x7C)>>2]|0)}continue;case 0x37:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(O[(i>>14&0x7C)>>2]|0)+p|0;if((De^g)>>13){R=mt(g,1)|0;if((R|0)==-1){break}De=g;be=(R^g)>>13<<13}R=be^g;if((R|0)>=0){V[Q+(R^2)>>1]=O[(i>>9&0x7C)>>2]}else{u(R|0,O[(i>>9&0x7C)>>2]|0)}continue;case 0x38:v=O[(i>>14&0x7C)>>2]|0;m=O[(i>>9&0x7C)>>2]|0;b=i>>19&0x7C;switch(i&0x3CF){case 0x0:O[b>>2]=v+m|0;We=O[b>>2]>>>0<v>>>0;continue;case 0x1:O[b>>2]=(v+m|0)+(We?1:0)|0;if(We){We=O[b>>2]>>>0<=v>>>0}else{We=O[b>>2]>>>0<v>>>0}continue;case 0x2:O[b>>2]=v-m|0;We=m>>>0>v>>>0;continue;case 0x3:O[b>>2]=v&m;continue;case 0x4:O[b>>2]=v|m;continue;case 0x5:O[b>>2]=v^m;continue;case 0x8:O[b>>2]=v<<(m&0x1F);continue;case 0xc:O[b>>2]=v<<16>>16;continue;case 0xe:O[b>>2]=(Be?v:m)|0;continue;case 0x48:O[b>>2]=v>>>(m&0x1F);continue;case 0x4c:O[b>>2]=v<<24>>24;continue;case 0xf:O[b>>2]=0;for(l=0;(l|0)<32;l=l+1|0){if(v&1<<l){O[b>>2]=l+1;break}}continue;case 0x88:O[b>>2]=v>>(m&0x1F);continue;case 0x10f:O[b>>2]=0;for(l=31;(l|0)>=0;l=l-1|0){if(v&1<<l){O[b>>2]=l+1;break}}continue;case 0x306:O[b>>2]=s(v|0,m|0)|0;continue;case 0x30a:He=(m|0)==0;if(!He){O[b>>2]=(v>>>0)/(m>>>0)}continue;case 0x309:He=(m|0)==0;if(!He){O[b>>2]=(v|0)/(m|0)}continue;default:a(y|0);n();break}break;case 0x39:switch(i>>21&0x1F){case 0x0:Be=(O[(i>>14&0x7C)>>2]|0)==(O[(i>>9&0x7C)>>2]|0);continue;case 0x1:Be=(O[(i>>14&0x7C)>>2]|0)!=(O[(i>>9&0x7C)>>2]|0);continue;case 0x2:Be=O[(i>>14&0x7C)>>2]>>>0>O[(i>>9&0x7C)>>2]>>>0;continue;case 0x3:Be=O[(i>>14&0x7C)>>2]>>>0>=O[(i>>9&0x7C)>>2]>>>0;continue;case 0x4:Be=O[(i>>14&0x7C)>>2]>>>0<O[(i>>9&0x7C)>>2]>>>0;continue;case 0x5:Be=O[(i>>14&0x7C)>>2]>>>0<=O[(i>>9&0x7C)>>2]>>>0;continue;case 0xa:Be=(O[(i>>14&0x7C)>>2]|0)>(O[(i>>9&0x7C)>>2]|0);continue;case 0xb:Be=(O[(i>>14&0x7C)>>2]|0)>=(O[(i>>9&0x7C)>>2]|0);continue;case 0xc:Be=(O[(i>>14&0x7C)>>2]|0)<(O[(i>>9&0x7C)>>2]|0);continue;case 0xd:Be=(O[(i>>14&0x7C)>>2]|0)<=(O[(i>>9&0x7C)>>2]|0);continue;default:a(y|0);n()}break;default:a(y|0);n();break}}else{Z=se;if(!(ne|0)){re=0}j=j-($-ee>>2)|0;if((j|0)<0)if(!(ne|0)){j=j+64|0;e=e-64|0;if((e|0)<0)return 0x0;if(xe>>30!=0){I=(xe&0xFFFFFFF)-(Ee&0xFFFFFFF)|0;Ee=Ee+t|0;if((I|0)<=(t|0)){if(xe&1<<29){xe=xe|1<<28}}}if(xe&1<<28){if(_e|0){lt(P,G[K+(D<<2)>>2]|0);Z=se}}}if(Ce|0)if(Je|0){lt(B,G[K+(D<<2)>>2]|0);Z=se}if((ve^Z)&0xFFFFE000){ve=Z;if(!Ue){oe=0x0}else{S=Z>>13&63;w=G[J+((0x200|S)<<2)>>2]|0;if((w&1)==0){if(vt(Z,64)|0){w=G[J+((0x200|S)<<2)>>2]|0}else{ee=$;ne=0;continue}}if(w>>19!=Z>>19){if(vt(Z,64)|0){w=G[J+((0x200|S)<<2)>>2]|0}else{ee=$;ne=0;continue}}E=G[J+((0x280|S)<<2)>>2]|0;oe=(E^w)>>13<<13}}$=Q+(oe^Z)|0;ee=$;te=Z-4-ee|0;if(ne|0){ne=0;ie=$+4|0;se=ae}else{ie=($>>13)+1<<13;se=(Z>>13)+1<<13}}}return e|0}return{Init:$e,Reset:et,InvalidateTLB:tt,Step:kt,GetFlags:ct,SetFlags:ot,GetTimeToNextInterrupt:rt,ProgressTime:st,GetTicks:at,RaiseInterrupt:ut,ClearInterrupt:dt,AnalyzeImage:nt,GetStat:it}}e("cjs!../messagehandler");i.exports=t}()}),define("cjs!jor1k/worker/or1k/safecpu",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.ram=e,this.r=new Int32Array(this.ram.heap,0,136),this.f=new Float32Array(this.ram.heap,0,128),this.group0=new Int32Array(this.ram.heap,8192,8192),this.group1=new Int32Array(this.ram.heap,16384,8192),this.group2=new Int32Array(this.ram.heap,24576,8192),this.pc=0,this.nextpc=0,this.delayedins=!1,this.clock=0,this.EA=-1,this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.SR_SM=!0,this.SR_TEE=!1,this.SR_IEE=!1,this.SR_DCE=!1,this.SR_ICE=!1,this.SR_DME=!1,this.SR_IME=!1,this.SR_LEE=!1,this.SR_CE=!1,this.SR_F=!1,this.SR_CY=!1,this.SR_OV=!1,this.SR_OVE=!1,this.SR_DSX=!1,this.SR_EPH=!1,this.SR_FO=!0,this.SR_SUMRA=!1,this.SR_CID=0,this.Reset()}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=1,n=17,o=48,c=32,h=64,u=4,d=3,f=6,p=5,l=0,b=2560,v=1024,m=256,k=2304,g=768,R=512,y=1280,S=2048,w=3072,D=3584;t.prototype.Reset=function(){this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.group0[u]=24,this.group0[d]=24,this.group0[f]=72,this.group0[p]=72,this.group0[l]=301989889,this.group0[a]=1561,this.Exception(m,0),this.pc=this.nextpc,this.nextpc++},t.prototype.InvalidateTLB=function(){},t.prototype.GetTimeToNextInterrupt=function(){if(this.TTMR>>30==0)return-1;var e=(268435455&this.TTMR)-(268435455&this.TTCR);return e},t.prototype.GetTicks=function(){return this.TTMR>>30==0?-1:268435455&this.TTCR},t.prototype.ProgressTime=function(e){this.TTCR=this.TTCR+e&4294967295},t.prototype.AnalyzeImage=function(){this.boot_dtlb_misshandler_address=0,this.boot_itlb_misshandler_address=0,this.current_pgd=0},t.prototype.SetFlags=function(e){this.SR_SM=!!(1&e),this.SR_TEE=!!(2&e);var t=this.SR_IEE;this.SR_IEE=!!(4&e),this.SR_DCE=!!(8&e),this.SR_ICE=!!(16&e);this.SR_DME;this.SR_DME=!!(32&e);this.SR_IME;this.SR_IME=!!(64&e),this.SR_LEE=!!(128&e),this.SR_CE=!!(256&e),this.SR_F=!!(512&e),this.SR_CY=!!(1024&e),this.SR_OV=!!(2048&e),this.SR_OVE=!!(4096&e),this.SR_DSX=!!(8192&e),this.SR_EPH=!!(16384&e),this.SR_FO=!0,this.SR_SUMRA=!!(65536&e),this.SR_CID=e>>28&15,this.SR_LEE&&(r.Debug("little endian not supported"),r.Abort()),this.SR_CID&&(r.Debug("context id not supported"),r.Abort()),this.SR_EPH&&(r.Debug("exception prefix not supported"),r.Abort()),this.SR_DSX&&(r.Debug("delay slot exception not supported"),r.Abort()),this.SR_IEE&&!t&&this.CheckForInterrupt()},t.prototype.GetFlags=function(){var e=0;return e|=this.SR_SM?1:0,e|=this.SR_TEE?2:0,e|=this.SR_IEE?4:0,e|=this.SR_DCE?8:0,e|=this.SR_ICE?16:0,e|=this.SR_DME?32:0,e|=this.SR_IME?64:0,e|=this.SR_LEE?128:0,e|=this.SR_CE?256:0,e|=this.SR_F?512:0,e|=this.SR_CY?1024:0,e|=this.SR_OV?2048:0,e|=this.SR_OVE?4096:0,e|=this.SR_DSX?8192:0,e|=this.SR_EPH?16384:0,e|=this.SR_FO?32768:0,e|=this.SR_SUMRA?65536:0,e|=this.SR_CID<<28},t.prototype.CheckForInterrupt=function(){this.SR_IEE&&this.PICMR&this.PICSR&&(this.Exception(S,this.group0[o]),this.pc=this.nextpc++)},t.prototype.RaiseInterrupt=function(e,t){this.PICSR|=1<<e,this.CheckForInterrupt()},t.prototype.ClearInterrupt=function(e,t){this.PICSR&=~(1<<e)},t.prototype.SetSPR=function(e,t){var i=2047&e,s=e>>11&31;switch(s){case 0:i==n&&this.SetFlags(t),this.group0[i]=t;break;case 1:this.group1[i]=t;break;case 2:this.group2[i]=t;break;case 3:case 4:break;case 8:break;case 9:switch(i){case 0:this.PICMR=3|t,this.SR_IEE&&this.PICMR&this.PICSR&&(r.Debug("Error in SetSPR: Direct triggering of interrupt exception not supported?"),r.Abort());break;case 2:break;default:r.Debug("Error in SetSPR: interrupt address not supported"),r.Abort()}break;case 10:switch(i){case 0:this.TTMR=t,3!=(this.TTMR>>30&3);break;case 1:this.TTCR=t;break;default:r.Debug("Error in SetSPR: Tick timer address not supported"),r.Abort()}break;default:r.Debug("Error in SetSPR: group "+s+" not found"),r.Abort()}},t.prototype.GetSPR=function(e){var t=2047&e,i=e>>11&31;switch(i){case 0:return t==n?this.GetFlags():this.group0[t];case 1:return this.group1[t];case 2:return this.group2[t];case 8:return 0;case 9:switch(t){case 0:return this.PICMR;case 2:return this.PICSR;default:r.Debug("Error in GetSPR: PIC address unknown"),r.Abort()}break;case 10:switch(t){case 0:return this.TTMR;case 1:return this.TTCR;default:r.Debug("Error in GetSPR: Tick timer address unknown"),r.Abort()}break;default:r.Debug("Error in GetSPR: group "+i+" unknown"),r.Abort()}},t.prototype.Exception=function(e,t){var i=e|(this.SR_EPH?4026531840:0);switch(this.SetSPR(o,t),this.SetSPR(h,this.GetFlags()),this.EA=-1,this.SR_OVE=!1,this.SR_SM=!0,this.SR_IEE=!1,this.SR_TEE=!1,this.SR_DME=!1,this.nextpc=i>>2,e){case m:break;case b:case v:case k:case g:case R:case y:case S:case D:this.SetSPR(c,(this.pc<<2)-(this.delayedins?4:0));break;case w:this.SetSPR(c,(this.pc<<2)+4-(this.delayedins?4:0));break;default:r.Debug("Error in Exception: exception type not supported"),r.Abort()}e==y&&this.TTMR>>30==1&&(this.TTCR=0),this.delayedins=!1,this.SR_IME=!1},t.prototype.DTLBLookup=function(e,t){if(!this.SR_DME)return e;var i=e>>13&63,s=this.group1[512|i];if(0==(1&s)||s>>19!=e>>19)return this.Exception(k,e),-1;192&s&&(r.Debug("Error: LRU ist not supported"),r.Abort());var a=this.group1[640|i];if(this.SR_SM){if(!t&&!(256&a)||t&&!(512&a))return this.Exception(g,e),-1}else if(!t&&!(64&a)||t&&!(128&a))return this.Exception(g,e),-1;return 4294959104&a|8191&e},t.prototype.GetInstruction=function(e){if(!this.SR_IME)return this.ram.Read32Big(e);var t=e>>13&63;t&=63;var i=this.group2[512|t];if(0==(1&i)||i>>19!=e>>19)return this.Exception(b,this.pc<<2),-1;192&i&&(r.Debug("Error: LRU ist not supported"),r.Abort());var s=this.group2[640|t];if(this.SR_SM){if(!(64&s))return this.Exception(v,this.pc<<2),-1}else if(!(128&s))return this.Exception(v,this.pc<<2),-1;return this.ram.Read32Big(4294959104&s|8191&e)},t.prototype.Step=function(e,t){var i=0,a=0,n=0,u=0,d=0,f=0,p=0,l=this.r,b=this.f,v=this.ram,m=this.ram.int32mem,k=(this.group2,0),g=0;do if(this.clock++,63&e||(this.TTMR>>30!=0&&(g=(268435455&this.TTMR)-(268435455&this.TTCR),this.TTCR=this.TTCR+t&4294967295,g<t&&this.TTMR&1<<29&&(this.TTMR|=1<<28)),this.SR_TEE&&this.TTMR&1<<28&&(this.Exception(y,this.group0[o]),this.pc=this.nextpc++)),i=this.GetInstruction(this.pc<<2),i!=-1){switch(i>>26&63){case 0:k=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=k,this.delayedins=!0;continue;case 1:k=this.pc+(i<<6>>6),l[9]=(this.nextpc<<2)+4,this.pc=this.nextpc,this.nextpc=k,this.delayedins=!0;continue;case 3:if(this.SR_F)break;k=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=k,this.delayedins=!0;continue;case 4:if(!this.SR_F)break;k=this.pc+(i<<6>>6),this.pc=this.nextpc,this.nextpc=k,this.delayedins=!0;continue;case 5:break;case 6:u=i>>21&31,65536&i?(r.Debug("Error: macrc not supported\n"),r.Abort()):l[u]=(65535&i)<<16;break;case 8:553648128==(4294901760&i)?(r.Debug("Trap at "+s.ToHex(this.pc<<2)),this.Exception(D,this.group0[o])):this.Exception(w,this.group0[o]);break;case 9:this.nextpc=this.GetSPR(c)>>2,this.pc=this.nextpc++,this.delayedins=!1,this.SetFlags(this.GetSPR(h));continue;case 17:k=l[i>>11&31]>>2,this.pc=this.nextpc,this.nextpc=k,this.delayedins=!0;continue;case 18:k=l[i>>11&31]>>2,l[9]=(this.nextpc<<2)+4,this.pc=this.nextpc,this.nextpc=k,this.delayedins=!0;continue;case 27:if(l[32]=l[i>>16&31]+(i<<16>>16),0!=(3&l[32])&&(r.Debug("Error in lwz: no unaligned access allowed"),abort()),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;this.EA=l[33],l[i>>21&31]=l[33]>0?v.int32mem[l[33]>>2]:v.Read32Big(l[33]);break;case 33:if(l[32]=l[i>>16&31]+(i<<16>>16),0!=(3&l[32])&&(r.Debug("Error in lwz: no unaligned access allowed"),abort()),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=l[33]>0?v.int32mem[l[33]>>2]:v.Read32Big(l[33]);break;case 35:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read8Big(l[33]);break;case 36:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read8Big(l[33])<<24>>24;break;case 37:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read16Big(l[33]);break;case 38:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read16Big(l[33])<<16>>16;break;case 39:a=i<<16>>16,d=l[i>>16&31],u=i>>21&31,l[u]=d+a,this.SR_CY=l[u]>>>0<d>>>0;break;case 40:a=i<<16>>16,d=l[i>>16&31],u=i>>21&31,l[u]=d+a+(this.SR_CY?1:0),this.SR_CY?this.SR_CY=l[u]>>>0<=d>>>0:this.SR_CY=l[u]>>>0<d>>>0;break;case 41:l[i>>21&31]=l[i>>16&31]&(65535&i);break;case 42:l[i>>21&31]=l[i>>16&31]|65535&i;break;case 43:d=l[i>>16&31],l[i>>21&31]=d^i<<16>>16;break;case 44:u=i>>21&31,d=l[i>>16&31],l[u]=d*(i<<16>>16)&4294967295;var R=65535&d,S=65535&i;l[u]=4294901760&l[u]|R*S&65535;break;
case 45:l[i>>21&31]=this.GetSPR(l[i>>16&31]|65535&i);break;case 46:switch(i>>6&3){case 0:l[i>>21&31]=l[i>>16&31]<<(31&i);break;case 1:l[i>>21&31]=l[i>>16&31]>>>(31&i);break;case 2:l[i>>21&31]=l[i>>16&31]>>(31&i);break;default:r.Debug("Error: opcode 2E function not implemented"),abort()}break;case 47:switch(a=i<<16>>16,i>>21&31){case 0:this.SR_F=l[i>>16&31]==a;break;case 1:this.SR_F=l[i>>16&31]!=a;break;case 2:this.SR_F=l[i>>16&31]>>>0>a>>>0;break;case 3:this.SR_F=l[i>>16&31]>>>0>=a>>>0;break;case 4:this.SR_F=l[i>>16&31]>>>0<a>>>0;break;case 5:this.SR_F=l[i>>16&31]>>>0<=a>>>0;break;case 10:this.SR_F=l[i>>16&31]>a;break;case 11:this.SR_F=l[i>>16&31]>=a;break;case 12:this.SR_F=l[i>>16&31]<a;break;case 13:this.SR_F=l[i>>16&31]<=a;break;default:r.Debug("Error: sf...i not supported yet"),abort()}break;case 48:a=2047&i|i>>10&63488,this.pc=this.nextpc++,this.delayedins=!1,this.SetSPR(l[i>>16&31]|a,l[i>>11&31]);continue;case 50:switch(d=i>>16&31,f=i>>11&31,p=i>>21&31,255&i){case 0:b[p]=b[d]+b[f];break;case 1:b[p]=b[d]-b[f];break;case 2:b[p]=b[d]*b[f];break;case 3:b[p]=b[d]/b[f];break;case 4:b[p]=l[d];break;case 5:l[p]=b[d];break;case 7:b[p]+=b[d]*b[f];break;case 8:this.SR_F=b[d]==b[f];break;case 9:this.SR_F=b[d]!=b[f];break;case 10:this.SR_F=b[d]>b[f];break;case 11:this.SR_F=b[d]>=b[f];break;case 12:this.SR_F=b[d]<b[f];break;case 13:this.SR_F=b[d]<=b[f];break;default:r.Debug("Error: lf. function "+s.ToHex(255&i)+" not supported yet"),r.Abort()}break;case 51:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,3&l[32]&&(r.Debug("Error in sw: no aligned memory access"),abort()),l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;if(this.SR_F=l[33]==this.EA,this.EA=-1,0==this.SR_F)break;l[33]>0?m[l[33]>>2]=l[i>>11&31]:v.Write32Big(l[33],l[i>>11&31]);break;case 53:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,3&l[32]&&(r.Debug("Error in sw: no aligned memory access"),r.Abort()),l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;l[33]>0?m[l[33]>>2]=l[i>>11&31]:v.Write32Big(l[33],l[i>>11&31]);break;case 54:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;v.Write8Big(l[33],l[i>>11&31]);break;case 55:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;v.Write16Big(l[33],l[i>>11&31]);break;case 56:switch(d=l[i>>16&31],f=l[i>>11&31],u=i>>21&31,975&i){case 0:l[u]=d+f,this.SR_CY=l[u]>>>0<d>>>0;break;case 1:l[u]=d+f+(this.SR_CY?1:0),this.SR_CY?this.SR_CY=l[u]>>>0<=d>>>0:this.SR_CY=l[u]>>>0<d>>>0;break;case 2:l[u]=d-f,this.SR_CY=f>>>0>d>>>0;break;case 3:l[u]=d&f;break;case 4:l[u]=d|f;break;case 5:l[u]=d^f;break;case 8:l[u]=d<<(31&f);break;case 12:l[u]=d<<16>>16;break;case 14:l[u]=this.SR_F?d:f;break;case 15:for(l[u]=0,n=0;n<32;n++)if(d&1<<n){l[u]=n+1;break}break;case 72:l[u]=d>>>(31&f);break;case 76:l[u]=d<<24>>24;break;case 136:l[u]=d>>(31&f);break;case 271:for(l[u]=0,n=31;n>=0;n--)if(d&1<<n){l[u]=n+1;break}break;case 774:l[u]=s.int32(d>>0)*s.int32(f);var R=65535&d,S=65535&f;l[u]=4294901760&l[u]|R*S&65535;break;case 778:this.SR_OV=0==f,this.SR_OV||(l[u]=(d>>>0)/(f>>>0));break;case 777:this.SR_OV=0==f,this.SR_OV||(l[u]=d/f);break;default:r.Debug("Error: op38 opcode not supported yet"),r.Abort()}break;case 57:switch(i>>21&31){case 0:this.SR_F=l[i>>16&31]==l[i>>11&31];break;case 1:this.SR_F=l[i>>16&31]!=l[i>>11&31];break;case 2:this.SR_F=l[i>>16&31]>>>0>l[i>>11&31]>>>0;break;case 3:this.SR_F=l[i>>16&31]>>>0>=l[i>>11&31]>>>0;break;case 4:this.SR_F=l[i>>16&31]>>>0<l[i>>11&31]>>>0;break;case 5:this.SR_F=l[i>>16&31]>>>0<=l[i>>11&31]>>>0;break;case 10:this.SR_F=l[i>>16&31]>l[i>>11&31];break;case 11:this.SR_F=l[i>>16&31]>=l[i>>11&31];break;case 12:this.SR_F=l[i>>16&31]<l[i>>11&31];break;case 13:this.SR_F=l[i>>16&31]<=l[i>>11&31];break;default:r.Debug("Error: sf.... function supported yet"),r.Abort()}break;default:r.Debug("Error: Instruction with opcode "+s.ToHex(i>>>26)+" not supported"),r.Abort()}this.pc=this.nextpc++,this.delayedins=!1}else this.pc=this.nextpc++;while(--e);return 0},i.exports=t}()}),define("cjs!jor1k/worker/or1k/smpcpu",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e,t,i){"use asm";var r=e.Math.floor;var s=t.imul;var a=t.DebugMessage;var n=t.abort;var o=t.Read32;var c=t.Write32;var h=t.Read16;var u=t.Write16;var d=t.Read8;var f=t.Write8;var p=0;var l=1;var b=2;var v=3;var m=4;var k=5;var g=6;var R=7;var y=8;var S=9;var w=1;var D=17;var T=48;var x=32;var E=64;var I=4;var j=3;var A=6;var _=5;var C=0;var M=128;var L=129;var q=0xA00;var U=0x400;var F=0x100;var P=0x900;var B=0x300;var W=0x200;var H=0x500;var O=0x800;var z=0xC00;var G=0xE00;var N=new e.Int32Array(i);var V=new e.Float32Array(i);var X=new e.Int32Array(i);var Q=new e.Uint8Array(i);var K=new e.Uint16Array(i);var Y=4;var J=0xF;var Z=0xF;var $=0;var ee=0x0;var te=0x0;var ie=0x100000;var re=0x2000;var se=0x4000;var ae=0x6000;var ne=0x0;var oe=0;var ce=0;var he=-4;var ue=0;var de=0;var fe=0x0;var pe=0x0;var le=0;var be=-1;var ve=-1;var me=-1;var ke=-1;var ge=-1;var Re=-1;var ye=-1;var Se=-1;var we=-1;var De=-1;var Te=-1;var xe=-1;var Ee=-1;var Ie=-1;var je=-1;var Ae=-1;var _e=-1;var Ce=-1;var Me=0x100;var Le=0x104;var qe=0x108;var Ue=0x10C;var Fe=0x110;var Pe=0x114;var Be=1;var We=0;var He=0;var Oe=0;var ze=0;var Ge=0;var Ne=0;var Ve=0;var Xe=0;var Qe=0;var Ke=0;var Ye=0;var Je=0;var Ze=0;var $e=0;var et=1;var tt=0;var it=0x0;var rt=0x0;var st=0x0;var at=0x0;var nt=0x0;function ot(e){e=e|0;Y=e|0;if((Y|0)==32)J=0xFFFFFFFF;else J=(1<<Y)-1|0;mt();ct()}function ct(){var e=0;Z=J;nt=0x0;for(e=0;(e|0)<(Y|0);e=e+1|0){X[ee+Me>>2]=0x0;X[ee+Le>>2]=0x0;X[ee+qe>>2]=0x3;X[ee+Ue>>2]=0x0;X[ee+re+(I<<2)>>2]=0x18;X[ee+re+(j<<2)>>2]=0x18;X[ee+re+(A<<2)>>2]=0x0;X[ee+re+(_<<2)>>2]=0x0;X[ee+re+(C<<2)>>2]=0x12000001;X[ee+re+(M<<2)>>2]=$|0;X[ee+re+(L<<2)>>2]=2|0;X[ee+re+(w<<2)>>2]=0x619;oe=0;ce=0;he=-4;xt(F,0x0);ht()}}function ht(){var e=0;var t=0;if((Y|0)==1)return;e=$|0;if((Z|0)==0){a(S|0);n()}if((Z&Z-1)==0)if(Z&1<<$){return}do{e=e+1|0;if((e|0)>=(Y|0))e=0}while((Z&1<<e)==0);if((e|0)==($|0))return;X[ee+0x120>>2]=Rt()|0;X[ee+0x124>>2]=ne;X[ee+0x128>>2]=oe;X[ee+0x12C>>2]=ce;X[ee+0x130>>2]=he;X[ee+0x134>>2]=ue;X[ee+0x138>>2]=fe;X[ee+0x13C>>2]=pe;X[ee+0x190>>2]=de;X[ee+0x194>>2]=le;X[ee+0x140>>2]=be;X[ee+0x144>>2]=ve;X[ee+0x148>>2]=me;X[ee+0x14C>>2]=ke;X[ee+0x150>>2]=ge;X[ee+0x154>>2]=Re;X[ee+0x158>>2]=ye;X[ee+0x15C>>2]=Se;X[ee+0x160>>2]=we;X[ee+0x164>>2]=De;X[ee+0x168>>2]=Te;X[ee+0x16C>>2]=xe;X[ee+0x170>>2]=Ee;X[ee+0x174>>2]=Ie;X[ee+0x178>>2]=je;X[ee+0x17C>>2]=Ae;X[ee+0x180>>2]=_e;X[ee+0x184>>2]=Ce;$=e|0;ee=$<<15;kt(X[ee+0x120>>2]|0);ne=X[ee+0x124>>2]|0;oe=X[ee+0x128>>2]|0;ce=X[ee+0x12C>>2]|0;he=X[ee+0x130>>2]|0;ue=X[ee+0x134>>2]|0;fe=X[ee+0x138>>2]|0;pe=X[ee+0x13C>>2]|0;de=X[ee+0x190>>2]|0;le=X[ee+0x194>>2]|0;be=X[ee+0x140>>2]|0;ve=X[ee+0x144>>2]|0;me=X[ee+0x148>>2]|0;ke=X[ee+0x14C>>2]|0;ge=X[ee+0x150>>2]|0;Re=X[ee+0x154>>2]|0;ye=X[ee+0x158>>2]|0;Se=X[ee+0x15C>>2]|0;we=X[ee+0x160>>2]|0;De=X[ee+0x164>>2]|0;Te=X[ee+0x168>>2]|0;xe=X[ee+0x16C>>2]|0;Ee=X[ee+0x170>>2]|0;Ie=X[ee+0x174>>2]|0;je=X[ee+0x178>>2]|0;Ae=X[ee+0x17C>>2]|0;_e=X[ee+0x180>>2]|0;Ce=X[ee+0x184>>2]|0}function ut(){be=-1;ve=-1;me=-1;ke=-1;ge=-1;Re=-1;ye=-1;Se=-1;we=-1;De=-1;Te=-1;xe=-1;Ee=-1;Ie=-1;je=-1;Ae=-1;_e=-1;Ce=-1}function dt(e){e=e|0;Z=Z|1<<e;X[(e<<15)+Me>>2]=X[(e<<15)+Me>>2]|0|1<<28}function ft(e){e=e|0;var t=0;t=X[(e<<15)+Me>>2]>>29?1:0;return t|0}function pt(e){e=e|0;var t=0;t=(X[(e<<15)+Me>>2]&0xFFFFFFF)-(X[Le>>2]&0xFFFFFFF)|0;return t|0}function lt(){var e=0xFFFFFFF;var t=0x0;var i=0;for(i=0;(i|0)<(Y|0);i=i+1|0){if(!(ft(i)|0))continue;t=pt(i)|0;if((t|0)<(e|0))e=t|0}return e|0}function bt(e){e=e|0;var t=0;X[Le>>2]=(X[Le>>2]|0)+e|0;Z=J}function vt(){return X[Le>>2]&0xFFFFFFF|0}function mt(){rt=X[ie+0x900>>2]|0;st=X[ie+0xA00>>2]|0;at=(X[ie+0x2010>>2]&0xFFF)<<16|X[ie+0x2014>>2]&0xFFFF|0}function kt(e){e=e|0;Be=e&1<<0;We=e&1<<1;He=e&1<<2;Oe=e&1<<3;ze=e&1<<4;Ge=e&1<<5;Ne=e&1<<6;Ve=e&1<<7;Xe=e&1<<8;Qe=e&1<<9;Ke=e&1<<10;Ye=e&1<<11;Je=e&1<<12;Ze=e&1<<13;$e=e&1<<14;et=1;tt=e&1<<16;it=e>>28&0xF}function gt(e){e=e|0;var t=0;t=He;kt(e);if(Ve){a(p|0);n()}if(it){a(l|0);n()}if($e){a(b|0);n()}if(Ze){a(v|0);n()}if(He){if((t|0)==(0|0)){yt($)}}}function Rt(){var e=0x0;e=e|(Be?1<<0:0);e=e|(We?1<<1:0);e=e|(He?1<<2:0);e=e|(Oe?1<<3:0);e=e|(ze?1<<4:0);e=e|(Ge?1<<5:0);e=e|(Ne?1<<6:0);e=e|(Ve?1<<7:0);e=e|(Xe?1<<8:0);e=e|(Qe?1<<9:0);e=e|(Ke?1<<10:0);e=e|(Ye?1<<11:0);e=e|(Je?1<<12:0);e=e|(Ze?1<<13:0);e=e|($e?1<<14:0);e=e|(et?1<<15:0);e=e|(tt?1<<16:0);e=e|it<<28;return e|0}function yt(e){e=e|0;var t=0;X[ee+0x120>>2]=Rt()|0;t=X[(e<<15)+0x120>>2]|0;if(t&1<<2){if(X[(e<<15)+qe>>2]&X[(e<<15)+Ue>>2]){Z=Z|1<<e;X[(e<<15)+Fe>>2]=1}}}function St(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;r=1<<e|0;if((t|0)==-1){for(i=0;(i|0)<(Y|0);i=i+1|0){s=(i<<15)+Ue|0;X[s>>2]=X[s>>2]|0|r;yt(i)}}else{s=(t<<15)+Ue|0;X[s>>2]=X[s>>2]|0|r;yt(t)}}function wt(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;r=1<<e|0;if((t|0)==-1){for(i=0;(i|0)<(Y|0);i=i+1|0){s=(i<<15)+Ue|0;X[s>>2]=X[s>>2]&~r}}else{s=(t<<15)+Ue|0;X[s>>2]=X[s>>2]&~r}}function Dt(e,t){e=e|0;t=t|0;var i=0;var r=0;i=e&0x7FF;r=e>>11&0x1F;switch(r|0){case 0:if((i|0)==(D|0)){gt(t)}X[ee+re+(i<<2)>>2]=t;break;case 1:X[ee+se+(i<<2)>>2]=t;break;case 2:X[ee+ae+(i<<2)>>2]=t;break;case 3:case 4:break;case 8:Z=Z&~(1<<$);break;case 9:switch(i|0){case 0:X[ee+qe>>2]=t|0x3;if(He){if(X[ee+qe>>2]&X[ee+Ue>>2]){a(m|0);n()}}break;case 2:break;default:a(k|0);n()}break;case 10:switch(i|0){case 0:X[ee+Me>>2]=t|0;if((X[ee+Me>>2]>>30&3)!=0x3){a(g|0);n()}break;case 1:break;default:a(y|0);n();break}break;default:a(y|0);n();break}}function Tt(e){e=e|0;var t=0;var i=0;t=e&0x7FF;i=e>>11&0x1F;switch(i|0){case 0:if((t|0)==(D|0)){return Rt()|0}return X[ee+re+(t<<2)>>2]|0;case 1:return X[ee+se+(t<<2)>>2]|0;case 2:return X[ee+ae+(t<<2)>>2]|0;case 8:return 0x0;case 9:switch(t|0){case 0:return X[ee+qe>>2]|0;case 2:return X[ee+Ue>>2]|0;default:a(y|0);n();break}break;case 10:switch(t|0){case 0:return X[ee+Me>>2]|0;case 1:return X[Le>>2]|0;default:a(y|0);n();break}break;default:a(y|0);n();break}return 0|0}function xt(e,t){e=e|0;t=t|0;var i=0;i=e|($e?0xf0000000:0x0);Z=Z|1<<$;Dt(T,t);Dt(E,Rt()|0);Je=0;Be=1;He=0;We=0;Ge=0;be=0;ve=0;me=0;ke=0;ge=0;Re=0;ye=0;Se=0;we=0;De=0;Te=0;Ee=0;xe=0;je=0;Ie=0;Ae=0;_e=0;Ce=0;ue=oe|0;fe=i;switch(e|0){case 0x100:break;case 0x300:case 0x900:case 0xE00:case 0x200:ne=he+oe|0;Dt(x,ne-(de?4:0)|0);break;case 0xA00:case 0x400:case 0x500:case 0x800:Dt(x,ne-(de?4:0)|0);break;case 0xC00:ne=he+oe|0;Dt(x,ne+4-(de?4:0)|0);break;default:a(R|0);n()}de=0;Ne=0;X[ee+Pe>>2]=-1;nt=nt&~(1<<$)}function Et(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;var a=0;if((X[ie+0x900>>2]|0)==(rt|0)){xt(P,e);return 0|0}i=e;r=X[ie+at+($<<2)>>2]|0;s=i>>>0x18<<2;a=s+r|0;s=0x40000000+a&0xFFFFFFFF;r=X[ie+s>>2]|0;if((r|0)==0){xt(B,e);return 0|0}r=0xffffe000;s=X[ie+s>>2]|0;s=s&r;a=i>>>0xD;r=a&0x7FF;r=r<<0x2;r=r+s|0;i=X[ie+r>>2]|0;if((i&1)==0){xt(B,e);return 0|0}s=i&0xFFFFe3fa;a=a&t-1;X[ee+se+((0x280|a)<<2)>>2]=s;i=e;s=i&0xFFFFE000;s=s|0x1;X[ee+se+((0x200|a)<<2)>>2]=s;return 1|0}function It(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;var a=0;if((X[ie+0xA00>>2]|0)==(st|0)){xt(q,e);return 0|0}i=e;r=X[ie+at+($<<2)>>2]|0;s=i>>>0x18<<2;a=s+r|0;s=0x40000000+a&0xFFFFFFFF;r=X[ie+s>>2]|0;if((r|0)==0){xt(U,e);return 0|0}r=0xffffe000;s=X[ie+s>>2]|0;s=s&r;a=i>>>0xD;r=a&0x7FF;r=r<<0x2;r=r+s|0;i=X[ie+r>>2]|0;if((i&1)==0){xt(U,e);return 0|0}s=i&0xFFFFe03a;r=i&0x7c0;if((r|0)!=0x0){a=a&t-1;s=s|0xc0}X[ee+ae+((0x280|a)<<2)>>2]=s;i=e;s=i&0xFFFFE000;s=s|0x1;X[ee+ae+((0x200|a)<<2)>>2]=s;return 1|0}function jt(e,t){e=e|0;t=t|0;var i=0;var r=0;var s=0;if(!Ge){return e|0}i=e>>13&63;r=X[ee+se+((0x200|i)<<2)>>2]|0;if((r&1)==0){if(Et(e,64)|0){r=X[ee+se+(0x200+i<<2)>>2]|0}else{return-1|0}}if(r>>19!=e>>19){if(Et(e,64)|0){r=X[ee+se+(0x200+i<<2)>>2]|0}else{return-1|0}}s=X[ee+se+((0x280|i)<<2)>>2]|0;if(Be){if(!t){if(!(s&0x100)){xt(B,e);return-1|0}}else{if(!(s&0x200)){xt(B,e);return-1|0}}}else{if(!t){if(!(s&0x40)){xt(B,e);return-1|0}}else{if(!(s&0x80)){xt(B,e);return-1|0}}}return s&0xFFFFE000|e&0x1FFF|0}function At(e,t){e=e|0;t=t|0;var i=0x0;var p=0x0;var l=0;var b=0x0;var v=0x0,m=0x0,k=0x0;var g=0x0;var R=0x0;var S=0;var w=0x0;var D=0x0;var I=0x0;var j=0x0;var A=0;for(;;){if((oe|0)==(ue|0)){ne=fe;if(!le|0){de=0}A=A-(oe-ce>>2)|0;if((A|0)<=0)if(!(le|0)){A=A+64|0;e=e-64|0;for(l=0;(l|0)<(Y|0);l=l+1|0){if(!(ft(l)|0))continue;j=pt(l)|0;if((j|0)<(t|0)){dt(l)}}X[Le>>2]=(X[Le>>2]|0)+t|0;if((e|0)<0)return 0x0}if(He|0){if(X[ee+Fe>>2]|0){X[ee+Fe>>2]=0;xt(O,X[ee+re+(T<<2)>>2]|0);ne=fe}else if(X[ee+Me>>2]&1<<28){xt(H,X[ee+re+(T<<2)>>2]|0);ne=fe}}if((De^ne)&0xFFFFE000){De=ne;if(!Ne){be=0x0}else{w=ne>>13&63;D=X[ee+ae+((0x200|w)<<2)>>2]|0;if((D&1)==0){if(It(ne,64)|0){D=X[ee+ae+((0x200|w)<<2)>>2]|0}else{ce=oe;le=0;continue}}if(D>>19!=ne>>19){if(It(ne,64)|0){D=X[ee+ae+((0x200|w)<<2)>>2]|0}else{ce=oe;le=0;continue}}I=X[ee+ae+((0x280|w)<<2)>>2]|0;be=(I^D)>>13<<13}}oe=ie+(be^ne)|0;ce=oe;he=ne-4-ce|0;if(le|0){le=0;ue=oe+4|0;fe=pe}else{ue=(oe>>13)+1<<13;fe=(ne>>13)+1<<13}S=S+1|0;if((S&7)==0){ht();continue}}i=X[oe>>2]|0;oe=oe+4|0;switch(i>>26&0x3F){case 0x0:ne=he+oe|0;pe=ne+(i<<6>>4)|0;if((ue|0)==(oe|0)){le=1}else{ue=oe+4|0;fe=pe|0}de=1;break;case 0x1:ne=he+oe|0;pe=ne+(i<<6>>4)|0;N[ee+(9<<2)>>2]=ne+8|0;if((ue|0)==(oe|0)){le=1}else{ue=oe+4|0;fe=pe|0}de=1;break;case 0x3:if(Qe){break}ne=he+oe|0;pe=ne+(i<<6>>4)|0;if((ue|0)==(oe|0)){le=1}else{ue=oe+4|0;fe=pe|0}de=1;break;case 0x4:if(!Qe){break}ne=he+oe|0;pe=ne+(i<<6>>4)|0;if((ue|0)==(oe|0)){le=1}else{ue=oe+4|0;fe=pe|0}de=1;break;case 0x5:break;case 0x6:b=i>>21&0x1F;N[ee+(b<<2)>>2]=(i&0xFFFF)<<16;break;case 0x8:if((i&0xFFFF0000)==0x21000000){xt(G,X[ee+re+T>>2]|0)}else{xt(z,X[ee+re+T>>2]|0)}break;case 0x9:pe=Tt(x)|0;ut();ue=oe;fe=pe;gt(Tt(E)|0);break;case 0x11:pe=N[ee+(i>>9&0x7C)>>2]|0;if((ue|0)==(oe|0)){le=1}else{ue=oe+4|0;fe=pe|0}de=1;break;case 0x12:ne=he+oe|0;pe=N[ee+(i>>9&0x7C)>>2]|0;N[ee+(9<<2)>>2]=ne+8|0;if((ue|0)==(oe|0)){le=1}else{ue=oe+4|0;fe=pe|0}de=1;break;case 0x1B:g=(N[ee+(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((Te^g)>>13){R=jt(g,0)|0;if((R|0)==-1){break}Te=g;ve=(R^g)>>13<<13}R=ve^g;nt=nt|1<<$;X[ee+Pe>>2]=R;N[ee+(i>>19&0x7C)>>2]=(R|0)>0?X[ie+R>>2]|0:o(R|0)|0;break;case 0x21:g=(N[ee+(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((Te^g)>>13){R=jt(g,0)|0;if((R|0)==-1){break}Te=g;ve=(R^g)>>13<<13}R=ve^g;N[ee+(i>>19&0x7C)>>2]=(R|0)>0?X[ie+R>>2]|0:o(R|0)|0;break;case 0x23:g=(N[ee+(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((Ee^g)>>13){R=jt(g,0)|0;if((R|0)==-1){break}Ee=g;ke=(R^g)>>13<<13}R=ke^g;if((R|0)>=0){N[ee+(i>>19&0x7C)>>2]=Q[ie+(R^3)|0]|0}else{N[ee+(i>>19&0x7C)>>2]=d(R|0)|0}break;case 0x24:g=(N[ee+(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((xe^g)>>13){R=jt(g,0)|0;if((R|0)==-1){break}xe=g;me=(R^g)>>13<<13}R=me^g;if((R|0)>=0){N[ee+(i>>19&0x7C)>>2]=Q[ie+(R^3)|0]<<24>>24}else{N[ee+(i>>19&0x7C)>>2]=(d(R|0)|0)<<24>>24}break;case 0x25:g=(N[ee+(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((je^g)>>13){R=jt(g,0)|0;if((R|0)==-1){break}je=g;Re=(R^g)>>13<<13}R=Re^g;if((R|0)>=0){N[ee+(i>>19&0x7C)>>2]=K[ie+(R^2)>>1]}else{N[ee+(i>>19&0x7C)>>2]=h(R|0)|0}break;case 0x26:g=(N[ee+(i>>14&0x7C)>>2]|0)+(i<<16>>16)|0;if((Ie^g)>>13){R=jt(g,0)|0;if((R|0)==-1){break}Ie=g;ge=(R^g)>>13<<13}R=ge^g;if((R|0)>=0){N[ee+(i>>19&0x7C)>>2]=K[ie+(R^2)>>1]<<16>>16}else{N[ee+(i>>19&0x7C)>>2]=(h(R|0)|0)<<16>>16}break;case 0x27:p=i<<16>>16;v=N[ee+(i>>14&0x7C)>>2]|0;b=ee+(i>>19&0x7C)|0;N[b>>2]=v+p|0;Ke=N[b>>2]>>>0<v>>>0;break;case 0x28:p=i<<16>>16;v=N[ee+(i>>14&0x7C)>>2]|0;b=ee+(i>>19&0x7C)|0;N[b>>2]=(v+p|0)+(Ke?1:0)|0;if(Ke|0){Ke=N[b>>2]>>>0<=v>>>0}else{Ke=N[b>>2]>>>0<v>>>0}break;case 0x29:N[ee+(i>>19&0x7C)>>2]=N[ee+(i>>14&0x7C)>>2]&(i&0xFFFF);break;case 0x2A:N[ee+(i>>19&0x7C)>>2]=N[ee+(i>>14&0x7C)>>2]|i&0xFFFF;break;case 0x2B:v=N[ee+(i>>14&0x7C)>>2]|0;N[ee+(i>>19&0x7C)>>2]=v^i<<16>>16;break;case 0x2C:v=N[ee+(i>>14&0x7C)>>2]|0;N[ee+(i>>19&0x7C)>>2]=s(v|0,i<<16>>16)|0;break;case 0x2D:N[ee+(i>>19&0x7C)>>2]=Tt(N[ee+(i>>14&0x7C)>>2]|i&0xFFFF)|0;break;case 0x2E:switch(i>>6&0x3){case 0:N[ee+(i>>19&0x7C)>>2]=N[ee+(i>>14&0x7C)>>2]<<(i&0x1F);break;case 1:N[ee+(i>>19&0x7C)>>2]=N[ee+(i>>14&0x7C)>>2]>>>(i&0x1F);break;case 2:N[ee+(i>>19&0x7C)>>2]=N[ee+(i>>14&0x7C)>>2]>>(i&0x1F);break;default:a(y|0);n();break}break;case 0x2F:p=i<<16>>16;switch(i>>21&0x1F){case 0x0:Qe=(N[ee+(i>>14&0x7C)>>2]|0)==(p|0);break;case 0x1:Qe=(N[ee+(i>>14&0x7C)>>2]|0)!=(p|0);break;case 0x2:Qe=N[ee+(i>>14&0x7C)>>2]>>>0>p>>>0;break;case 0x3:Qe=N[ee+(i>>14&0x7C)>>2]>>>0>=p>>>0;break;case 0x4:Qe=N[ee+(i>>14&0x7C)>>2]>>>0<p>>>0;break;case 0x5:Qe=N[ee+(i>>14&0x7C)>>2]>>>0<=p>>>0;break;case 0xa:Qe=(N[ee+(i>>14&0x7C)>>2]|0)>(p|0);break;case 0xb:Qe=(N[ee+(i>>14&0x7C)>>2]|0)>=(p|0);break;case 0xc:Qe=(N[ee+(i>>14&0x7C)>>2]|0)<(p|0);break;case 0xd:Qe=(N[ee+(i>>14&0x7C)>>2]|0)<=(p|0);break;default:a(y|0);n();break}break;case 0x30:p=i&0x7FF|i>>10&0xF800;Dt(N[ee+(i>>14&0x7C)>>2]|p,N[ee+(i>>9&0x7C)>>2]|0);if((Z|0)==0){Z=J;if(X[($<<15)+Me>>2]&1<<28)break;return e|0}else if((Z&1<<$)==0){ht()}break;case 0x32:v=i>>14&0x7C;m=i>>9&0x7C;k=i>>19&0x7C;switch(i&0xFF){case 0x0:V[ee+k>>2]=+V[ee+v>>2]+ +V[ee+m>>2];break;case 0x1:V[ee+k>>2]=+V[ee+v>>2]-+V[ee+m>>2];break;case 0x2:V[ee+k>>2]=+V[ee+v>>2]*+V[ee+m>>2];break;case 0x3:V[ee+k>>2]=+V[ee+v>>2]/+V[ee+m>>2];break;case 0x4:V[ee+k>>2]=+(N[ee+v>>2]|0);break;case 0x5:N[ee+k>>2]=~~+r(+V[ee+v>>2]);break;case 0x7:V[ee+k>>2]=+V[ee+k>>2]+ +V[ee+v>>2]*+V[ee+m>>2];break;case 0x8:Qe=+V[ee+v>>2]==+V[ee+m>>2];break;case 0x9:Qe=+V[ee+v>>2]!=+V[ee+m>>2];break;case 0xa:Qe=+V[ee+v>>2]>+V[ee+m>>2];break;case 0xb:Qe=+V[ee+v>>2]>=+V[ee+m>>2];break;case 0xc:Qe=+V[ee+v>>2]<+V[ee+m>>2];break;case 0xd:Qe=+V[ee+v>>2]<=+V[ee+m>>2];break;default:a(y|0);n();break}break;case 0x33:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(N[ee+(i>>14&0x7C)>>2]|0)+p|0;if((Ae^g)>>13){R=jt(g,1)|0;if((R|0)==-1){break}Ae=g;ye=(R^g)>>13<<13}R=ye^g;Qe=(R|0)==(X[ee+Pe>>2]|0)?1|0:0|0;X[ee+Pe>>2]=-1;nt=nt&~(1<<$);if(nt)for(l=0;(l|0)<(Y|0);l=l+1|0){if((X[(l<<15)+Pe>>2]|0)==(R|0)){X[(l<<15)+Pe>>2]=-1;nt=nt&~(1<<l)}}if((Qe|0)==0){break}if((R|0)>0){X[ie+R>>2]=N[ee+(i>>9&0x7C)>>2]|0}else{c(R|0,N[ee+(i>>9&0x7C)>>2]|0)}break;case 0x35:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(N[ee+(i>>14&0x7C)>>2]|0)+p|0;if((Ae^g)>>13){R=jt(g,1)|0;if((R|0)==-1){break}Ae=g;ye=(R^g)>>13<<13}R=ye^g;if(nt)for(l=0;(l|0)<(Y|0);l=l+1|0){if((X[(l<<15)+Pe>>2]|0)==(R|0)){X[(l<<15)+Pe>>2]=-1;nt=nt&~(1<<l)}}if((R|0)>0){X[ie+R>>2]=N[ee+(i>>9&0x7C)>>2]|0}else{c(R|0,N[ee+(i>>9&0x7C)>>2]|0)}break;case 0x36:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(N[ee+(i>>14&0x7C)>>2]|0)+p|0;if((_e^g)>>13){R=jt(g,1)|0;if((R|0)==-1){break}_e=g;Se=(R^g)>>13<<13}R=Se^g;if(nt)for(l=0;(l|0)<(Y|0);l=l+1|0){if((X[(l<<15)+Pe>>2]|0)==(R&~3)){X[(l<<15)+Pe>>2]=-1;nt=nt&~(1<<l)}}if((R|0)>0){Q[ie+(R^3)|0]=N[ee+(i>>9&0x7C)>>2]|0}else{f(R|0,N[ee+(i>>9&0x7C)>>2]|0)}break;case 0x37:p=(i>>10&0xF800|i&0x7FF)<<16>>16;g=(N[ee+(i>>14&0x7C)>>2]|0)+p|0;if((Ce^g)>>13){R=jt(g,1)|0;if((R|0)==-1){break}Ce=g;we=(R^g)>>13<<13}R=we^g;if(nt)for(l=0;(l|0)<(Y|0);l=l+1|0){if((X[(l<<15)+Pe>>2]|0)==(R&~3)){X[(l<<15)+Pe>>2]=-1;nt=nt&~(1<<l)}}if((R|0)>=0){K[ie+(R^2)>>1]=N[ee+(i>>9&0x7C)>>2]}else{u(R|0,N[ee+(i>>9&0x7C)>>2]|0)}break;case 0x38:v=N[ee+(i>>14&0x7C)>>2]|0;m=N[ee+(i>>9&0x7C)>>2]|0;b=i>>19&0x7C;switch(i&0x3CF){case 0x0:N[ee+b>>2]=v+m|0;Ke=N[ee+b>>2]>>>0<v>>>0;break;case 0x1:N[ee+b>>2]=(v+m|0)+(Ke?1:0)|0;if(Ke|0){Ke=N[ee+b>>2]>>>0<=v>>>0}else{Ke=N[ee+b>>2]>>>0<v>>>0}break;case 0x2:N[ee+b>>2]=v-m;Ke=m>>>0>v>>>0;break;case 0x3:N[ee+b>>2]=v&m;break;case 0x4:N[ee+b>>2]=v|m;break;case 0x5:N[ee+b>>2]=v^m;break;case 0x8:N[ee+b>>2]=v<<(m&0x1F);break;case 0xc:N[ee+b>>2]=v<<16>>16;continue;case 0xe:N[ee+b>>2]=Qe?v:m;break;case 0x48:N[ee+b>>2]=v>>>(m&0x1F);break;case 0x4c:N[ee+b>>2]=v<<24>>24;break;case 0xf:N[ee+b>>2]=0;for(l=0;(l|0)<32;l=l+1|0){if(v&1<<l){N[ee+b>>2]=l+1;break}}break;case 0x88:N[ee+b>>2]=v>>(m&0x1F);break;case 0x10f:N[ee+b>>2]=0;for(l=31;(l|0)>=0;l=l-1|0){if(v&1<<l){N[ee+b>>2]=l+1;break}}break;case 0x306:{N[ee+b>>2]=s(v|0,m|0)|0}break;case 0x30a:Ye=(m|0)==0;if(!Ye){N[ee+b>>2]=(v>>>0)/(m>>>0)}break;case 0x309:Ye=(m|0)==0;if(!Ye){N[ee+b>>2]=(v|0)/(m|0)}break;default:a(y|0);n();break}break;case 0x39:switch(i>>21&0x1F){case 0x0:Qe=(N[ee+(i>>14&0x7C)>>2]|0)==(N[ee+(i>>9&0x7C)>>2]|0);break;case 0x1:Qe=(N[ee+(i>>14&0x7C)>>2]|0)!=(N[ee+(i>>9&0x7C)>>2]|0);break;case 0x2:Qe=N[ee+(i>>14&0x7C)>>2]>>>0>N[ee+(i>>9&0x7C)>>2]>>>0;break;case 0x3:Qe=N[ee+(i>>14&0x7C)>>2]>>>0>=N[ee+(i>>9&0x7C)>>2]>>>0;break;case 0x4:Qe=N[ee+(i>>14&0x7C)>>2]>>>0<N[ee+(i>>9&0x7C)>>2]>>>0;break;case 0x5:Qe=N[ee+(i>>14&0x7C)>>2]>>>0<=N[ee+(i>>9&0x7C)>>2]>>>0;break;case 0xa:Qe=(N[ee+(i>>14&0x7C)>>2]|0)>(N[ee+(i>>9&0x7C)>>2]|0);break;case 0xb:Qe=(N[ee+(i>>14&0x7C)>>2]|0)>=(N[ee+(i>>9&0x7C)>>2]|0);break;case 0xc:Qe=(N[ee+(i>>14&0x7C)>>2]|0)<(N[ee+(i>>9&0x7C)>>2]|0);break;case 0xd:Qe=(N[ee+(i>>14&0x7C)>>2]|0)<=(N[ee+(i>>9&0x7C)>>2]|0);break;default:a(y|0);n()}break;default:a(y|0);n();break}}return e|0}return{Init:ot,Reset:ct,InvalidateTLB:ut,Step:At,GetFlags:Rt,SetFlags:gt,GetTimeToNextInterrupt:lt,ProgressTime:bt,GetTicks:vt,RaiseInterrupt:St,ClearInterrupt:wt,AnalyzeImage:mt}}e("cjs!../messagehandler");i.exports=t}()}),define("cjs!jor1k/worker/or1k/dynamic/dynamiccpu",["require","exports","module","cjs!../../messagehandler","cjs!../../utils"],function(e,t,i){!function(){function t(e){this.ram=e,this.r=new Int32Array(this.ram.heap,0,136),this.f=new Float32Array(this.ram.heap,0,128),this.group0=new Int32Array(this.ram.heap,8192,8192),this.group1=new Int32Array(this.ram.heap,16384,8192),this.group2=new Int32Array(this.ram.heap,24576,8192),this.pc=0,this.nextpc=0,this.fence=0,this.ppc=0,this.delayedins_at_fence=!1,this.delayedins=!1,this.raise_interrupt=!1,this.idle=!1,this.EA=-1,this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.SR_SM=!0,this.SR_TEE=!1,this.SR_IEE=!1,this.SR_DCE=!1,this.SR_ICE=!1,this.SR_DME=!1,this.SR_IME=!1,this.SR_LEE=!1,this.SR_CE=!1,this.SR_F=!1,this.SR_CY=!1,this.SR_OV=!1,this.SR_OVE=!1,this.SR_DSX=!1,this.SR_EPH=!1,this.SR_FO=!0,this.SR_SUMRA=!1,this.SR_CID=0,this.recompilepath="",this.recompilepid=-1,this.Reset()}var r=e("cjs!../../messagehandler"),s=e("cjs!../../utils"),a=1,n=17,o=48,c=32,h=64,u=4,d=3,f=6,p=5,l=0,b=2560,v=1024,m=256,k=2304,g=768,R=512,y=1280,S=2048,w=3072,D=3584;t.prototype.Reset=function(){this.TTMR=0,this.TTCR=0,this.PICMR=3,this.PICSR=0,this.group0[u]=24,this.group0[d]=24,this.group0[f]=72,this.group0[p]=72,this.group0[l]=301989889,this.group0[a]=1561,this.ppc=0,this.Exception(m,0),this.pc=this.nextpc,this.nextpc=this.nextpc+1|0},t.prototype.InvalidateTLB=function(){},t.prototype.GetTimeToNextInterrupt=function(){if(this.TTMR>>30==0)return-1;var e=(268435455&this.TTMR)-(268435455&this.TTCR);return e},t.prototype.GetTicks=function(){return this.TTMR>>30==0?-1:268435455&this.TTCR},t.prototype.ProgressTime=function(e){this.TTCR=this.TTCR+e&4294967295},t.prototype.AnalyzeImage=function(){this.boot_dtlb_misshandler_address=0|this.ram.int32mem[2304],this.boot_itlb_misshandler_address=0|this.ram.int32mem[2560],this.current_pgd=(4095&this.ram.int32mem[2052])<<16|65535&this.ram.int32mem[2053]|0},t.prototype.SetFlags=function(e){this.SR_SM=!!(1&e),this.SR_TEE=!!(2&e);var t=this.SR_IEE;this.SR_IEE=!!(4&e),this.SR_DCE=!!(8&e),this.SR_ICE=!!(16&e);this.SR_DME;this.SR_DME=!!(32&e);this.SR_IME;this.SR_IME=!!(64&e),this.SR_LEE=!!(128&e),this.SR_CE=!!(256&e),this.SR_F=!!(512&e),this.SR_CY=!!(1024&e),this.SR_OV=!!(2048&e),this.SR_OVE=!!(4096&e),this.SR_DSX=!!(8192&e),this.SR_EPH=!!(16384&e),this.SR_FO=!0,this.SR_SUMRA=!!(65536&e),this.SR_CID=e>>28&15,this.SR_LEE&&(r.Debug("little endian not supported"),r.Abort()),this.SR_CID&&(r.Debug("context id not supported"),r.Abort()),this.SR_EPH&&(r.Debug("exception prefix not supported"),r.Abort()),this.SR_DSX&&(r.Debug("delay slot exception not supported"),r.Abort()),this.SR_IEE&&!t&&this.CheckForInterrupt()},t.prototype.GetFlags=function(){var e=0;return e|=this.SR_SM?1:0,e|=this.SR_TEE?2:0,e|=this.SR_IEE?4:0,e|=this.SR_DCE?8:0,e|=this.SR_ICE?16:0,e|=this.SR_DME?32:0,e|=this.SR_IME?64:0,e|=this.SR_LEE?128:0,e|=this.SR_CE?256:0,e|=this.SR_F?512:0,e|=this.SR_CY?1024:0,e|=this.SR_OV?2048:0,e|=this.SR_OVE?4096:0,e|=this.SR_DSX?8192:0,e|=this.SR_EPH?16384:0,e|=this.SR_FO?32768:0,e|=this.SR_SUMRA?65536:0,e|=this.SR_CID<<28},t.prototype.CheckForInterrupt=function(){this.SR_IEE&&this.PICMR&this.PICSR&&(this.raise_interrupt=!0)},t.prototype.RaiseInterrupt=function(e,t){var i=1<<e;this.PICSR|=i,this.CheckForInterrupt()},t.prototype.ClearInterrupt=function(e,t){this.PICSR&=~(1<<e)},t.prototype.FetchAndInstantiate=function(e,t){return fetch(e).then(function(e){e.arrayBuffer()}).then(function(e){WebAssembly.instantiate(e,t)}).then(function(e){r.Debug("compiled"),this.instance=e.instance})},t.prototype.SetSPR=function(e,t){var i=2047&e,s=e>>11&31;switch(s){case 0:if(i==n&&this.SetFlags(t),20==i);else if(21==i)if(this.recompilepid=t,t==-1)this.recompilepath="";else{r.Debug("recompile pid: "+t+" path:"+this.recompilepath);var a={env:{Exception:function(e,t){this.SR_F=!!this.instance.exports.GetSR_F(),this.pc=this.instance.exports.GetPC()>>2,this.delayedins=!1,this.Exception(e,t)}.bind(this),ramp:1048576,group1p:16384,current_pgd:this.current_pgd,EXCEPT_DPF:768,memory:this.ram.memory,table:new WebAssembly.Table({initial:0,maximum:0,element:"anyfunc"}),memoryBase:0,tableBase:0}};"/usr/bin/fbdemo"==this.recompilepath&&this.FetchAndInstantiate(r.GetWorkingPath()+"/precompiled/fbdemo.wasm",a)}else 22==i&&(this.recompilepath+=String.fromCharCode(t));this.group0[i]=t;break;case 1:this.group1[i]=t;break;case 2:this.group2[i]=t;break;case 3:case 4:break;case 8:this.idle=!0;break;case 9:switch(i){case 0:this.PICMR=3|t,this.SR_IEE&&this.PICMR&this.PICSR&&(r.Debug("Error in SetSPR: Direct triggering of interrupt exception not supported?"),r.Abort());break;case 2:break;default:r.Debug("Error in SetSPR: interrupt address not supported"),r.Abort()}break;case 10:switch(i){case 0:this.TTMR=t,3!=(this.TTMR>>30&3)&&(r.Debug("Error in SetSPR: Timer mode other than continuous not supported"),r.Abort());break;case 1:this.TTCR=t;break;default:r.Debug("Error in SetSPR: Tick timer address not supported"),r.Abort()}break;default:r.Debug("Error in SetSPR: group "+s+" not found"),r.Abort()}},t.prototype.GetSPR=function(e){var t=2047&e,i=e>>11&31;switch(i){case 0:return t==n?this.GetFlags():this.group0[t];case 1:return this.group1[t];case 2:return this.group2[t];case 8:return 0;case 9:switch(t){case 0:return this.PICMR;case 2:return this.PICSR;default:r.Debug("Error in GetSPR: PIC address unknown"),r.Abort()}break;case 10:switch(t){case 0:return this.TTMR;case 1:return this.TTCR;default:r.Debug("Error in GetSPR: Tick timer address unknown"),r.Abort()}break;default:r.Debug("Error in GetSPR: group "+i+" unknown"),r.Abort()}},t.prototype.Exception=function(e,t){var i=e|(this.SR_EPH?4026531840:0);switch(this.SetSPR(o,t),this.SetSPR(h,this.GetFlags()),this.EA=-1,this.SR_OVE=!1,this.SR_SM=!0,this.SR_IEE=!1,this.SR_TEE=!1,this.SR_DME=!1,this.fence=this.ppc,this.nextpc=i>>2,e){case m:break;case b:case v:case k:case g:case R:case y:case S:case D:this.SetSPR(c,(this.pc<<2)-(this.delayedins?4:0));break;case w:this.SetSPR(c,(this.pc<<2)+4-(this.delayedins?4:0));break;default:r.Debug("Error in Exception: exception type not supported"),r.Abort()}this.delayedins=!1,this.delayedins_at_fence=!1,this.SR_IME=!1},t.prototype.DTLBLookup=function(e,t){if(!this.SR_DME)return e;var i=e>>13&63,s=this.group1[512|i];if(0==(1&s)||s>>19!=e>>19)return this.Exception(k,e),-1;192&s&&(r.Debug("Error: LRU ist not supported"),r.Abort());var a=this.group1[640|i];if(this.SR_SM){if(!t&&!(256&a)||t&&!(512&a))return this.Exception(g,e),-1}else if(!t&&!(64&a)||t&&!(128&a))return this.Exception(g,e),-1;return 4294959104&a|8191&e},t.prototype.GetInstructionPointer=function(e){if(!this.SR_IME)return e;var t=e>>13&63;t&=63;var i=this.group2[512|t];if(0==(1&i)||i>>19!=e>>19)return this.Exception(b,this.pc<<2),-1;192&i&&(r.Debug("Error: LRU ist not supported"),r.Abort());var s=this.group2[640|t];if(this.SR_SM){if(!(64&s))return this.Exception(v,this.pc<<2),-1}else if(!(128&s))return this.Exception(v,this.pc<<2),-1;return 4294959104&s|8191&e},t.prototype.Step=function(e,t){e=0|e,t=0|t;for(var i=0,a=0,n=0,u=0,d=0,f=0,p=0,l=this.r,b=this.f,v=this.ram,m=this.ram.int32mem,k=(this.group2,0),g=0,R=0,T=0;;){if(R=R-1|0,(0|this.ppc)==(0|this.fence)){if(this.delayedins_at_fence||(this.delayedins=!1),R<0&&!this.delayedins_at_fence){if(R=R+64|0,e=e-64|0,e<0)return 0;this.TTMR>>30!=0&&(g=(268435455&this.TTMR)-(268435455&this.TTCR),this.TTCR=this.TTCR+t&4294967295,g<t&&this.TTMR&1<<29&&(this.TTMR|=1<<28)),this.SR_TEE&&this.TTMR&1<<28&&(this.Exception(y,this.group0[o]),this.pc=0|this.nextpc,this.nextpc=this.nextpc+1|0)}this.SR_IEE&&this.raise_interrupt&&(this.raise_interrupt=!1,this.Exception(S,this.group0[o]),this.pc=0|this.nextpc,this.nextpc=this.nextpc+1|0);var x=0|this.GetInstructionPointer(this.pc<<2);if(x==-1){this.pc=0|this.nextpc,this.nextpc=this.nextpc+1|0,this.delayedins_at_fence=!1;continue}if(this.ppc=x,this.delayedins_at_fence?(this.delayedins_at_fence=!1,this.fence=this.ppc+4|0):this.fence=(this.ppc>>13)+1<<13,!this.SR_SM&&this.group0[20]==this.recompilepid&&this.instance&&!T&&this.pc<268435456){var E=(this.pc,e),I=this.instance.exports.Exec(this.pc<<2,E,this.SR_F?1:0);e=I,this.SR_SM||(this.SR_F=!!this.instance.exports.GetSR_F(),this.pc=this.instance.exports.GetPC()>>2,this.nextpc=this.pc+1|0,this.fence=0|this.ppc),R=-1,T=1;continue}}switch(T=0,i=0|m[this.ppc>>2],this.ppc=this.ppc+4|0,i>>26&63){case 0:k=this.pc+(i<<6>>6),this.pc=0|this.nextpc,this.nextpc=0|k,(0|this.fence)==(0|this.ppc)?this.delayedins_at_fence=!0:this.fence=this.ppc+4|0,this.delayedins=!0;continue;case 1:k=this.pc+(i<<6>>6),l[9]=(this.nextpc<<2)+4,this.pc=0|this.nextpc,this.nextpc=0|k,(0|this.fence)==(0|this.ppc)?this.delayedins_at_fence=!0:this.fence=this.ppc+4|0,this.delayedins=!0;continue;case 3:if(this.SR_F)break;k=this.pc+(i<<6>>6),this.pc=0|this.nextpc,this.nextpc=0|k,(0|this.fence)==(0|this.ppc)?this.delayedins_at_fence=!0:this.fence=this.ppc+4|0,this.delayedins=!0;continue;case 4:if(!this.SR_F)break;k=this.pc+(i<<6>>6),this.pc=0|this.nextpc,this.nextpc=0|k,(0|this.fence)==(0|this.ppc)?this.delayedins_at_fence=!0:this.fence=this.ppc+4|0,this.delayedins=!0;continue;case 5:break;case 6:u=i>>21&31,65536&i?(r.Debug("Error: macrc not supported\n"),r.Abort()):l[u]=(65535&i)<<16;break;case 8:553648128==(4294901760&i)?(r.Debug("Trap at "+s.ToHex(this.pc<<2)),this.Exception(D,this.group0[o])):this.Exception(w,this.group0[o]);break;case 9:this.nextpc=this.GetSPR(c)>>2,this.fence=0|this.ppc,this.SetFlags(this.GetSPR(h));break;case 17:k=l[i>>11&31]>>2,this.pc=0|this.nextpc,this.nextpc=0|k,(0|this.fence)==(0|this.ppc)?this.delayedins_at_fence=!0:this.fence=this.ppc+4|0,this.delayedins=!0;continue;case 18:k=l[i>>11&31]>>2,l[9]=(this.nextpc<<2)+4|0,this.pc=0|this.nextpc,this.nextpc=0|k,(0|this.fence)==(0|this.ppc)?this.delayedins_at_fence=!0:this.fence=this.ppc+4|0,this.delayedins=!0;continue;case 27:if(l[32]=l[i>>16&31]+(i<<16>>16),0!=(3&l[32])&&(r.Debug("Error in lwa: no unaligned access allowed"),r.Abort()),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;this.EA=l[33],l[i>>21&31]=l[33]>0?m[l[33]>>2]:v.Read32Big(l[33]);break;case 33:if(l[32]=l[i>>16&31]+(i<<16>>16),0!=(3&l[32])&&(r.Debug("Error in lwz: no unaligned access allowed"),r.Abort()),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=l[33]>0?m[l[33]>>2]:v.Read32Big(l[33]);break;case 35:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read8Big(l[33]);break;case 36:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read8Big(l[33])<<24>>24;break;case 37:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read16Big(l[33]);break;case 38:if(l[32]=l[i>>16&31]+(i<<16>>16),l[33]=this.DTLBLookup(l[32],!1),l[33]==-1)break;l[i>>21&31]=v.Read16Big(l[33])<<16>>16;break;
case 39:a=i<<16>>16,d=l[i>>16&31],u=i>>21&31,l[u]=d+a,this.SR_CY=l[u]>>>0<d>>>0;break;case 40:a=i<<16>>16,d=l[i>>16&31],u=i>>21&31,l[u]=(d+a|0)+(this.SR_CY?1:0)|0,this.SR_CY?this.SR_CY=l[u]>>>0<=d>>>0:this.SR_CY=l[u]>>>0<d>>>0;break;case 41:l[i>>21&31]=l[i>>16&31]&(65535&i);break;case 42:l[i>>21&31]=l[i>>16&31]|65535&i;break;case 43:d=l[i>>16&31],l[i>>21&31]=d^i<<16>>16;break;case 44:u=i>>21&31,d=l[i>>16&31],l[u]=d*(i<<16>>16)&4294967295;var j=65535&d,A=65535&i;l[u]=4294901760&l[u]|j*A&65535;break;case 45:l[i>>21&31]=this.GetSPR(l[i>>16&31]|65535&i);break;case 46:switch(i>>6&3){case 0:l[i>>21&31]=l[i>>16&31]<<(31&i);break;case 1:l[i>>21&31]=l[i>>16&31]>>>(31&i);break;case 2:l[i>>21&31]=l[i>>16&31]>>(31&i);break;default:r.Debug("Error: opcode 2E function not implemented"),r.Abort()}break;case 47:switch(a=i<<16>>16,i>>21&31){case 0:this.SR_F=l[i>>16&31]==a;break;case 1:this.SR_F=l[i>>16&31]!=a;break;case 2:this.SR_F=l[i>>16&31]>>>0>a>>>0;break;case 3:this.SR_F=l[i>>16&31]>>>0>=a>>>0;break;case 4:this.SR_F=l[i>>16&31]>>>0<a>>>0;break;case 5:this.SR_F=l[i>>16&31]>>>0<=a>>>0;break;case 10:this.SR_F=l[i>>16&31]>a;break;case 11:this.SR_F=l[i>>16&31]>=a;break;case 12:this.SR_F=l[i>>16&31]<a;break;case 13:this.SR_F=l[i>>16&31]<=a;break;default:r.Debug("Error: sf...i not supported yet"),r.Abort()}break;case 48:if(a=2047&i|i>>10&63488,this.SetSPR(l[i>>16&31]|a,l[i>>11&31]),this.idle&&(this.idle=!1,0==this.raise_interrupt&&!(this.TTMR&1<<28)))return this.pc=0|this.nextpc,this.nextpc=this.nextpc+1|0,0|e;break;case 50:switch(d=i>>16&31,f=i>>11&31,p=i>>21&31,255&i){case 0:b[p]=b[d]+b[f];break;case 1:b[p]=b[d]-b[f];break;case 2:b[p]=b[d]*b[f];break;case 3:b[p]=b[d]/b[f];break;case 4:b[p]=l[d];break;case 5:l[p]=b[d];break;case 7:b[p]+=b[d]*b[f];break;case 8:this.SR_F=b[d]==b[f];break;case 9:this.SR_F=b[d]!=b[f];break;case 10:this.SR_F=b[d]>b[f];break;case 11:this.SR_F=b[d]>=b[f];break;case 12:this.SR_F=b[d]<b[f];break;case 13:this.SR_F=b[d]<=b[f];break;default:r.Debug("Error: lf. function "+s.ToHex(255&i)+" not supported yet"),r.Abort()}break;case 51:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,3&l[32]&&(r.Debug("Error in swa: no aligned memory access"),r.Abort()),l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;if(this.SR_F=l[33]==this.EA,this.EA=-1,0==this.SR_F)break;l[33]>0?m[l[33]>>2]=l[i>>11&31]:v.Write32Big(l[33],l[i>>11&31]);break;case 53:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,3&l[32]&&(r.Debug("Error in sw: no aligned memory access"),r.Abort()),l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;l[33]>0?m[l[33]>>2]=l[i>>11&31]:v.Write32Big(l[33],l[i>>11&31]);break;case 54:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;v.Write8Big(l[33],l[i>>11&31]);break;case 55:if(a=(i>>10&63488|2047&i)<<16>>16,l[32]=l[i>>16&31]+a,l[33]=this.DTLBLookup(l[32],!0),l[33]==-1)break;v.Write16Big(l[33],l[i>>11&31]);break;case 56:switch(d=l[i>>16&31],f=l[i>>11&31],u=i>>21&31,975&i){case 0:l[u]=d+f,this.SR_CY=l[u]>>>0<d>>>0;break;case 1:l[u]=d+f+(this.SR_CY?1:0),this.SR_CY?this.SR_CY=l[u]>>>0<=d>>>0:this.SR_CY=l[u]>>>0<d>>>0;break;case 2:l[u]=d-f,this.SR_CY=f>>>0>d>>>0;break;case 3:l[u]=d&f;break;case 4:l[u]=d|f;break;case 5:l[u]=d^f;break;case 8:l[u]=d<<(31&f);break;case 12:l[u]=d<<16>>16;break;case 14:l[u]=this.SR_F?d:f;break;case 72:l[u]=d>>>(31&f);break;case 76:l[u]=d<<24>>24;break;case 15:for(l[u]=0,n=0;n<32;n++)if(d&1<<n){l[u]=n+1;break}break;case 136:l[u]=d>>(31&f);break;case 271:for(l[u]=0,n=31;n>=0;n--)if(d&1<<n){l[u]=n+1;break}break;case 774:l[u]=(0|d)*(0|f);var j=65535&d,A=65535&f;l[u]=4294901760&l[u]|j*A&65535;break;case 778:this.SR_OV=0==f,this.SR_OV||(l[u]=(d>>>0)/(f>>>0));break;case 777:this.SR_OV=0==f,this.SR_OV||(l[u]=d/f);break;default:r.Debug("Error: op38 opcode not supported yet"),r.Abort()}break;case 57:switch(i>>21&31){case 0:this.SR_F=l[i>>16&31]==l[i>>11&31];break;case 1:this.SR_F=l[i>>16&31]!=l[i>>11&31];break;case 2:this.SR_F=l[i>>16&31]>>>0>l[i>>11&31]>>>0;break;case 3:this.SR_F=l[i>>16&31]>>>0>=l[i>>11&31]>>>0;break;case 4:this.SR_F=l[i>>16&31]>>>0<l[i>>11&31]>>>0;break;case 5:this.SR_F=l[i>>16&31]>>>0<=l[i>>11&31]>>>0;break;case 10:this.SR_F=l[i>>16&31]>l[i>>11&31];break;case 11:this.SR_F=l[i>>16&31]>=l[i>>11&31];break;case 12:this.SR_F=l[i>>16&31]<l[i>>11&31];break;case 13:this.SR_F=l[i>>16&31]<=l[i>>11&31];break;default:r.Debug("Error: sf.... function supported yet"),r.Abort()}break;default:r.Debug("Error: Instruction with opcode "+s.ToHex(i>>>26)+" not supported"),r.Abort()}this.oldpc=0|this.pc,this.pc=0|this.nextpc,this.nextpc=this.nextpc+1|0}return 0},i.exports=t}()}),define("cjs!jor1k/worker/or1k/index",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!../imul","cjs!./fastcpu","cjs!./safecpu","cjs!./smpcpu","cjs!./dynamic/dynamiccpu"],function(e,t,i){!function(){function t(e,t,i,r){var s={DebugMessage:a.Debug,abort:a.Abort,imul:Math.imul||o,Read32:t.Read32Big.bind(t),Write32:t.Write32Big.bind(t),Read16:t.Read16Big.bind(t),Write16:t.Write16Big.bind(t),Read8:t.Read8Big.bind(t),Write8:t.Write8Big.bind(t)};return"asm"===e?(null===f&&(f=c(l,s,i),f.Init()),f):"smp"===e?(null===p&&(p=u(l,s,i),p.Init(r)),p):void 0}function r(e,i,r,s){var a=null;if("safe"===e)return new h(i);if("dynamic"===e)return new d(i);if("asm"===e)return a=t(e,i,r,s),a.Init(),a;if("smp"===e)return a=t(e,i,r,s),a.Init(s),a;throw new Error("invalid CPU name:"+e)}function s(e,t,i,s){return this.cpu=r(e,t,i,s),this.name=e,this.ncores=s,this.ram=t,this.heap=i,this.littleendian=!1,this}var a=e("cjs!../messagehandler"),n=e("cjs!../utils").ToHex,o=e("cjs!../imul"),c=e("cjs!./fastcpu"),h=e("cjs!./safecpu"),u=e("cjs!./smpcpu"),d=e("cjs!./dynamic/dynamiccpu"),f=null,p=null,l={Int32Array:Int32Array,Float32Array:Float32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Math:Math};s.prototype.toString=function(){var e=new Uint32Array(this.heap),t="";t+="Current state of the machine\n",t+="PC: "+n(this.cpu.pc<<2)+"\n",t+="next PC: "+n(this.cpu.nextpc<<2)+"\n";for(var i=0;i<32;i+=4)t+="   r"+(i+0)+": "+n(e[i+0])+"   r"+(i+1)+": "+n(e[i+1])+"   r"+(i+2)+": "+n(e[i+2])+"   r"+(i+3)+": "+n(e[i+3])+"\n";return this.cpu.delayedins&&(t+="delayed instruction\n"),t+=this.cpu.SR_SM?"Supervisor mode\n":"User mode\n",this.cpu.SR_TEE&&(t+="tick timer exception enabled\n"),this.cpu.SR_IEE&&(t+="interrupt exception enabled\n"),this.cpu.SR_DME&&(t+="data mmu enabled\n"),this.cpu.SR_IME&&(t+="instruction mmu enabled\n"),this.cpu.SR_LEE&&(t+="little endian enabled\n"),this.cpu.SR_CID&&(t+="context id enabled\n"),this.cpu.SR_F&&(t+="flag set\n"),this.cpu.SR_CY&&(t+="carry set\n"),this.cpu.SR_OV&&(t+="overflow set\n"),t};var b=["Reset","Step","RaiseInterrupt","Step","AnalyzeImage","GetTicks","GetTimeToNextInterrupt","ProgressTime","ClearInterrupt"];b.forEach(function(e){s.prototype[e]=function(){return this.cpu[e].apply(this.cpu,arguments)}}),i.exports=s}()}),define("cjs!jor1k/worker/dev/uart",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t,i){this.intno=i,this.intdev=t,this.id=e,this.verboseuart=!1,r.Register("tty"+e,this.ReceiveChar.bind(this)),this.Reset()}var r=e("cjs!../messagehandler"),s=(e("cjs!../utils"),0),a=0,n=0,o=1,c=1,h=2,u=2,d=3,f=4,p=5,l=6,b=1,v=32,m=64,k=30,g=8,R=4,y=2,S=1,w=0,D=1,T=2,x=6,E=12,I=128,j=128,A=32,_=16,C=["DataTerminalReady","RTS","AuxOut1","AuxOut2","Loopback","Autoflow"],M=["FIFO enable","Reset","XMIT-FIFO-Reset","DMA-Mode","Reserved","Reserved","RecrTrig(LSB)","RecrTrig(MSB)"],L=["WordLen","WordLen","StopBits","Parity","EvenParity","StickParity","Break","DivisorLatch"],q=["DeltaCTS","DeltaDataSetReady","DeltaRingIndicator","DeltaCarrierDetect","ClearToSend","DataSetReady","RingIndicator","CarrierDetect"],U=["RxDataAvail","OverrunErr","ParityErr","FrameErr","BreakSignal","TxEmpty","TxEmptyLine","BadRxFifoData"],F=["RxAvailableI","TxEmptyI","BreakI","MSI"];t.prototype.ToBitDescription=function(e,t){e&=255;for(var i=("00000000"+e.toString(2)).substr(-8)+":",r=0;r<t.length;r++)i+=" "+t[r]+":"+(e>>r&1);return i},t.prototype.Reset=function(){this.LCR=3,this.LSR=m|v,this.MSR=j|A|_,this.ints=0,this.IIR=D,this.IER=0,this.DLL=0,this.DLH=0,this.FCR=0,this.MCR=0,this.rxbuf=new Array,this.txbuf=new Array},t.prototype.Step=function(){0!=this.txbuf.length&&(r.Send("tty"+this.id,this.txbuf),this.txbuf=new Array)},t.prototype.ReceiveChar=function(e){e.forEach(function(e){this.rxbuf.push(255&e)}.bind(this)),this.verboseuart&&r.Debug("Received bytes: "+this.rxbuf.length),this.rxbuf.length>0&&(this.LSR|=b,this.ThrowInterrupt(E))},t.prototype.CheckInterrupt=function(){this.verboseuart&&r.Debug("Check Interrupt "+this.ints),this.LSR&k&&this.IER&R?(this.IIR=x,this.verboseuart&&r.Debug("IIR_RLSI "+this.intno),this.intdev.RaiseInterrupt(this.intno)):this.ints&1<<E&&this.IER&S?(this.IIR=E,this.verboseuart&&r.Debug("IIR_CTI "+this.intno),this.intdev.RaiseInterrupt(this.intno)):this.ints&1<<T&&this.IER&y?(this.IIR=T,this.verboseuart&&r.Debug("IIR_THRI "+this.intno),this.intdev.RaiseInterrupt(this.intno)):this.ints&1<<w&&this.IER&g?(this.IIR=w,this.verboseuart&&r.Debug("IIR_MSI "+this.intno),this.intdev.RaiseInterrupt(this.intno)):(this.IIR=D,this.verboseuart&&r.Debug("IIR_NO_INT "+this.intno),this.intdev.ClearInterrupt(this.intno))},t.prototype.ThrowInterrupt=function(e){this.ints|=1<<e,this.CheckInterrupt()},t.prototype.ClearInterrupt=function(e){this.ints&=~(1<<e),this.CheckInterrupt()},t.prototype.ReadReg8=function(e){if(this.LCR&I)switch(e){case n:return this.DLL;case o:return this.DLH}switch(e){case s:var t=0;return this.rxbuf.length>0&&(t=this.rxbuf.shift()),this.verboseuart&&r.Debug("Get RXBUF"),0==this.rxbuf.length&&(this.LSR&=~b,this.ClearInterrupt(E)),255&t;case c:return 15&this.IER;case l:var t=this.MSR;return this.MSR&=240,this.verboseuart&&r.Debug("Get UART_MSR "+this.ToBitDescription(t,q)),t;case h:var t=15&this.IIR|192;return this.IIR==T&&this.ClearInterrupt(T),t;case d:return this.LCR;case p:return this.verboseuart&&r.Debug("Get UART_LSR "+this.ToBitDescription(this.LSR,U)),this.LSR;default:r.Debug("Error in ReadRegister: not supported"),r.Abort()}},t.prototype.WriteReg8=function(e,t){if(t&=255,this.LCR&I)switch(e){case n:return void(this.DLL=t);case o:return void(this.DLH=t)}switch(e){case a:this.LSR&=~m,this.LSR&=~v,this.txbuf.push(t),this.verboseuart&&r.Debug("send "+t),this.LSR|=m|v,this.ThrowInterrupt(T);break;case c:this.IER=15&t,this.ints&=~(1<<y),this.verboseuart&&r.Debug("Set UART_IER "+this.ToBitDescription(t,F)),this.CheckInterrupt();break;case u:this.verboseuart&&r.Debug("Set UART_FCR "+this.ToBitDescription(t,M)),this.FCR=201&t,2&t&&(this.ClearInterrupt(E),this.rxbuf=new Array),4&t&&(this.txbuf=new Array,this.ClearInterrupt(T));break;case d:this.verboseuart&&r.Debug("Set UART_LCR "+this.ToBitDescription(t,L)),3!=(3&this.LCR)&&r.Debug("Warning in UART: Data word length other than 8 bits are not supported"),this.LCR=t;break;case f:this.verboseuart&&r.Debug("Set UART_MCR "+this.ToBitDescription(t,C)),this.MCR=t;break;default:r.Debug("Error in WriteRegister: not supported"),r.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/irq",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.intdev=e,this.regs=new Uint32Array(64),this.Reset()}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=1<<30;t.prototype.Reset=function(){for(var e=0;e<64;e++)this.regs[e]=0},t.prototype.ReadReg32=function(e){return e>>=2,e>64?(r.Debug("IRQDev: Unknown ReadReg32: "+s.ToHex(e)),0):this.regs[e]},t.prototype.WriteReg32=function(e,t){if(e>>=2,e>64)return void r.Debug("IRQDev: unknown  WriteReg32: "+s.ToHex(e)+": "+s.ToHex(t));var i=e>>1;if(1&e)r.Debug("Error in IRQDev: Write STAT of CPU "+i+" : "+s.ToHex(t));else{this.regs[e]=t;var n=65535&t,o=t>>16&16383,c=t>>30&3;if(1&c){if(o==i&&r.Debug("Warning in IRQDev: Try to raise its own IRQ"),this.regs[(o<<1)+1]&a){r.Debug("Warning in IRQDev: CPU "+i+" raised irq on cpu "+o+" without previous acknowledge");var h=new Int32Array(this.intdev.heap);r.Debug("The pc of cpu "+o+" is "+s.ToHex(h[(o<<15)+292>>2])),r.Debug("The IEE flag of cpu "+o+" is "+(4&h[(o<<15)+288>>2])),r.Debug("r9 of cpu "+o+" is "+s.ToHex(h[(o<<15)+36>>2]))}this.regs[(o<<1)+1]=a|(16383&i)<<16|n,this.intdev.RaiseSoftInterrupt(1,o)}2&c&&(this.regs[e+1]&=~a,this.intdev.ClearSoftInterrupt(1,i))}},i.exports=t}()}),define("cjs!jor1k/worker/dev/timer",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(){this.Reset()}var r=e("cjs!../messagehandler");t.prototype.Reset=function(){this.sync=0},t.prototype.ReadReg32=function(e){return this.sync},t.prototype.WriteReg32=function(e,t){r.Debug("Error in Timer: Write reg "+e+" : "+t)},i.exports=t}()}),define("cjs!jor1k/worker/dev/framebuffer",["require","exports","module","cjs!../utils","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.ram=e,this.width=640,this.height=400,this.addr=16e6,this.n=this.width*this.height>>1,this.buffer=new Int32Array(this.n),s.Register("GetFB",this.OnGetFB.bind(this))}var r=e("cjs!../utils"),s=e("cjs!../messagehandler");t.prototype.Reset=function(){},t.prototype.ReadReg32=function(e){return 0},t.prototype.WriteReg32=function(e,t){switch(e){case 20:this.addr=r.Swap32(t);break;default:return}},t.prototype.OnGetFB=function(){s.Send("GetFB",this.GetBuffer())},t.prototype.GetBuffer=function(){var e=0,t=this.buffer.length,i=this.buffer,r=this.ram.int32mem,s=this.addr>>2;for(e=0;e<t;++e)i[e]=r[s+e];return this.buffer},i.exports=t}()}),define("cjs!jor1k/worker/dev/ethmac",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t,i){this.ram=e,this.intdev=t,this.TransmitCallback=function(e){},this.toTxStat=function(e){return{LEN:e>>>16,RD:e>>>15&1,IRQ:e>>>14&1,WR:e>>>13&1,PAD:e>>>12&1,CRC:e>>>11&1,UR:e>>>8&1,RTRY:e>>>4&15,RL:e>>>3&1,LC:e>>>2&1,DF:e>>>1&1,CS:1&e}},this.fromTxStat=function(e){var t=e.LEN<<16;return t|=(1&e.RD)<<15,t|=(1&e.IRQ)<<14,t|=(1&e.WR)<<13,t|=(1&e.PAD)<<12,t|=(1&e.CRC)<<11,t|=(1&e.UR)<<8,t|=(15&e.RTRY)<<4,t|=(1&e.RL)<<3,t|=(1&e.LC)<<2,t|=(1&e.CDF)<<1,t|=1&e.CS},this.toRxStat=function(e){return{LEN:e>>>16,E:e>>>15&1,IRQ:e>>>14&1,WR:e>>>13&1,CF:e>>>8&1,M:e>>>7&1,OR:e>>>6&1,IS:e>>>5&1,DN:e>>>4&1,TL:e>>>3&1,SF:e>>>2&1,CRC:e>>>1&1,LC:1&e}},this.fromRxStat=function(e){var t=e.LEN<<16;return t|=(1&e.E)<<15,t|=(1&e.IRQ)<<14,t|=(1&e.WR)<<13,t|=(1&e.CF)<<8,t|=(1&e.M)<<7,t|=(1&e.OR)<<6,t|=(1&e.IS)<<5,t|=(1&e.DN)<<4,t|=(1&e.TL)<<3,t|=(1&e.SF)<<2,t|=(1&e.CRC)<<1,t|=1&e.LC},this.makeCRCTable=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t},this.crcTable=this.makeCRCTable(),this.crc32=function(e,t,i){var r=-1,s=4;e instanceof Uint16Array||e instanceof Int16Array?s=2:(e instanceof Uint8Array||e instanceof Int8Array)&&(s=1),i||(i=e.length),t||(t=0);for(var a=0,n=t;n<i;n++)a=255&e[n],r=r>>>8^this.crcTable[255&(r^a)],s>1&&(a=e[n]>>>8&255,r=r>>>8^this.crcTable[255&(r^a)],s>2&&(a=e[n]>>>16&255,r=r>>>8^this.crcTable[255&(r^a)],a=e[n]>>>24&255,r=r>>>8^this.crcTable[255&(r^a)]));return(r^-1)>>>0},this.Reset=function(){this.MODER=40960,this.INT_SOURCE=0,this.INT_MASK=0,this.IPGT=18,this.IPGR1=12,this.IPGR2=18,this.PACKETLEN=4195840,this.COLLCONF=983103,this.TX_BD_NUM=64,this.CTRLMODER=0,this.MIIMODER=100,this.MIICOMMAND=0,this.MIIADDRESS=0,this.MIITX_DATA=0,this.MIIRX_DATA=34,this.MIISTATUS=0,this.MAC_ADDR0|=Math.floor(256*Math.random())<<24,this.MAC_ADDR0|=Math.floor(256*Math.random())<<16,this.MAC_ADDR0|=Math.floor(256*Math.random())<<8,this.MAC_ADDR0|=Math.floor(256*Math.random()),this.MAC_ADDR1|=Math.floor(256*Math.random())<<8&254|2,this.MAC_ADDR1|=Math.floor(256*Math.random()),this.ETH_HASH0_ADR=0,this.ETH_HASH1_ADR=0,this.ETH_TXCTRL=0,this.BD=new Uint32Array(256);for(var e=0;e<256;e++)this.BD[e]=0;this.MIIregs=new Uint16Array(16),this.MIIregs[E]=256,this.MIIregs[I]=30756,this.MIIregs[j]=8192,this.MIIregs[A]=23696,this.MIIregs[_]=481,this.MIIregs[C]=0,this.currRX=this.TX_BD_NUM<<1},this.Receive=function(t){if(0!=(1&this.MODER)){var i=new Uint8Array(t),r=!1,s=!1,a=!1,n=0,o=0;n|=i[2]<<24,n|=i[3]<<16,n|=i[4]<<8,n|=i[5],o|=i[0]<<8,o|=i[1],n==this.MAC_ADDR0&&o==this.MAC_ADDR1?s=!0:32768&o&&(a=!0),32&this.MODER&&(r=!0);var c=this.currRX;if(r||a||s){var h=!1;if(32768&this.BD[c]){var u=this.toRxStat(this.BD[c]);s||a||!r||(u.M=1),u.DN=0,i.length>(65535&this.PACKETLEN)&&16384&this.MODER?u.TL=1:u.TL=0,0==u.DN&&(u.CRC=0);var d=0;if(d|=i[i.length-4]<<24,d|=i[i.length-3]<<16,d|=i[i.length-2]<<8,d|=i[i.length-1],!h){u.LEN=i.length;u.LEN>(65535&this.PACKETLEN)&&(u.LEN=65535&this.PACKETLEN);for(var f=this.BD[c+1],p=0;p<u.LEN;p++)e.Write8(f+p,i[p]);u.LEN+=4,u.E=0}this.BD[c]=this.fromRxStat(u),u.IRQ&&(h&&(this.INT_SOURCE|=8),this.INT_SOURCE|=4,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4))}else this.INT_SOURCE|=16,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);8192&this.BD[this.currRX]||this.currRX+2>=this.BD.length?this.currRX=this.TX_BD_NUM<<1:this.currRX+=2}}},this.Transmit=function(t){if(0!=(2&this.MODER)){var i=this.toTxStat(this.BD[t<<1]),r=this.BD[(t<<1)+1];if(0!=i.RD){var s=i.LEN,a=!1;i.CRC||8192&this.MODER;var n=!1;(i.PAD||32768&this.MODER)&&(n=!0,this.PACKETLEN>>>16>i.LEN&&(s=this.PACKETLEN>>>16));for(var o=new Uint8Array(s),c=0;c<o.length;c++)c<i.LEN?o[c]=e.Read8(r+c):o[c]=0;if(a){var h=0;h=4096&this.MODER?this.crc32(o,4,o.length-4):this.crc32(o,0,o.length-4),o[o.length-1]=h>>24,o[o.length-2]=h>>16&255,o[o.length-3]=h>>8&255,o[o.length-4]=255&h}this.TransmitCallback(o.buffer),i.UR=0,i.RTRY=0,i.RL=0,i.LC=0,i.DF=0,i.CS=0,i.RD=0,this.BD[t<<1]=this.fromTxStat(i),this.INT_SOURCE|=1,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4)}}},this.ReadReg32=function(e){var t=0;switch(e){case s:t=this.MODER;break;case a:t=this.INT_SOURCE;break;case n:t=this.INT_MASK;break;case o:t=this.IPGT;break;case c:t=this.IPGR1;break;case h:t=this.IPGR2;break;case u:t=this.PACKETLEN;break;case d:t=this.COLLCONF;break;case f:t=this.TX_BD_NUM;break;case p:t=this.CTRLMODER;break;case l:t=this.MIIMODER;break;case b:t=this.MIICOMMAND;break;case v:t=this.MIIADDRESS;break;case m:t=this.MIITX_DATA;break;case k:t=this.MIIRX_DATA;break;case g:t=this.MIISTATUS;break;case R:t=this.MAC_ADDR0;break;case y:t=this.MAC_ADDR1;break;case S:t=this.ETH_HASH0_ADR;break;case w:t=this.ETH_HASH1_ADR;break;case D:t=this.ETH_TXCTRL;break;default:e>=T&&e<=x?t=this.BD[e-T>>>2]:r.Debug("Attempt to access ethmac register beyond 0x800")}return t},this.HandleMIICommand=function(){var e=31&this.MIIADDRESS,t=this.MIIADDRESS>>8&31,i=0;switch(this.MIICOMMAND){case 0:break;case 1:break;case 2:e!=i?this.MIIRX_DATA=65535:this.MIIRX_DATA=this.MIIregs[t];break;case 4:break;default:r.Debug("Error in ethmac: Unknown mii command detected")}},this.WriteReg32=function(e,t){switch(e){case s:this.MODER=t;break;case a:this.INT_SOURCE=this.INT_SOURCE&~t,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);break;case n:this.INT_MASK=t,this.INT_MASK&this.INT_SOURCE?this.intdev.RaiseInterrupt(4):this.intdev.ClearInterrupt(4);break;case o:this.IPGT=t;break;case c:this.IPGR1=t;break;case h:this.IPGR2=t;break;case u:this.PACKETLEN=t;break;case d:this.COLLCONF=t;break;case f:this.TX_BD_NUM=t,this.currRX=t<<1;break;case p:this.CTRLMODER=t;break;case l:this.MIIMODER=t;break;case b:this.MIICOMMAND=t,this.HandleMIICommand();break;case v:this.MIIADDRESS=t;break;case m:this.MIITX_DATA=t;break;case k:this.MIIRX_DATA=t;break;case g:this.MIISTATUS=t;break;case R:this.MAC_ADDR0=t;break;case y:this.MAC_ADDR1=t;break;case S:this.ETH_HASH0_ADR=t;break;case w:this.ETH_HASH1_ADR=t;break;case D:this.ETH_TXCTRL=t;break;default:if(e>=T&&e<=x){this.BD[e-T>>>2]=t;var i=e-T>>>3;(i<<3)+T==e&&0!=(32768&t)&&i<this.TX_BD_NUM&&this.Transmit(i)}else r.Debug("Attempt to access ethmac register beyond 0x800")}},this.Reset(),r.Register("ethmac",this.Receive.bind(this))}var r=e("cjs!../messagehandler"),s=(e("cjs!../utils"),0),a=4,n=8,o=12,c=16,h=20,u=24,d=28,f=32,p=36,l=40,b=44,v=48,m=52,k=56,g=60,R=64,y=68,S=72,w=76,D=80,T=1024,x=2047,E=0,I=1,j=2,A=3,_=4,C=25;i.exports=t}()}),define("cjs!jor1k/worker/dev/ata",["require","exports","module","cjs!../utils","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.intdev=e;var t=new ArrayBuffer(512);this.identifybuffer=new Uint16Array(t),this.Reset();var t=new ArrayBuffer(65536);this.SetBuffer(t)}var r=e("cjs!../utils"),s=e("cjs!../messagehandler"),a=4,n=8,o=12,c=16,h=20,u=24,d=28,f=a,p=d,l=4,b=2,v=128,m=64,k=16,g=8;t.prototype.Reset=function(){this.DCR=8,this.DR=160,this.SCR=1,this.SNR=1,this.SR=m,this.FR=0,this.ER=1,this.CR=0,this.lcyl=0,this.hcyl=0,this.select=160,this.driveselected=!0,this.readbuffer=this.identifybuffer,this.readbufferindex=0,this.readbuffermax=256},t.prototype.SetBuffer=function(e){this.diskbuffer=new Uint16Array(e),this.heads=16,this.sectors=64,this.cylinders=e.byteLength/(this.heads*this.sectors*512),this.nsectors=this.heads*this.sectors*this.cylinders,this.BuildIdentifyBuffer(this.identifybuffer)},t.prototype.BuildIdentifyBuffer=function(e){for(var t=0;t<256;t++)e[t]=0;e[0]=64,e[1]=this.cylinders,e[3]=this.heads,e[4]=512*this.sectors,e[5]=512,e[6]=this.sectors,e[20]=3,e[21]=512,e[22]=4,e[27]=27247,e[28]=29233,e[29]=27437,e[30]=25705,e[31]=29547;for(var t=32;t<=46;t++)e[t]=8224;e[47]=32896,e[48]=0,e[49]=512,e[51]=512,e[52]=512,e[54]=this.cylinders,e[55]=this.heads,e[56]=this.sectors,e[57]=this.nsectors>>0&65535,e[58]=this.nsectors>>16&65535,e[59]=0,e[60]=this.nsectors>>0&65535,e[61]=this.nsectors>>16&65535,e[80]=6,e[82]=16384,e[83]=16384,e[84]=16384,e[85]=16384,e[86]=0,e[87]=16384},t.prototype.ReadReg8=function(e){if(!this.driveselected)return 255;switch(e){case a:return this.ER;case n:return this.SNR;case o:return this.SCR;case c:return this.lcyl;case h:return this.hcyl;case u:return this.DR;case d:return this.intdev.ClearInterrupt(15),this.SR;case 256:return this.SR;default:s.Debug("ATADev: Error in ReadRegister8: register "+r.ToHex(e)+" not supported"),s.Abort()}return 0},t.prototype.GetSector=function(){return 64&this.DR||(s.Debug("ATADev: CHS mode not supported"),s.Abort()),(15&this.DR)<<24|this.hcyl<<16|this.lcyl<<8|this.SCR},t.prototype.SetSector=function(e){64&this.DR||(s.Debug("ATADev: CHS mode not supported"),s.Abort()),this.SCR=255&e,this.lcyl=e>>8&255,this.hcyl=e>>16&255,this.DR=240&this.DR|e>>24&15},t.prototype.ExecuteCommand=function(){switch(this.CR){case 236:this.readbuffer=this.identifybuffer,this.readbufferindex=0,this.readbuffermax=256,this.SR=m|k|g,this.DCR&b||this.intdev.RaiseInterrupt(15);break;case 145:this.SR=m|k,this.ER=0,this.DCR&b||this.intdev.RaiseInterrupt(15);break;case 32:case 48:var e=this.GetSector();0==this.SNR&&(this.SNR=256),this.readbuffer=this.diskbuffer,this.readbufferindex=256*e,this.readbuffermax=this.readbufferindex+256,this.SR=m|k|g,this.ER=0,32==this.CR&&(this.DCR&b||this.intdev.RaiseInterrupt(15));break;case 196:case 197:var e=this.GetSector();0==this.SNR&&(this.SNR=256),this.readbuffer=this.diskbuffer,this.readbufferindex=256*e,this.readbuffermax=this.readbufferindex+256*this.SNR,this.SR=m|k|g,this.ER=0,196==this.CR&&(this.DCR&b||this.intdev.RaiseInterrupt(15));break;default:s.Debug("ATADev: Command "+r.ToHex(this.CR)+" not supported"),s.Abort()}},t.prototype.WriteReg8=function(e,t){if(e==u)return this.DR=t,void(this.driveselected=!(t>>4&1));if(256==e)return!(t&l)&&this.DCR&l?(this.DR&=240,this.SR=m|k,this.SCR=1,this.SNR=1,this.lcyl=0,this.hcyl=0,this.ER=1,this.CR=0):t&l&&!(this.DCR&l)&&(this.ER=1,this.SR=v|k),void(this.DCR=t);if(this.driveselected)switch(e){case f:this.FR=t;break;case n:this.SNR=t;break;case o:this.SCR=t;break;case c:this.lcyl=t;break;case h:this.hcyl=t;break;case p:this.CR=t,this.ExecuteCommand();break;default:s.Debug("ATADev: Error in WriteRegister8: register "+r.ToHex(e)+" not supported (value: "+r.ToHex(t)+")"),s.Abort()}},t.prototype.ReadReg16=function(e){0!=e&&(s.Debug("ATADev: Error in ReadRegister16: register "+r.ToHex(e)+" not supported"),s.Abort());var t=r.Swap16(this.readbuffer[this.readbufferindex]);return this.readbufferindex++,this.readbufferindex>=this.readbuffermax&&(this.SR=m|k,32==this.CR&&this.SNR>1&&(this.SNR--,this.SetSector(this.GetSector()+1),this.readbuffermax+=256,this.SR=m|k|g,this.DCR&b||this.intdev.RaiseInterrupt(15))),t},t.prototype.WriteReg16=function(e,t){0!=e&&(s.Debug("ATADev: Error in WriteRegister16: register "+r.ToHex(e)+" not supported"),s.Abort()),this.readbuffer[this.readbufferindex]=r.Swap16(t),this.readbufferindex++,this.readbufferindex>=this.readbuffermax&&(this.SR=m|k,this.DCR&b||this.intdev.RaiseInterrupt(15),48==this.CR&&this.SNR>1&&(this.SNR--,this.SetSector(this.GetSector()+1),this.readbuffermax+=256,this.SR=m|k|g))},t.prototype.ReadReg32=function(e){s.Debug("ATADev: Error in ReadRegister32: register "+r.ToHex(e)+" not supported"),this.mesage.Abort()},t.prototype.WriteReg32=function(e,t){s.Debug("ATADev: Error in WriteRegister32: register "+r.ToHex(e)+" not supported"),s.Abort()},i.exports=t}()}),define("cjs!jor1k/worker/dev/rtc",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.intdev=e,this.Reset()}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=0,n=8,o=16,c=20,h=24;t.prototype.Reset=function(){this.ctrl=0},t.prototype.ReadReg32=function(e){switch(e){case a:return Math.floor((new Date).getTime()/1e3);case o:return this.ctrl;case h:return 3049340711;case n:return 0;case c:return 0;default:return r.Debug("RTC: unknown ReadReg32: "+s.ToHex(e)),0}return 0},t.prototype.WriteReg32=function(e,t){switch(e){case o:this.ctrl=t;break;default:return void r.Debug("RTC: unknown  WriteReg32: "+s.ToHex(e)+": "+s.ToHex(t))}},i.exports=t}()}),define("cjs!jor1k/worker/dev/touchscreen",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.intdev=e,this.Reset(),r.Register("tsmousedown",this.onmousedown.bind(this)),r.Register("tsmouseup",this.onmouseup.bind(this)),r.Register("tsmousemove",this.onmousemove.bind(this))}var r=e("cjs!../messagehandler"),s=(e("cjs!../utils"),0),a=4,n=8,o=12,c=16,h=20,u=24,d=28,f=32,p=36,l=40,b=44,v=48,m=52,k=56,g=60,R=1,y=128,S=1<<31;t.prototype.Reset=function(){this.control=0,this.status=y,this.ispressed=!1,this.mousemovecount=0,this.fifo=0,this.fifosize=0},t.prototype.onmousedown=function(e){if(this.control&R){var t=e.x,i=e.y;this.status&=~y,this.fifosize=4,this.fifo=0,this.fifo|=(1023-t&1023)<<16,this.fifo|=1023-i&1023,this.ispressed=!0,this.intdev.RaiseInterrupt(9)}},t.prototype.onmousemove=function(e){if(this.control&R&&this.ispressed&&(this.mousemovecount++,!(3&this.mousemovecount))){var t=e.x,i=e.y;this.status&=~y,this.fifosize=4,this.fifo=0,this.fifo|=(1023-t&1023)<<16,this.fifo|=1023-i&1023,this.intdev.RaiseInterrupt(9)}},t.prototype.onmouseup=function(e){if(this.control&R){e.x,e.y;this.status&=~y,this.fifosize=0,this.fifo=S,this.ispressed=!1,this.intdev.RaiseInterrupt(9)}},t.prototype.ReadReg32=function(e){switch(e){case n:return this.control;case s:return this.intdev.ClearInterrupt(9),this.status;case o:return this.fifosize<=0&&(this.status|=y),this.fifosize--,this.fifo}return 0},t.prototype.WriteReg32=function(e,t){switch(e){case n:return void(this.control=t);case a:case p:case l:case b:case v:case m:case k:case g:case h:case c:case d:case f:case u:return}},i.exports=t}()}),define("cjs!jor1k/worker/dev/keyboard",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.intdev=e,r.Register("keydown",this.OnKeyDown.bind(this)),r.Register("keyup",this.OnKeyUp.bind(this)),this.Reset()}var r=e("cjs!../messagehandler"),s=[0,0,0,0,0,0,0,0,14,15,0,0,0,28,0,0,42,29,56,119,58,0,0,0,0,0,0,1,0,0,0,0,57,104,109,107,102,105,103,106,108,0,0,0,0,110,111,0,11,2,3,4,5,6,7,8,9,10,0,39,,13,0,0,0,30,48,46,32,18,33,34,35,23,36,37,38,50,49,24,25,16,19,31,20,22,47,17,45,21,44,0,0,0,0,0,82,79,80,81,75,76,77,71,72,73,55,77,0,12,83,181,59,60,61,62,63,64,65,66,67,68,87,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,69,70,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,0,0,0,0,39,13,51,12,52,53,40,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,43,27,40,0,0,0,0,0,0,0];t.prototype.Reset=function(){this.key=0,this.fifo=[]},t.prototype.OnKeyDown=function(e){this.key=0|s[e.keyCode],0!=this.key&&(this.fifo.push(this.key),this.intdev.RaiseInterrupt(5))},t.prototype.OnKeyUp=function(e){this.key=s[e.keyCode],0!=this.key&&(this.key=128|this.key,this.fifo.push(this.key),this.intdev.RaiseInterrupt(5))},t.prototype.ReadReg8=function(e){var t=this.fifo.shift();return 0==this.fifo.length&&this.intdev.ClearInterrupt(5),t},i.exports=t}()}),define("cjs!jor1k/worker/dev/sound",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t){r.Debug("Start sound"),this.intdev=e,this.ramdev=t,this.Reset()}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=0,n=4,o=8,c=12,h=16,u=20,d=24,f=28;t.prototype.Reset=function(){this.addr=0,this.status=0,this.periods=0,this.period_size=0,this.rate=22050,this.channels=1,this.offset=0,this.playing=!1,this.nextperiod=0,this.starttime=0,this.lasttotalframe=0},t.prototype.GetTimeToNextInterrupt=function(){return this.playing?1e3*this.nextperiod/this.rate:-1},t.prototype.Progress=function(){},t.prototype.Elapsed=function(){var e=new Int8Array(this.period_size),t=this.periods*this.period_size;if(1==this.format)for(var i=0;i<this.period_size;i++)e[i]=this.ramdev.uint8mem[this.addr+(this.offset++<<0^3)]-128,this.offset==t&&(this.offset=0);else for(var i=0;i<this.period_size;i++)e[i]=this.ramdev.sint8mem[this.addr+1+(this.offset++<<1^3)],this.offset==t&&(this.offset=0);r.Send("sound",e)},t.prototype.ReadReg32=function(e){switch(e){case a:return this.intdev.ClearInterrupt(7),this.Elapsed(),this.playing?1:0;case h:return this.offset;default:return r.Debug("Sound: unknown ReadReg32: "+s.ToHex(e)),0}return 0},t.prototype.WriteReg32=function(e,t){switch(e){case a:this.playing=!!t,this.nextperiod=this.period_size,this.starttime=s.GetMilliseconds(),this.lasttotalframe=0,this.offset=0,r.Send("sound.rate",this.rate),this.Elapsed();break;case n:this.addr=t;break;case o:this.periods=t;break;case c:this.period_size=t;break;case u:this.rate=t;break;case d:this.channels=t;break;case f:this.format=t;break;default:return void r.Debug("sound: unknown  WriteReg32: "+s.ToHex(e)+": "+s.ToHex(t))}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio",["require","exports","module","cjs!../utils","cjs!./virtio/marshall","cjs!../messagehandler"],function(e,t,i){!function(){function t(e,t,i,r){for(var s=0;s<r;s++)t[s]=e.Read8(i+s)}function r(e,t,i,r){this.dev=r,this.dev.SendReply=this.SendReply.bind(this),this.intdev=e,this.intno=t,this.ramdev=i,this.queuenum=new Uint32Array(16),this.queueready=new Uint32Array(16),this.queuepfn=new Uint32Array(16),this.descaddr=new Uint32Array(16),this.usedaddr=new Uint32Array(16),this.availaddr=new Uint32Array(16),this.lastavailidx=new Uint32Array(16),this.version=2,this.Reset()}var s=e("cjs!../utils"),a=e("cjs!./virtio/marshall"),n=e("cjs!../messagehandler"),o=0,c=4,h=8,u=12,d=16,f=20,p=32,l=36,b=40,v=48,m=52,k=56,g=60,R=64,y=68,S=80,w=96,D=100,T=112,x=128,E=132,I=144,j=148,A=160,_=164,C=252,M=2,L=4;r.prototype.Reset=function(){this.status=0,this.intstatus=0,this.pagesize=8192,this.align=8192,this.availidx=0,this.hostfeaturewordselect=0,this.queuesel=0;for(var e=0;e<16;e++)this.queueready[e]=0,this.queuenum[e]=16,this.queuepfn[e]=0,this.descaddr[e]=0,this.usedaddr[e]=0,this.availaddr[e]=0,this.lastavailidx[e]=0},r.prototype.UpdateAddr=function(){if(1==this.version){var e=this.queuesel;if(this.descaddr[e]=this.queuepfn[e]*this.pagesize,this.availaddr[e]=this.descaddr[e]+16*this.queuenum[e],
this.usedaddr[e]=this.availaddr[e]+2+2+2*this.queuenum[e]+2,this.usedaddr[e]&this.align-1){var t=~(this.align-1);this.usedaddr[e]=(this.usedaddr[e]&t)+this.align}this.lastavailidx[e]=this.ramdev.Read16Little(this.availaddr[e]+2)}},r.prototype.ReadReg8=function(e){return this.dev.configspace[e-256]},r.prototype.ReadReg16=function(e){return"little"==this.ramdev.nativeendian?this.dev.configspace[e-256+1]<<8|this.dev.configspace[e-256]:this.dev.configspace[e-256]<<8|this.dev.configspace[e-256+1]},r.prototype.WriteReg8=function(e,t){this.dev.WriteConfig(e-256,t)},r.prototype.ReadReg32=function(e){var t=0;if(e>=256)return this.dev.configspace[e-256+0]<<24|this.dev.configspace[e-256+1]<<16|this.dev.configspace[e-256+2]<<8|this.dev.configspace[e-256+3]<<0;switch(e){case o:t=1953655158;break;case c:t=this.version;break;case h:t=this.dev.deviceid;break;case u:t=4294967295;break;case d:t=0,0==this.hostfeaturewordselect?t=this.dev.hostfeature:1==this.hostfeaturewordselect&&(t=1);break;case m:t=this.queuenum[this.queuesel];break;case R:t=this.queuepfn[this.queuesel];break;case y:t=this.queueready[this.queuesel];break;case w:t=this.intstatus;break;case T:t=this.status;break;case C:t=0;break;default:n.Debug("Error in VirtIODev: Attempt to read register "+s.ToHex(e)),n.Abort()}return"little"==this.ramdev.nativeendian?t:s.Swap32(t)},r.prototype.GetDescriptor=function(e,i){var r=this.descaddr[e]+16*i,s=new Uint8Array(16);t(this.ramdev,s,r,16);var n=a.Unmarshall(["d","w","h","h"],s,0);return{addr:n[0],len:n[1],flags:n[2],next:n[3]}},r.prototype.ConsumeDescriptor=function(e,t,i){var r=this.usedaddr[e]+2,s=this.ramdev.Read16Little(r);this.ramdev.Write16Little(r,s+1);var a=this.usedaddr[e]+4+8*(s&this.queuenum[e]-1);this.ramdev.Write32Little(a+0,t),this.ramdev.Write32Little(a+4,i)},r.prototype.SendReply=function(e,t){this.ConsumeDescriptor(e,t,this.dev.replybuffersize);this.ramdev.Read16Little(this.availaddr[e]);if(0==this.dev.replybuffersize)return this.intstatus=1,void this.intdev.RaiseInterrupt(this.intno);for(var i=this.GetDescriptor(e,t);0==(i.flags&M);)1&i.flags?i=this.GetDescriptor(e,i.next):(n.Debug("Error in virtiodev: Descriptor is not continuing"),n.Abort());0==(i.flags&M)&&(n.Debug("Error in virtiodev: Descriptor is not allowed to write"),n.Abort());for(var r=0,s=0;s<this.dev.replybuffersize;s++)r>=i.len&&(i=this.GetDescriptor(0,i.next),r=0,0==(i.flags&M)&&(n.Debug("Error in virtiodev: Descriptor is not allowed to write"),n.Abort())),this.ramdev.Write8(i.addr+r,this.dev.replybuffer[s]),r++;this.intstatus=1,this.intdev.RaiseInterrupt(this.intno)},r.prototype.GetDescriptorBufferSize=function(e,t){for(var i=0,r=0,s=this.GetDescriptor(e,t);s.flags&L&&(n.Debug("Error in VirtIO: Indirect descriptors not supported"),n.Abort()),s.flags&M?i+=s.len:r+=s.len,0!=(1&s.flags);)var s=this.GetDescriptor(e,s.next);return{write:i,read:r}},r.prototype.WriteReg32=function(e,t){switch("big"==this.ramdev.nativeendian&&(t=s.Swap32(t)),e){case b:this.pagesize=t,this.UpdateAddr();break;case f:this.hostfeaturewordselect=t;break;case l:break;case p:break;case v:this.queuesel=t;break;case k:this.queuenum[this.queuesel]=t,this.UpdateAddr();break;case g:this.align=t,this.pagesize=t,this.UpdateAddr();break;case R:this.queuepfn[this.queuesel]=t,this.UpdateAddr();break;case S:for(var i=t,r=this.ramdev.Read16Little(this.availaddr[i]+2);this.lastavailidx[i]!=r;){var a=this.lastavailidx[i]&this.queuenum[i]-1,o=this.ramdev.Read16Little(this.availaddr[t]+4+2*a),c=this.GetDescriptorBufferSize(i,o),h=0,u=this.GetDescriptor(i,o),d=function(e,t,i){return function(){t>=i.len&&(t=0,1&i.flags?i=this.GetDescriptor(e,i.next):(n.Debug("Error in virtiodev: Descriptor is not continuing"),n.Abort()));var r=this.ramdev.Read8(i.addr+t);return t++,r}.bind(this)}.bind(this)(i,h,u);this.dev.ReceiveRequest(i,o,d,c),this.lastavailidx[i]++,this.lastavailidx[i]&=65535}break;case y:this.queueready[this.queuesel]=t;break;case D:this.intstatus&=~t,this.intdev.ClearInterrupt(this.intno);break;case T:switch(this.status=t,this.status){case 0:this.intdev.ClearInterrupt(this.intno),this.intstatus=0,this.Reset();break;case 1:break;case 3:break;case 7:break;case 11:break;case 15:break;case 131:n.Debug("Error: virtio device initialization failed with status "+this.status),n.Abort();case 139:n.Debug("Error: virtio device initialization failed with status "+this.status),n.Abort();break;default:n.Debug("Error in virtio status register: Unknown status "+this.status),n.Abort()}break;case x:this.descaddr[this.queuesel]=t;break;case E:break;case I:this.availaddr[this.queuesel]=t,this.lastavailidx[this.queuesel]=this.ramdev.Read16Little(this.availaddr[this.queuesel]+2);break;case j:break;case A:this.usedaddr[this.queuesel]=t;break;case _:break;default:n.Debug("Error in VirtIODev: Attempt to write register "+s.ToHex(e)+":"+s.ToHex(t)),n.Abort()}},i.exports=r}()}),define("cjs!jor1k/worker/dev/virtio/9p",["require","exports","module","cjs!./marshall","cjs!../../messagehandler","cjs!../../utils"],function(e,t,i){!function(){function t(e,t){this.fs=t,this.SendReply=function(){},this.deviceid=9,this.hostfeature=1,this.configspace=[9,0,47,100,101,118,47,114,111,111,116],this.VERSION="9P2000.L",this.BLOCKSIZE=8192,this.msize=8192,this.replybuffer=new Uint8Array(2*this.msize),this.replybuffersize=0,this.Reset()}var r=e("cjs!./marshall"),s=e("cjs!../../messagehandler"),a=(e("cjs!../../utils"),16384),n=2,o=39,c=1,h=2,u=4,d=8,f=16,p=32,l=64,b=128,v=256,m=-1,k=1,g=2;t.prototype.Createfid=function(e,t,i){return{inodeid:e,type:t,uid:i}},t.prototype.Reset=function(){this.fids=[]},t.prototype.BuildReply=function(e,t,i){r.Marshall(["w","b","h"],[i+7,e+1,t],this.replybuffer,0),i+7>=this.replybuffer.length&&s.Debug("Error in 9p: payloadsize exceeds maximum length"),this.replybuffersize=i+7},t.prototype.SendError=function(e,t,i){var s=r.Marshall(["w"],[i],this.replybuffer,7);this.BuildReply(6,e,s)},t.prototype.ReceiveRequest=function(e,t,i){var R=r.Unmarshall2(["w","b","h"],i),y=R[0],S=R[1],w=R[2];switch(S){case 8:var y=this.fs.GetTotalSize(),D=[];D[0]=16914839,D[1]=this.BLOCKSIZE,D[2]=Math.floor(1073741824/D[1]),D[3]=D[2]-Math.floor(y/D[1]),D[4]=D[2]-Math.floor(y/D[1]),D[5]=this.fs.inodes.length,D[6]=1048576,D[7]=0,D[8]=256;var y=r.Marshall(["w","w","d","d","d","d","d","d","w"],D,this.replybuffer,7);this.BuildReply(S,w,y),this.SendReply(0,t);break;case 112:case 12:var D=r.Unmarshall2(["w","w"],i),T=D[0],x=D[1],E=this.fids[T].inodeid,I=this.fs.GetInode(E),j=this.fs.OpenInode(E,x),A=function(e,t,i,s){return function(){var a=this.fs.GetInode(e);D[0]=a.qid,D[1]=this.msize-24,r.Marshall(["Q","w"],D,this.replybuffer,7),this.BuildReply(t,i,17),this.SendReply(0,s)}.bind(this)}.bind(this)(E,S,w,t);this.fs.AddEvent(E,A);break;case 70:var D=r.Unmarshall2(["w","w","s"],i),_=D[0],T=D[1],C=D[2],I=this.fs.CreateInode(),M=this.fs.GetInode(this.fids[T].inodeid);I.mode=M.mode,I.size=M.size,I.symlink=M.symlink,I.data=new Uint8Array(I.size);for(var L=0;L<I.size;L++)I.data[L]=this.fs.ReadByte(M,L);I.name=C,I.parentid=this.fids[_].inodeid,this.fs.PushInode(I),this.BuildReply(S,w,0),this.SendReply(0,t);break;case 16:var D=r.Unmarshall2(["w","s","s","w"],i),T=D[0],C=D[1],q=D[2],U=D[3],E=this.fs.CreateSymlink(C,this.fids[T].inodeid,q),I=this.fs.GetInode(E);I.uid=this.fids[T].uid,I.gid=U,r.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(S,w,13),this.SendReply(0,t);break;case 18:var D=r.Unmarshall2(["w","s","w","w","w","w"],i),T=D[0],C=D[1],x=D[2],F=D[3],P=D[4],U=D[5],E=this.fs.CreateNode(C,this.fids[T].inodeid,F,P),I=this.fs.GetInode(E);I.mode=x,I.uid=this.fids[T].uid,I.gid=U,r.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(S,w,13),this.SendReply(0,t);break;case 22:var D=r.Unmarshall2(["w"],i),T=D[0],I=this.fs.GetInode(this.fids[T].inodeid),y=r.Marshall(["s"],[I.symlink],this.replybuffer,7);this.BuildReply(S,w,y),this.SendReply(0,t);break;case 72:var D=r.Unmarshall2(["w","s","w","w"],i),T=D[0],C=D[1],x=D[2],U=D[3],E=this.fs.CreateDirectory(C,this.fids[T].inodeid),I=this.fs.GetInode(E);I.mode=x|a,I.uid=this.fids[T].uid,I.gid=U,r.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(S,w,13),this.SendReply(0,t);break;case 14:var D=r.Unmarshall2(["w","s","w","w","w"],i),T=D[0],C=D[1],x=(D[2],D[3]),U=D[4],E=this.fs.CreateFile(C,this.fids[T].inodeid);this.fids[T].inodeid=E,this.fids[T].type=k;var I=this.fs.GetInode(E);I.uid=this.fids[T].uid,I.gid=U,I.mode=x,r.Marshall(["Q","w"],[I.qid,this.msize-24],this.replybuffer,7),this.BuildReply(S,w,17),this.SendReply(0,t);break;case 52:r.Marshall(["w"],[0],this.replybuffer,7),this.BuildReply(S,w,1),this.SendReply(0,t);break;case 24:var D=r.Unmarshall2(["w","d"],i),T=D[0],I=this.fs.GetInode(this.fids[T].inodeid);D[0]|=4096,D[0]=D[1],D[1]=I.qid,D[2]=I.mode,D[3]=I.uid,D[4]=I.gid,D[5]=I.nlinks,D[6]=I.major<<8|I.minor,D[7]=I.size,D[8]=this.BLOCKSIZE,D[9]=Math.floor(I.size/512+1),D[10]=I.atime,D[11]=0,D[12]=I.mtime,D[13]=0,D[14]=I.ctime,D[15]=0,D[16]=0,D[17]=0,D[18]=0,D[19]=0,r.Marshall(["d","Q","w","w","w","d","d","d","d","d","d","d","d","d","d","d","d","d","d","d"],D,this.replybuffer,7),this.BuildReply(S,w,153),this.SendReply(0,t);break;case 26:var D=r.Unmarshall2(["w","w","w","w","w","d","d","d","d","d"],i),T=D[0],I=this.fs.GetInode(this.fids[T].inodeid);D[1]&c&&(I.mode=D[2]),D[1]&h&&(I.uid=D[3]),D[1]&u&&(I.gid=D[4]),D[1]&b&&(I.atime=D[6]),D[1]&v&&(I.atime=D[8]),D[1]&f&&(I.atime=Math.floor((new Date).getTime()/1e3)),D[1]&p&&(I.mtime=Math.floor((new Date).getTime()/1e3)),D[1]&l&&(I.ctime=Math.floor((new Date).getTime()/1e3)),D[1]&d&&this.fs.ChangeSize(this.fids[T].inodeid,D[5]),this.BuildReply(S,w,0),this.SendReply(0,t);break;case 50:var D=r.Unmarshall2(["w","d"],i),T=D[0];this.BuildReply(S,w,0),this.SendReply(0,t);break;case 40:case 116:var D=r.Unmarshall2(["w","d","w"],i),T=D[0],B=D[1],W=D[2],I=this.fs.GetInode(this.fids[T].inodeid);if(this.fids[T].type==g){I.caps.length<B+W&&(W=I.caps.length-B);for(var L=0;L<W;L++)this.replybuffer[11+L]=I.caps[B+L]}else{I.size<B+W&&(W=I.size-B);for(var L=0;L<W;L++)this.replybuffer[11+L]=this.fs.ReadByte(I,B+L)}r.Marshall(["w"],[W],this.replybuffer,7),this.BuildReply(S,w,4+W),this.SendReply(0,t);break;case 118:var D=r.Unmarshall2(["w","d","w"],i),T=D[0],B=D[1],W=D[2];this.fs.Write(this.fids[T].inodeid,B,W,i),r.Marshall(["w"],[W],this.replybuffer,7),this.BuildReply(S,w,4),this.SendReply(0,t);break;case 74:var D=r.Unmarshall2(["w","s","w","s"],i),H=D[0],O=D[1],z=D[2],G=D[3],j=this.fs.Rename(this.fids[H].inodeid,O,this.fids[z].inodeid,G);if(0==j){this.SendError(w,"No such file or directory",n),this.SendReply(0,t);break}this.BuildReply(S,w,0),this.SendReply(0,t);break;case 76:var D=r.Unmarshall2(["w","s","w"],i),N=D[0],C=D[1],S=(D[2],this.fs.Search(this.fids[N].inodeid,C));if(S==-1){this.SendError(w,"No such file or directory",n),this.SendReply(0,t);break}var j=this.fs.Unlink(S);if(!j){this.SendError(w,"Directory not empty",o),this.SendReply(0,t);break}this.BuildReply(S,w,0),this.SendReply(0,t);break;case 100:var V=r.Unmarshall2(["w","s"],i);this.msize=V[0];var y=r.Marshall(["w","s"],[this.msize,this.VERSION],this.replybuffer,7);this.BuildReply(S,w,y),this.SendReply(0,t);break;case 104:var D=r.Unmarshall2(["w","w","s","s","w"],i),T=D[0],X=D[4];this.fids[T]=this.Createfid(0,k,X);var I=this.fs.GetInode(this.fids[T].inodeid);r.Marshall(["Q"],[I.qid],this.replybuffer,7),this.BuildReply(S,w,13),this.SendReply(0,t);break;case 108:var D=r.Unmarshall2(["h"],i);D[0];this.BuildReply(S,w,0),this.SendReply(0,t);break;case 110:var D=r.Unmarshall2(["w","w","h"],i),T=D[0],Q=D[1],K=D[2];if(0==K){this.fids[Q]=this.Createfid(this.fids[T].inodeid,k,this.fids[T].uid),this.fids[Q].inodeid=this.fids[T].inodeid,r.Marshall(["h"],[0],this.replybuffer,7),this.BuildReply(S,w,2),this.SendReply(0,t);break}for(var Y=[],L=0;L<K;L++)Y.push("s");for(var J=r.Unmarshall2(Y,i),E=this.fids[T].inodeid,B=9,Z=0,L=0;L<K&&(E=this.fs.Search(E,J[L]),E!=-1);L++)B+=r.Marshall(["Q"],[this.fs.inodes[E].qid],this.replybuffer,B),Z++,this.fids[Q]=this.Createfid(E,k,this.fids[T].uid);r.Marshall(["h"],[Z],this.replybuffer,7),this.BuildReply(S,w,B-7),this.SendReply(0,t);break;case 120:var D=r.Unmarshall2(["w"],i);this.fids[D[0]]&&this.fids[D[0]].inodeid>=0&&(this.fs.CloseInode(this.fids[D[0]].inodeid),this.fids[D[0]].inodeid=-1,this.fids[D[0]].type=m),this.BuildReply(S,w,0),this.SendReply(0,t);break;case 30:var D=r.Unmarshall2(["w","w","s"],i),T=D[0],$=D[1],C=D[2];this.fids[$]=this.Createfid(this.fids[T].inodeid,m,this.fids[T].uid);var ee=0;"security.capability"==C&&(ee=this.fs.PrepareCAPs(this.fids[T].inodeid),this.fids[$].type=g),r.Marshall(["d"],[ee],this.replybuffer,7),this.BuildReply(S,w,8),this.SendReply(0,t);break;default:s.Debug("Error in Virtio9p: Unknown id "+S+" received"),s.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/dummy",["require","exports","module","cjs!../../messagehandler","cjs!../../utils"],function(e,t,i){!function(){function t(e){this.configspace=[0],this.deviceid=0,this.hostfeature=0,this.Reset()}e("cjs!../../messagehandler"),e("cjs!../../utils");t.prototype.Reset=function(){},t.prototype.ReceiveRequest=function(e,t){},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/input",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=new Uint8Array(256),this.deviceid=18,this.hostfeature=0,r.Register("virtio.kbd.keydown",this.OnKeyDown.bind(this)),r.Register("virtio.kbd.keyup",this.OnKeyUp.bind(this)),this.replybuffersize=8,this.replybuffer=new Uint8Array(8),this.Reset()}var r=e("cjs!../../messagehandler"),s=(e("cjs!../../utils"),e("cjs!./marshall")),a=0,n=1,o=2,c=3,h=16,u=17,d=18,f=1,p=20;t.prototype.Reset=function(){this.receivebufferdesc=new Array},t.prototype.OnKeyDown=function(e){if(0!=this.receivebufferdesc.length){var t=this.receivebufferdesc[0];this.receivebufferdesc.shift(),this.replybuffersize=8,s.Marshall(["h","h","w"],[f,e.keyCode,1],this.replybuffer,0),this.SendReply(0,t.idx)}},t.prototype.OnKeyUp=function(e){if(0!=this.receivebufferdesc.length){var t=this.receivebufferdesc[0];this.receivebufferdesc.shift(),this.replybuffersize=8,s.Marshall(["h","h","w"],[f,e.keyCode,0],this.replybuffer,0),this.SendReply(0,t.idx)}},t.prototype.WriteConfig=function(e,t){if(this.configspace[e]=t,1==e)switch(this.configspace[0]){case a:break;case n:this.configspace[2]=5,this.configspace[8]=86,this.configspace[9]=75,this.configspace[10]=66,this.configspace[11]=68,this.configspace[12]=0;break;case o:this.configspace[2]=0,this.configspace[8]=0;break;case c:this.configspace[2]=0;break;case h:this.configspace[2]=0;break;case u:switch(this.configspace[1]){case p:this.configspace[2]=0;break;case f:this.configspace[2]=16,this.configspace[8]=255,this.configspace[9]=255,this.configspace[10]=255,this.configspace[11]=255,this.configspace[12]=255,this.configspace[13]=255,this.configspace[14]=255,this.configspace[15]=255,this.configspace[16]=255,this.configspace[17]=255,this.configspace[18]=255,this.configspace[19]=255,this.configspace[20]=255,this.configspace[21]=255,this.configspace[22]=255,this.configspace[22]=255;break;default:this.configspace[2]=0}break;case d:this.configspace[2]=0,r.Debug("Virtioinput: abs_info not implemented"),r.Abort();break;default:r.Debug("Error in virtio input: Unknown config"),r.Abort()}},t.prototype.ReceiveRequest=function(e,t,i,s){if(e>=1&&(r.Debug("Error in Virtio input: Unsupported queue index"),r.Abort()),0==e){for(var a=0;a<this.receivebufferdesc.length;a++)if(this.receivebufferdesc[a].idx==t)return;return void this.receivebufferdesc.push({idx:t,size:s})}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/net",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=[0,0,0,0,0,0],this.deviceid=1,this.hostfeature=32,this.replybuffer=new Uint8Array(65550),this.replybuffersize=0;for(var t=1;t<6;t++)this.configspace[t]=Math.floor(256*Math.random());r.Register("ethmac",this.Receive.bind(this)),this.Reset()}var r=e("cjs!../../messagehandler"),s=(e("cjs!../../utils"),e("cjs!./marshall"));t.prototype.Reset=function(){this.receivebufferdesc=new Array,this.receivebuffer=new Array},t.prototype.Receive=function(e){this.receivebuffer.push(e),this.HandleReceive()},t.prototype.HandleReceive=function(){if(0!=this.receivebuffer.length&&0!=this.receivebufferdesc.length){var e=new Uint8Array(this.receivebuffer[0]),t=this.receivebufferdesc[0];e.length>t.size.write&&(r.Debug("Error in VirtioNET: Received packet is larger than the next receive buffer"),r.Abort()),this.receivebuffer.shift(),this.receivebufferdesc.shift(),this.replybuffersize=e.length+12,s.Marshall(["b","b","h","h","h","h","h"],[0,0,0,0,0,0,0],this.replybuffer,0);for(var i=0;i<e.length;i++)this.replybuffer[i+12]=e[i];this.SendReply(0,t.idx)}},t.prototype.ReceiveRequest=function(e,t,i,a){if(e>1&&(r.Debug("Error in VirtioNET: Unsupported ringbuffer"),r.Abort()),0==e){for(var n=0;n<this.receivebufferdesc.length;n++)if(this.receivebufferdesc[n].idx==t)return;return this.receivebufferdesc.push({idx:t,size:a}),void this.HandleReceive()}for(var o=(s.Unmarshall2(["b","b","h","h","h","h","h"],i),new Uint8Array(a.read-12)),n=0;n<a.read-12;n++)o[n]=i();r.Send("ethmac",o.buffer),this.replybuffersize=0,this.SendReply(e,t)},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/block",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.blocks=100,this.configspace=[this.blocks>>0&255,this.blocks>>8&255,this.blocks>>16&255,0,0,0,0,0],this.deviceid=2,this.hostfeature=0,this.replybuffer=new Uint8Array(65536),this.replybuffersize=0,this.buffer=new Uint8Array(512*this.blocks),this.Reset()}var r=e("cjs!../../messagehandler"),s=(e("cjs!../../utils"),e("cjs!./marshall")),a=0,n=1,o=4,c=5,h=0;t.prototype.Reset=function(){},t.prototype.ReceiveRequest=function(e,t,i,u){var d=s.Unmarshall2(["w","w","d"],i),f=d[0],p=d[2];switch(f){case a:u.write>65536&&(r.Debug("Error in virtioblock: replybuffer too small"),r.Abort());for(var l=0;l<u.write-1;l++)this.replybuffer[l]=this.buffer[512*p+l];this.replybuffersize=u.write,this.replybuffer[u.write-1]=h,this.SendReply(0,t);break;case n:for(var l=0;l<u.read-16;l++)this.buffer[512*p+l]=i();this.replybuffersize=1,this.replybuffer[0]=h,this.SendReply(0,t);break;case o:break;case c:break;default:r.Debug("Error in VirtioBlock: Unknown request type "+f),r.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/gpu",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],this.deviceid=16,this.hostfeature=0,this.replybuffersize=0,this.replybuffer=new Uint8Array(1024),this.Reset()}var r=e("cjs!../../messagehandler"),s=e("cjs!../../utils"),a=e("cjs!./marshall"),n=256,o=257,c=258,h=259,u=262,d=263,f=4352,p=4353;t.prototype.Reset=function(){this.resource=new Array},t.prototype.ReplyOk=function(e){a.Marshall(["w","w","d","w","w"],[f,0,0,0,0],this.replybuffer,0),this.replybuffersize=24,this.SendReply(0,e)},t.prototype.ReceiveRequest=function(e,t,i,f){r.Debug(""),r.Debug("Virtio GPU request of ringbuffer "+e+" "+t+" "+f.read+" "+f.write),0!=e&&(r.Debug("Error in virtio gpu: queue no. "+e+" unknown"),r.Abort());var l=a.Unmarshall2(["w","w","d","w","w"],i),b=l[0],v=l[3];switch(r.Debug("type: "+b+" flags: "+l[1]+" fence: "+l[2]+" ctx_id: "+v),l[0]){case n:a.Marshall(["w","w","d","w","w"],[p,0,0,0,0],this.replybuffer,0);for(var m=0;m<408;m++)this.replybuffersize[m]=0;a.Marshall(["w","w","w","w","w","w"],[0,0,1024,768,1,0],this.replybuffer,24),r.Debug("get display info"),this.replybuffersize=408,this.SendReply(e,t);break;case o:var l=a.Unmarshall2(["w","w","w","w"],i),k=l[0],g=l[2],R=l[3],y=l[1];0==k&&r.Debug("Error in virtio gpu: resource_id is 0"),this.resource[k]={valid:!0,width:g,height:R,format:y,addr:0,length:0,scanout_id:-1},r.Debug("create 2d: "+g+"x"+R+" format: "+y+" resource_id: "+l[0]),this.ReplyOk(t);break;case c:var l=a.Unmarshall2(["w"],i),k=l[0];this.resource[k].valid=!1,r.Debug("resource unref: resource_id: "+l[0]),this.ReplyOk(t);break;case u:var l=a.Unmarshall2(["w","w"],i),S=l[1],k=l[0];r.Debug("attach backing: resource_id: "+k+" nr_entries:"+l[1]);for(var m=0;m<S;m++){var l=a.Unmarshall2(["d","w","w"],i);r.Debug("attach backing: addr:"+s.ToHex(l[0])+" length: "+l[1]),this.resource[k].addr=l[0],this.resource[k].length=l[1]}this.ReplyOk(t);break;case d:var l=a.Unmarshall2(["w"],i),k=l[0];r.Debug("detach backing: resource_id: "+k),this.resource[k].addr=0,this.resource[k].length=0,this.ReplyOk(t);break;case h:var l=a.Unmarshall2(["w","w","w","w","w","w"],i),w=l[0],D=l[1],g=l[2],R=l[3],T=l[4],k=l[5];r.Debug("set scanout: x: "+w+" y: "+D+" width: "+g+" height: "+R+" scanout_id: "+T+" resource_id: "+k),0!=k&&(this.resource[k].scanout_id=T),this.ReplyOk(t);break;default:r.Debug("Error in virtio gpu: Unknown type "+b),r.Abort()}},i.exports=t}()}),define("cjs!jor1k/worker/dev/virtio/console",["require","exports","module","cjs!../../messagehandler","cjs!../../utils","cjs!./marshall"],function(e,t,i){!function(){function t(e){this.configspace=[80,0,24,0,1,0,0,0],this.deviceid=3,this.hostfeature=0,this.replybuffersize=0,this.replybuffer=new Uint8Array(8),this.Reset()}var r=e("cjs!../../messagehandler"),s=(e("cjs!../../utils"),e("cjs!./marshall")),a=0;t.prototype.Receive=function(e){},t.prototype.Reset=function(){},t.prototype.ReceiveRequest=function(e,t,i,n){if(r.Debug("Virtio console request of ringbuffer "+e+" "+t+" "+n.read+" "+n.write),1==e){for(var o="",c=0;c<n.read;c++)o+=String.fromCharCode(i());r.Debug("Write: "+o),this.replybuffersize=0,this.SendReply(e,t)}if(3==e){var h=s.Unmarshall2(["w","h","h"],i),u=h[0],d=h[1],f=h[2];switch(r.Debug("virtio console: "+u+" "+d+" "+f),d){case a:this.replybuffersize=0,this.SendReply(e,t);break;default:r.Debug("Error in virtio console: Unknown event"),r.Abort()}}},i.exports=t}()}),define("cjs!jor1k/worker/init_openrisc",["require","exports","module","cjs!./messagehandler","cjs!./utils","cjs!./or1k","cjs!./dev/uart","cjs!./dev/irq","cjs!./dev/timer","cjs!./dev/framebuffer","cjs!./dev/ethmac","cjs!./dev/ata","cjs!./dev/rtc","cjs!./dev/touchscreen","cjs!./dev/keyboard","cjs!./dev/sound","cjs!./dev/virtio","cjs!./dev/virtio/9p","cjs!./dev/virtio/dummy","cjs!./dev/virtio/input","cjs!./dev/virtio/net","cjs!./dev/virtio/block","cjs!./dev/virtio/gpu","cjs!./dev/virtio/console"],function(e,t,i){!function(){function t(e,t){r.Debug("Init OpenRISC SoC");var i=e;try{e.cpu=new s(t.cpu,e.ram,e.heap,e.ncores)}catch(m){r.Debug("Error: failed to create CPU:"+m)}e.devices.push(e.cpu),e.irqdev=new n(i),e.timerdev=new o,e.uartdev0=new a(0,i,2),e.uartdev1=new a(1,i,3),e.ethdev=new h(e.ram,i),e.ethdev.TransmitCallback=function(e){r.Send("ethmac",e)},e.fbdev=new c(e.ram),e.atadev=new u(i),e.tsdev=new f(i),e.kbddev=new p(i),e.snddev=new l(i,e.ram),e.rtcdev=new d(i),e.virtiodummydev=new v(e.ram),e.virtiodev1=new b(i,6,e.ram,e.virtio9pdev),e.virtiodev2=new b(i,11,e.ram,e.virtiodummydev),e.virtiodev3=new b(i,12,e.ram,e.virtiodummydev),e.devices.push(e.irqdev),e.devices.push(e.timerdev),e.devices.push(e.uartdev0),e.devices.push(e.uartdev1),e.devices.push(e.ethdev),e.devices.push(e.fbdev),e.devices.push(e.atadev),e.devices.push(e.tsdev),e.devices.push(e.kbddev),e.devices.push(e.snddev),e.devices.push(e.rtcdev),e.devices.push(e.virtio9pdev),e.devices.push(e.virtiodev1),e.devices.push(e.virtiodev2),e.devices.push(e.virtiodev3),e.devices.push(e.virtiodummydev),e.ram.AddDevice(e.uartdev0,2415919104,7),e.ram.AddDevice(e.fbdev,2432696320,4096),e.ram.AddDevice(e.ethdev,2449473536,4096),e.ram.AddDevice(e.tsdev,2466250752,4096),e.ram.AddDevice(e.kbddev,2483027968,256),e.ram.AddDevice(e.uartdev1,2516582400,7),e.ram.AddDevice(e.virtiodev1,2533359616,4096),e.ram.AddDevice(e.snddev,2550136832,1024),e.ram.AddDevice(e.rtcdev,2566914048,4096),e.ram.AddDevice(e.irqdev,2583691264,4096),e.ram.AddDevice(e.timerdev,2600468480,4096),e.ram.AddDevice(e.virtiodev2,2617245696,4096),e.ram.AddDevice(e.virtiodev3,2634022912,4096),e.ram.AddDevice(e.atadev,2650800128,4096)}var r=e("cjs!./messagehandler"),s=(e("cjs!./utils"),e("cjs!./or1k")),a=e("cjs!./dev/uart"),n=e("cjs!./dev/irq"),o=e("cjs!./dev/timer"),c=e("cjs!./dev/framebuffer"),h=e("cjs!./dev/ethmac"),u=e("cjs!./dev/ata"),d=e("cjs!./dev/rtc"),f=e("cjs!./dev/touchscreen"),p=e("cjs!./dev/keyboard"),l=e("cjs!./dev/sound"),b=e("cjs!./dev/virtio"),v=(e("cjs!./dev/virtio/9p"),e("cjs!./dev/virtio/dummy"));e("cjs!./dev/virtio/input"),e("cjs!./dev/virtio/net"),e("cjs!./dev/virtio/block"),e("cjs!./dev/virtio/gpu"),e("cjs!./dev/virtio/console");i.exports=t}()}),define("cjs!jor1k/worker/riscv/disassemble",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e,t,i,u){switch(r.Debug("pc="+s.ToHex(u)+" ins="+s.ToHex(e)),127&e){case 3:switch(e>>12&7){case 0:r.Debug("lb");break;case 1:r.Debug("lh");break;case 2:r.Debug("lw");break;case 4:r.Debug("lbu");break;case 5:r.Debug("lhu");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 35:switch(e>>12&7){case 0:r.Debug("sb");break;case 1:r.Debug("sh");break;case 2:r.Debug("sw");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 19:switch(e>>12&7){case 0:r.Debug("addi");break;case 2:r.Debug("slti");break;case 3:r.Debug("sltiu");break;case 4:r.Debug("xori");break;case 6:r.Debug("ori");break;case 7:r.Debug("andi");break;case 1:r.Debug("slli");break;case 5:0==(e>>25&127)?r.Debug("srli"):32==(e>>25&127)&&r.Debug("srai");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 51:switch(e>>25&127){case 0:switch(e>>12&7){case 0:r.Debug("add");break;case 2:r.Debug("slt");break;case 3:r.Debug("sltu");break;case 7:r.Debug("and");break;case 6:r.Debug("or");break;case 4:r.Debug("xor");break;case 1:r.Debug("sll");break;case 5:r.Debug("srl")}break;case 32:switch(e>>12&7){case 0:r.Debug("sub");break;case 5:r.Debug("sra")}break;case 1:switch(e>>12&7){case 0:r.Debug("mul");break;case 1:r.Debug("mulh");break;case 2:r.Debug("mulhsu");break;case 3:r.Debug("mulhu");break;case 4:r.Debug("div");break;case 5:r.Debug("divu");break;case 6:r.Debug("rem");break;case 7:r.Debug("remu")}break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 55:r.Debug("Lui");break;case 23:r.Debug("auipc");break;case 111:r.Debug("jal");break;case 103:r.Debug("jalr");break;case 99:switch(e>>12&7){case 0:r.Debug("beq");break;case 1:r.Debug("bne");break;case 4:r.Debug("blt");break;case 5:r.Debug("bge");break;case 6:r.Debug("bltu");break;case 7:r.Debug("bgeu");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 115:switch(e>>12&7){case 1:r.Debug("csrrw");break;case 2:r.Debug("csrrs");break;case 3:r.Debug("csrrc - "+s.ToHex(e));break;case 5:r.Debug("csrrwi - "+s.ToHex(e));break;case 6:r.Debug("csrrsi - "+s.ToHex(e));break;case 7:r.Debug("csrrci - "+s.ToHex(e));break;case 0:switch(e>>20&4095){case 0:var d=(6&i[h])>>1;switch(d){case a:r.Debug("ecall PRV_U -"+s.ToHex(e));break;case n:r.Debug("ecall PRV_S -"+s.ToHex(e));break;case o:r.Debug("Not supported ecall PRV_H -"+s.ToHex(e));break;case c:r.Debug("ecall PRV_M -"+s.ToHex(e));break;default:r.Debug("Error in ecall: Don't know how to handle privilege level "+d)}break;case 1:r.Debug("ebreak - "+s.ToHex(e)+" at PC"+s.ToHex(this.pc));break;case 256:var d=(6&i[h])>>1;if(d<n){r.Debug("Error in eret: current_privilege_level isn't allowed access");break}switch(d){case n:r.Debug("eret PRV_S -"+s.ToHex(e));break;case o:r.Debug("Not supported eret PRV_H -"+s.ToHex(e));break;case c:r.Debug("eret PRV_M -"+s.ToHex(e));break;default:r.Debug("Error in eret: Don't know how to handle privilege level "+d)}break;case 773:if(d!=c){r.Debug("Error in mrts: current_privilege_level isn't allowed access");break}r.Debug("mrts - "+s.ToHex(e));break;case 288:r.Debug("sfence.vma - "+s.ToHex(e));break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 7:switch(e>>12&7){case 2:r.Debug("flw - "+s.ToHex(e));break;case 3:r.Debug("fld");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 39:switch(e>>12&7){case 2:r.Debug("fsw");break;case 3:r.Debug("fsw");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 83:switch(e>>25&127){case 0:r.Debug("fadd.s");break;case 4:r.Debug("fsub.s");break;case 96:r.Debug("fcvt.w.s");break;case 1:r.Debug("fadd.d");break;case 5:r.Debug("fsub.d");break;case 97:r.Debug("fcvt.w.s");break;case 120:r.Debug("fmv.s.x");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+"not found")}break;case 47:switch(e>>27&31){case 1:r.Debug("amoswap");break;case 0:r.Debug("amoadd");break;case 4:r.Debug("amoxor");break;case 12:r.Debug("amoand");break;case 8:r.Debug("amoor");break;case 16:r.Debug("amomin");break;case 20:r.Debug("amomax");break;case 24:r.Debug("amominu");break;case 28:r.Debug("amomaxu");break;case 2:r.Debug("lr.d");break;case 3:r.Debug("sc.d");break;default:r.Debug("Error in Atomic Memory Instruction "+s.ToHex(e)+"not found")}break;case 15:r.Debug("fence");break;default:r.Debug("Error in disassemble: Instruction "+s.ToHex(e)+" not found")}}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=0,n=1,o=2,c=3,h=768;i.exports.Disassemble=t}()}),define("cjs!jor1k/worker/riscv/safecpu",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!./disassemble"],function(e,t,i){!function(){function t(e,t){n.Debug("Initialize RISCV CPU"),this.ram=e,this.htif=t,this.r=new Int32Array(this.ram.heap,0,32),this.f=new Float64Array(this.ram.heap,128,32),this.fi=new Int32Array(this.ram.heap,128,64),this.ff=new Float32Array(this.ram.heap,0,1),this.csr=new Int32Array(this.ram.heap,8192,4096),this.Reset()}function r(e,t){var e=0|e,t=0|t;return(e&t)/(t&~(t<<1))|0}function s(e,t,i){var e=0|e,t=0|t,i=0|i;return e&~t|i*(t&~(t<<1))&t}function a(e){var t=0;if(e=0|e)for(;0==(1&e);)e>>=1,t++;return t}var n=e("cjs!../messagehandler"),o=e("cjs!../utils"),c=(e("cjs!./disassemble"),0),h=1,u=2,d=3,f=0,p=1,l=2,b=3,v=4,m=6,k=8,g=9,R=10,y=11,S=12,w=13,D=15,T=2,x=8,E=32,I=128,j=256,A=6144,_=24576,C=98304,M=131072,L=262144,q=524288,U=1048576,F=2097152,P=4194304,B=2147483648,W=0,H=2147483648,O=4194303,z=1,G=2,N=4,V=8,X=16,Q=1,K=3,Y=5,J=7,Z=9,$=12,ee=1<<Q,te=1<<K,ie=1<<Y,re=1<<J,se=1<<Z,ae=3,ne=256,oe=260,ce=261,he=262,ue=320,de=321,fe=322,pe=323,le=384,be=768,ve=769,me=770,ke=771,ge=772,Re=773,ye=774,Se=832,we=833,De=834,Te=835,xe=836,Ee=928,Ie=944,je=1953,Ae=3073,_e=3201,Ce=3137,Me=3860;t.prototype.Reset=function(){this.ticks=0,this.prv=d,this.csr[be]=0,this.csr[Me]=0,this.csr[ve]=1073746217,this.csr[De]=0,this.amoaddr=0,this.amovalue=0,this.pc=4096},t.prototype.InvalidateTLB=function(){},t.prototype.GetTimeToNextInterrupt=function(){var e=(0|this.csr[Ce])-(0|this.ticks)|0;return 0|e},t.prototype.GetTicks=function(){return 0|this.ticks},t.prototype.ProgressTime=function(e){e=0|e,this.ticks=this.ticks+e|0,this.csr[Ae]=0|this.ticks,e=this.csr[Ce]-this.ticks|0,e<=1&&(this.csr[xe]=this.csr[xe]|ie),this.CheckForInterrupt()},t.prototype.AnalyzeImage=function(){},t.prototype.RaiseInterrupt=function(e,t){e==Z&&(this.csr[xe]|=se)},t.prototype.ClearInterrupt=function(e,t){e==Z&&(this.csr[xe]&=~se)},t.prototype.CheckForInterrupt=function(){var e=this.csr[xe]&this.csr[ge],t=r(this.csr[be],x),i=this.prv<d||this.prv==d&&t?1:0,s=e&~this.csr[ke]&-i;if(0==s){var n=r(this.csr[be],T),o=this.prv<h||this.prv==h&&n?1:0;s|=e&this.csr[ke]&-o}s&&this.Trap(2147483648|a(s),this.pc,-1)},t.prototype.Trap=function(e,t,i){e=0|e,t=0|t,i=0|i;var a=e,n=this.csr[me],o=0!=(a&1<<31);if(o&&(n=this.csr[ke],
a&=~(1<<31)),this.prv<=h&&a<32&&n>>a&1){this.pc=this.csr[ce],this.csr[fe]=e,this.csr[de]=t,this.csr[pe]=i;var c=0|this.csr[be];c=0|s(c,E,r(c,T)),c=0|s(c,j,this.prv),c=0|s(c,T,0),this.csr[be]=c,this.prv=h}else{var u=1&this.csr[Re]&&o?4*a:0;this.pc=(this.csr[Re]&-2)+u,this.csr[we]=t,this.csr[De]=e,this.csr[Te]=i;var c=0|this.csr[be];c=0|s(c,I,r(c,x)),c=0|s(c,A,this.prv),c=0|s(c,x,0),this.csr[be]=c,this.prv=d}this.amoaddr=0,this.amovalue=0},t.prototype.MemAccessTrap=function(e,t){switch(t){case f:this.Trap(w,this.pc-4|0,e);break;case p:this.Trap(D,this.pc-4|0,e);break;case l:this.Trap(S,this.pc,e)}},t.prototype.CheckVMPrivilege=function(e,t){e=0|e,t=0|t;var i=this.prv==h,r=this.csr[be]&L,s=this.csr[be]&q;if(e&X){if(i&&!r)return n.Debug("Illegal access from privilege mode at pc="+o.ToHex(this.pc)+" "+t),n.Abort(),!1}else if(!i)return!1;if(!(e&z)||!(e&G)&&e&N)return!1;switch(0|t){case l:return e&V;case f:return e&G||s&&e&V;case p:return e&G&&e&N}n.Debug("Error in CheckVMPRivilege: unknown operation"),n.Abort()},t.prototype.TranslateVM=function(e,t){t=0|t,e=0|e;var i=this.csr[le]>>31&1,r=12;if(i==W||this.prv==d)return e;var s=(this.csr[le]&O)<<r,a=s+(e>>>22<<2),n=0|this.ram.Read32(a);if(1!=(15&n))return this.CheckVMPrivilege(n,t)?n>>10<<12|4194303&e:(this.MemAccessTrap(e,t),-1);s=(4294966272&n)<<2;var o=e>>12&1023,a=s+(o<<2);return n=0|this.ram.Read32(a),1==(15&n)?(this.MemAccessTrap(e,t),-1):this.CheckVMPrivilege(n,t)?n>>10<<12|4095&e:(this.MemAccessTrap(e,t),-1)},t.prototype.SetCSR=function(e,t){var i=this.csr;switch(e){case be:(t^i[be])&(A|M|L|q)&&this.InvalidateTLB();var r=T|E|x|I|j|_|M|L|A|q|F|U|P|C;i[e]=t&~r|t&r;var s=(i[be]&_)==_;s|=(i[be]&C)==C,i[be]=i[be]&~B|(s?1<<B:0);break;case ne:i[e]=t;var r=T|E|j|_|C|L|q;this.SetCSR(be,i[be]&~r|t&r);break;case ge:var r=ee|ie|se|1<<$|te|re;i[ge]=i[ge]&~r|t&r;break;case oe:i[ge]=i[ge]&~i[ke]|t&i[ke];break;case ve:i[ve]=t;break;case xe:var r=ee|ie;i[xe]=i[xe]&~r|t&r;break;case de:case we:i[e]=t;break;case pe:i[e]=t;break;case fe:i[e]=t;break;case ae:case me:case ke:case Se:case ue:i[e]=t;break;case le:this.InvalidateTLB(),i[e]=t&(O|H);break;case ce:case Re:i[e]=t&-4;break;case ye:case he:i[e]=t;break;case je:i[e]=t;break;case Ee:case Ie:i[e]=t;break;default:i[e]=t,n.Debug("Error in SetCSR: PC "+o.ToHex(this.pc)+" Address "+o.ToHex(e)+" unkown"),n.Abort()}},t.prototype.GetCSR=function(e){var t=this.csr;switch(e){case ae:return 0;case Me:return t[e];case ve:return t[e];case oe:return t[ge]&t[ke];case ge:return t[e];case de:case we:case De:case fe:case me:case ke:case be:case xe:case pe:case Te:return t[e];case ne:var i=T|E|j|_|C|L,r=t[be]&i;return(r&_)!=_&&(r&C)!=C||(r|=B),r;case Se:case ue:return t[e];case le:return t[e];case ce:case Re:return t[e];case ye:case he:return t[e];case Ae:return this.ticks;case _e:return 0;case Ee:case Ie:return 0;case je:return t[e];default:return n.Debug("Error in GetCSR: PC "+o.ToHex(this.pc)+" Address "+o.ToHex(e)+" unkown"),n.Abort(),t[e]}},t.prototype.UMul64=function(e,t){var i=[0,0];if(e>>>=0,t>>>=0,e<32767&&t<65536)return i[0]=e*t,i[1]=i[0]<0?-1:0,i;var r=65535&e,s=e>>>16,a=65535&t,n=t>>>16,o=r*a,c=(o>>>16)+s*a,h=c>>>16;c=(65535&c)+r*n,h+=c>>>16;var u=h>>>16;return h=(65535&h)+s*n,u+=h>>>16,i[0]=(65535&c)<<16|65535&o,i[1]=(65535&u)<<16|65535&h,i},t.prototype.IMul64=function(e,t){var i=[0,0];if(0==e)return i[0]=i[1]=0,i;if(0==t)return i[0]=i[1]=0,i;if(e|=0,t|=0,e>=-32768&&e<=32767&&t>=-32768&&t<=32767)return i[0]=e*t,i[1]=i[0]<0?-1:0,i;var r=e<0^t<0;return i=this.UMul64(Math.abs(e),Math.abs(t)),r&&(i[0]=~i[0],i[1]=~i[1],i[0]=i[0]+1|0,0==i[0]&&(i[1]=i[1]+1|0)),i},t.prototype.SUMul64=function(e,t){var i=[0,0];if(0==e)return i[0]=i[1]=0,i;if(0==t)return i[0]=i[1]=0,i;if(e|=0,t>>>=0,e>=-32768&&e<=32767&&t<65536)return i[0]=e*t,i[1]=i[0]<0?-1:0,i;var r=e<0;return i=this.UMul64(Math.abs(e),Math.abs(t)),r&&(i[0]=~i[0],i[1]=~i[1],i[0]=i[0]+1|0,0==i[0]&&(i[1]=i[1]+1|0)),i},t.prototype.Step=function(e,t){var i=this.r,a=this.fi,S=this.ff,w=this.f,D=this.csr,_=0,C=0,M=0,L=0,q=0,U=0,F=0,P=0,B=0,W=0,H=0,O=0,z=0,G=0,N=0,V=0;e=0|e,t=0|t;var X=0;this.n=0;do{if(i[0]=0,!(63&e)){var X=D[Ce]-this.ticks|0;this.ticks=this.ticks+t|0,D[Ae]=0|this.ticks,X<t&&(D[xe]=D[xe]|ie),this.CheckForInterrupt()}if(V=0|this.TranslateVM(this.pc,l),V!=-1)switch(N=this.ram.Read32(V),this.pc=this.pc+4|0,127&N){case 3:switch(C=N>>20,W=i[N>>15&31],_=N>>7&31,N>>12&7){case 0:if(V=0|this.TranslateVM(W+C|0,f),V==-1)break;i[_]=this.ram.Read8(V)<<24>>24;break;case 1:if(W+C&1){this.Trap(v,this.pc-4|0,W+C|0);break}if(V=0|this.TranslateVM(W+C|0,f),V==-1)break;i[_]=this.ram.Read16(V)<<16>>16;break;case 2:if(W+C&3){this.Trap(v,this.pc-4|0,W+C|0);break}if(V=0|this.TranslateVM(W+C|0,f),V==-1)break;V>>>0==2147524616&&(this.ram.Write32(V+0,this.htif.ReadToHost()),this.ram.Write32(V+4,this.htif.ReadDEVCMDToHost())),V>>>0==2147524608&&(this.ram.Write32(V+0,this.htif.ReadFromHost()),this.ram.Write32(V+4,this.htif.ReadDEVCMDFromHost())),i[_]=this.ram.Read32(V);break;case 4:if(V=0|this.TranslateVM(W+C|0,f),V==-1)break;i[_]=255&this.ram.Read8(V);break;case 5:if(W+C&1&&(n.Debug("Error in lhu: unaligned address"),n.Abort()),V=0|this.TranslateVM(W+C|0,f),V==-1)break;i[_]=65535&this.ram.Read16(V);break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 35:switch(M=N>>25,L=N>>7&31,C=M<<5|L,W=i[N>>15&31],_=N>>20&31,N>>12&7){case 0:if(V=0|this.TranslateVM(W+C|0,p),V==-1)break;this.ram.Write8(V,255&i[_]);break;case 1:if(W+C&1){this.Trap(m,this.pc-4|0,W+C|0);break}if(V=0|this.TranslateVM(W+C|0,p),V==-1)break;this.ram.Write16(V,65535&i[_]);break;case 2:if(W+C&3){this.Trap(m,this.pc-4|0,W+C|0);break}if(V=0|this.TranslateVM(W+C|0,p),V==-1)break;this.ram.Write32(V,i[_]),V>>>0==2147524620&&(this.htif.WriteDEVCMDToHost(this.ram.Read32(V)),this.htif.WriteToHost(this.ram.Read32(V-4))),V>>>0==2147524612&&(this.htif.WriteDEVCMDFromHost(this.ram.Read32(V)),this.htif.WriteFromHost(this.ram.Read32(V-4)));break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 19:switch(_=N>>7&31,W=i[N>>15&31],C=N>>20,N>>12&7){case 0:i[_]=W+C;break;case 2:W<C?i[_]=1:i[_]=0;break;case 3:W>>>0<C>>>0?i[_]=1:i[_]=0;break;case 4:i[_]=W^C;break;case 6:i[_]=W|C;break;case 7:i[_]=W&C;break;case 1:i[_]=W<<C;break;case 5:0==(N>>25&127)?i[_]=W>>>C:32==(N>>25&127)?i[_]=W>>C:(n.Debug("Error in safecpu: Instruction (sra, srl)"+o.ToHex(N)+" not found"),n.Abort());break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 51:switch(N>>25&127){case 0:switch(W=i[N>>15&31],H=i[N>>20&31],_=N>>7&31,N>>12&7){case 0:i[_]=W+H;break;case 1:i[_]=W<<(31&H);break;case 2:W<H?i[_]=1:i[_]=0;break;case 3:W>>>0<H>>>0?i[_]=1:i[_]=0;break;case 4:i[_]=W^H;break;case 5:i[_]=W>>>(31&H);break;case 6:i[_]=W|H;break;case 7:i[_]=W&H}break;case 32:switch(W=i[N>>15&31],H=i[N>>20&31],_=N>>7&31,N>>12&7){case 0:i[_]=W-H;break;case 5:i[_]=W>>(31&H);break;default:n.Debug("Error in safecpu: Instruction (sub,sra) "+o.ToHex(N)+" not found"),n.Abort()}break;case 1:switch(W=0|i[N>>15&31],H=0|i[N>>20&31],_=N>>7&31,N>>12&7){case 0:var Q=this.IMul64(W,H);i[_]=Q[0];break;case 1:var Q=this.IMul64(W,H);i[_]=Q[1];break;case 2:var Q=this.SUMul64(W,H>>>0);i[_]=Q[1];break;case 3:var Q=this.UMul64(W>>>0,H>>>0);i[_]=Q[1];break;case 4:P=0==H?-1:W/H|0,i[_]=P;break;case 5:P=0==H?-1:(W>>>0)/(H>>>0)|0,i[_]=P;break;case 6:B=0==H?0|W:W%H|0,i[_]=B;break;case 7:B=0==H?0|W:(W>>>0)%(H>>>0)|0,i[_]=B}break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 55:_=N>>7&31,i[_]=4294963200&N;break;case 23:C=4294963200&N,_=N>>7&31,i[_]=this.pc+C-4|0;break;case 111:M=N>>21&1023,L=(N>>20&1)<<10,q=(N>>12&255)<<11,U=N>>31<<19,C=(M|L|q|U)<<1,_=N>>7&31,i[_]=this.pc,this.pc=this.pc+C-4|0;break;case 103:C=N>>20,W=i[N>>15&31],_=N>>7&31,i[_]=this.pc,this.pc=W+C&4294967294;break;case 99:switch(M=N>>31<<11,L=(N>>25&63)<<4,q=N>>8&15,U=(N>>7&1)<<10,C=(M|L|q|U)<<1,W=0|i[N>>15&31],H=0|i[N>>20&31],N>>12&7){case 0:W==H&&(this.pc=this.pc+C-4|0);break;case 1:W!=H&&(this.pc=this.pc+C-4|0);break;case 4:W<H&&(this.pc=this.pc+C-4|0);break;case 5:W>=H&&(this.pc=this.pc+C-4|0);break;case 6:W>>>0<H>>>0&&(this.pc=this.pc+C-4|0);break;case 7:W>>>0>=H>>>0&&(this.pc=this.pc+C-4|0);break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 115:switch(C=N>>>20,W=i[N>>15&31],_=N>>7&31,N>>12&7){case 1:i[_]=this.GetCSR(C),this.SetCSR(C,W);break;case 2:i[_]=this.GetCSR(C),0!=W&&this.SetCSR(C,this.GetCSR(C)|W);break;case 3:i[_]=this.GetCSR(C),0!=W&&this.SetCSR(C,this.GetCSR(C)&~W);break;case 5:i[_]=this.GetCSR(C),F=N>>15&31,this.SetCSR(C,F>>0);break;case 6:i[_]=this.GetCSR(C),F=N>>15&31,0!=F&&this.SetCSR(C,this.GetCSR(C)|F>>0);break;case 7:i[_]=this.GetCSR(C),F=N>>15&31,0!=F&&this.SetCSR(C,this.GetCSR(C)&~(F>>0));break;case 0:switch(N>>20&4095){case 0:switch(this.prv){case c:this.Trap(k,this.pc-4|0,-1);break;case h:this.Trap(g,this.pc-4|0,-1);break;case u:this.Trap(R,this.pc-4|0,-1),this.Abort();break;case d:this.Trap(y,this.pc-4|0,-1);break;default:n.Debug("Error in ecall: Don't know how to handle privilege level "+privilege_mode),n.Abort()}break;case 1:this.Trap(b,this.pc-4|0,-1);break;case 258:if(this.prv!=h){n.Debug("Error in sret: privilege_mode isn't allowed access"),n.Abort();break}this.pc=0|D[de];var K=0|D[be],Y=r(K,j);K=s(K,T,r(K,E)),K=s(K,E,1),K=s(K,j,c),D[be]=K,this.prv=Y,this.InvalidateTLB();break;case 261:if(0==(D[ge]&D[xe]))return e;break;case 770:if(this.prv!=d){n.Debug("Error in mret: privilege_mode isn't allowed access"),n.Abort();break}this.pc=0|D[we];var K=0|D[be],Y=r(K,A);K=s(K,x,r(K,I)),K=s(K,I,1),K=s(K,A,c),D[be]=K,this.prv=Y,this.InvalidateTLB();break;case 288:break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 7:switch(C=N>>20,W=i[N>>15&31],_=N>>7&31,N>>12&7){case 2:if(W+C&3&&(n.Debug("Error in flw: unaligned address"),n.Abort()),V=0|this.TranslateVM(W+C|0,f),V==-1)break;i[0]=this.ram.Read32(V),w[_]=S[0];break;case 3:if(W+C&7&&(n.Debug("Error in flw: unaligned address"),n.Abort()),V=0|this.TranslateVM(W+C|0,f),V==-1)break;a[(_<<1)+0]=this.ram.Read32(V+0),a[(_<<1)+1]=this.ram.Read32(V+4);break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 39:switch(M=N>>25,L=N>>7&31,C=(M<<5)+L,W=i[N>>15&31],_=N>>20&31,N>>12&7){case 2:if(S[0]=w[_],W+C&3&&(n.Debug("Error in fsw: unaligned address"),n.Abort()),V=0|this.TranslateVM(W+C|0,p),V==-1)break;this.ram.Write32(V,i[0]);break;case 3:if(W+C&7&&(n.Debug("Error in fsd: unaligned address"),n.Abort()),V=0|this.TranslateVM(W+C|0,p),V==-1)break;this.ram.Write32(V+0,a[(_<<1)+0]),this.ram.Write32(V+4,a[(_<<1)+1]);break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 83:switch(_=N>>7&31,N>>25&127){case 0:case 1:O=w[N>>15&31],z=w[N>>20&31],w[_]=O+z;break;case 4:case 5:O=w[N>>15&31],z=w[N>>20&31],w[_]=O-z;break;case 80:case 81:switch(O=w[N>>15&31],z=w[N>>20&31],N>>12&7){case 0:O<=z?i[_]=1:i[_]=0;break;case 1:O<z?i[_]=1:i[_]=0;break;case 2:O==z?i[_]=1:i[_]=0;break;default:n.Debug("Error in safecpu: Instruction (fcmp) "+o.ToHex(N)+" not found"),n.Abort()}break;case 32:case 33:O=w[N>>15&31],w[_]=O;break;case 96:i[_]=w[N>>15&31];break;case 97:i[_]=w[N>>15&31];break;case 104:w[_]=i[N>>15&31];break;case 105:w[_]=i[N>>15&31];break;case 8:case 9:O=w[N>>15&31],z=w[N>>20&31],w[_]=O*z;break;case 12:case 13:O=w[N>>15&31],z=w[N>>20&31],w[_]=O/z;break;case 16:case 17:switch(O=w[N>>15&31],z=w[N>>20&31],N>>12&7){case 0:w[_]=z<0?-Math.abs(O):Math.abs(O);break;case 1:w[_]=z<0?Math.abs(O):-Math.abs(O);break;case 2:w[_]=z<0&&O<0||z>0&&O>0?Math.abs(O):-Math.abs(O);break;default:n.Debug("Error in safecpu: Instruction (fsgn) "+o.ToHex(N)+" not found"),n.Abort()}break;case 120:W=i[N>>15&31],i[0]=W,w[_]=S[0];break;default:n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 67:O=w[N>>15&31],z=w[N>>20&31],G=w[N>>27&31],_=N>>7&31,w[_]=O*z+G;break;case 71:O=w[N>>15&31],z=w[N>>20&31],G=w[N>>27&31],_=N>>7&31,w[_]=O*z-G;break;case 75:O=w[N>>15&31],z=w[N>>20&31],G=w[N>>27&31],_=N>>7&31,w[_]=-(O*z+G);break;case 79:O=w[N>>15&31],z=w[N>>20&31],G=w[N>>27&31],_=N>>7&31,w[_]=-(O*z-G);break;case 47:if(W=i[N>>15&31],H=i[N>>20&31],_=N>>7&31,V=0|this.TranslateVM(0|W,f),V==-1)break;switch(N>>27&31){case 1:if(i[_]=this.ram.Read32(V),V=0|this.TranslateVM(0|W,p),V==-1)break;this.ram.Write32(V,H);break;case 0:if(i[_]=this.ram.Read32(V),V=0|this.TranslateVM(0|W,p),V==-1)break;this.ram.Write32(V,i[_]+H);break;case 4:if(i[_]=this.ram.Read32(V),V=0|this.TranslateVM(0|W,p),V==-1)break;this.ram.Write32(V,i[_]^H);break;case 12:if(i[_]=this.ram.Read32(V),V=0|this.TranslateVM(0|W,p),V==-1)break;this.ram.Write32(V,i[_]&H);break;case 8:if(i[_]=this.ram.Read32(V),V=0|this.TranslateVM(0|W,p),V==-1)break;this.ram.Write32(V,i[_]|H);break;case 16:if(i[_]=this.ram.Read32(V),H>>0>i[_]>>0?i[0]=i[_]:i[0]=H,V=0|this.TranslateVM(0|W,p),V==-1)break;this.ram.Write32(V,i[0]);break;case 20:if(i[_]=this.ram.Read32(V),H<i[_]?i[0]=i[_]:i[0]=H,V=0|this.TranslateVM(W,p),V==-1)break;this.ram.Write32(V,i[0]);break;case 24:if(i[_]=this.ram.Read32(V),H>>>0>i[_]>>>0?i[0]=i[_]:i[0]=H,V=0|this.TranslateVM(W,p),V==-1)break;this.ram.Write32(V,i[0]);break;case 28:if(i[_]=this.ram.Read32(V),H>>>0<i[_]>>>0?i[0]=i[_]:i[0]=H,V=0|this.TranslateVM(W,p),V==-1)break;this.ram.Write32(V,i[0]);break;case 2:i[_]=this.ram.Read32(V),this.amoaddr=W,this.amovalue=i[_];break;case 3:if(W!=this.amoaddr){i[_]=1;break}if(this.ram.Read32(V)!=this.amovalue){i[_]=1;break}if(i[_]=0,V=0|this.TranslateVM(W,p),V==-1)break;this.ram.Write32(V,H);break;default:n.Debug("Error in Atomic Memory Instruction "+o.ToHex(N)+" not found"),n.Abort()}break;case 15:break;default:3!=(3&N)?n.Debug("Error in safecpu: Compressed Instruction "+o.ToHex(65535&N)+" not supported at "+o.ToHex(this.pc-4)):n.Debug("Error in safecpu: Instruction "+o.ToHex(N)+" not found at "+o.ToHex(this.pc-4)),n.Abort()}}while(e=e-1|0);return 0},i.exports=t}()}),define("cjs!jor1k/worker/riscv/fastcpu",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!./disassemble"],function(e,t,i){!function(){function t(e,t,i){"use asm";var r=t.DebugMessage;var s=t.abort;var a=t.Read32;var n=t.Write32;var o=t.Read16;var c=t.Write16;var h=t.Read8;var u=t.Write8;var d=t.ReadDEVCMDToHost;var f=t.ReadDEVCMDFromHost;var p=t.WriteDEVCMDToHost;var l=t.WriteDEVCMDFromHost;var b=t.ReadToHost;var v=t.ReadFromHost;var m=t.WriteToHost;var k=t.WriteFromHost;var g=t.imul;var R=e.Math.abs;var y=e.Math.floor;var S=0;var w=1;var D=2;var T=3;var x=4;var E=5;var I=6;var j=7;var A=8;var _=9;var C=10;var M=11;var L=12;var q=0x00;var U=0x01;var F=0x02;var P=0x03;var B=0;var W=1;var H=2;var O=0x80000001;var z=0x80000002;var G=0x80000000;var N=0x01;var V=0x02;var X=0x03;var Q=0x05;var K=0x07;var Y=0x08;var J=0x09;var Z=0x0A;var $=0x0B;var ee=0x3000;var te=0x2400;var ie=0x4;var re=0x8;var se=0xC;var ae=0x400;var ne=0x404;var oe=0x410;var ce=0x484;var he=0x500;var ue=0x504;var de=0x510;var fe=0x600;var pe=0x604;var le=0x904;var be=0xC00;var ve=0xC04;var me=0xC08;var ke=0xC10;var ge=0xC84;var Re=0xD84;var ye=0xD04;var Se=0xD00;var we=0xD08;var De=0xD0C;var Te=0xD10;var xe=0xD14;var Ee=0x1C04;var Ie=0x1D04;var je=0x1E08;var Ae=0x1E0C;var _e=0x1E00;var Ce=0x1E04;var Me=0x1E40;var Le=0x1E44;var qe=0x2404;var Ue=0x2408;var Fe=0x2600;var Pe=0x2604;var Be=0x2608;var We=0x2804;var He=0x3604;var Oe=0x2A04;var ze=0x3404;var Ge=0x3508;var Ne=0x350C;var Ve=0x3C00;var Xe=0x3C04;var Qe=0x3C40;var Ke=0x3200;var Ye=0x3204;var Je=0x3208;var Ze=0x3004;var $e=0x3008;var et=0x300;var tt=0x3300;var it=0x3304;var rt=0x3008;var st=0x330C;var at=0x3310;var nt=0x3314;var ot=0x3318;var ct=0x331C;var ht=0x3320;var ut=0x3324;var dt=0x3328;var ft=0x332C;var pt=0x3330;var lt=0x33334;var bt=0x33338;var vt=0x3333C;var mt=new e.Int32Array(i);var kt=0x00;var gt=new e.Float64Array(i);var Rt=0x80;var yt=new e.Int32Array(i);var St=0x80;var wt=new e.Float32Array(i);var Dt=0x00;var Tt=new e.Int32Array(i);var xt=0x2000;var Et=new e.Int32Array(i);var It=0x100000;var jt=new e.Int8Array(i);var At=new e.Int16Array(i);var _t=0x200;var Ct=0x200;var Mt=1;var Lt=0;var qt=0,Ut=0;var Ft=0x200;var Pt=0x200;var Bt=0x200;var Wt=-0x8000;var Ht=-0x8000;var Ot=-1;var zt=-1;var Gt=-1;var Nt=-1;var Vt=-1;var Xt=-1;var Qt=-1;var Kt=-1;var Yt=-1;var Jt=-1;var Zt=-1;var $t=-1;var ei=-1;var ti=-1;var ii=-1;var ri=-1;var si=-1;var ai=-1;var ni=-1;var oi=-1;var ci=-1;var hi=-1;var ui=-1;var di=-1;var fi=0;function pi(){li()}function li(){Lt=0;Tt[xt+be>>2]=0x96;Tt[xt+_e>>2]=0x780;Tt[xt+Ve>>2]=0x4112D;Tt[xt+Xe>>2]=0x01;Tt[xt+Qe>>2]=0x00;Tt[xt+ve>>2]=0x100;Tt[xt+ke>>2]=0x00;Tt[xt+ye>>2]=0x00;Tt[xt+we>>2]=0x00;Tt[xt+De>>2]=0x00;Tt[xt+ae>>2]=0x3010;Tt[xt+ne>>2]=0x00;Tt[xt+oe>>2]=0x00;Tt[xt+Ze>>2]=0x0;Tt[xt+fe>>2]=0x40000;qt=0x00;Ut=0x00}function bi(){_t=Ct+(Pt-Bt)|0;return _t|0}function vi(){var e=0x0;e=(Tt[xt+0xC84>>2]>>>0)-(Lt&0xFFFFFFFF)|0;e=e+((e|0)<0?0xFFFFFFFF:0x0)|0;return e|0}function mi(){return Lt|0}function ki(e){e=e|0;Lt=Lt+e|0}function gi(){}function Ri(){}function yi(e,t){e=e|0;t=t|0;fi=1}function Si(e,t){e=e|0;t=t|0}function wi(e,t){e=e|0;t=t|0;var i=0;var r=0x100;i=(Tt[xt+be>>2]&0x06)>>1;Mi();Tt[xt+ye>>2]=t;Tt[xt+we>>2]=e;_t=r+(i<<6)|0;Ft=Pt;Mt=1;Ci()}function Di(e,t){e=e|0;t=t|0;if((t|0)!=(H|0))_t=Ct+(Pt-Bt)|0;Tt[xt+De>>2]=e;switch(t|0){case 0:wi(Q,_t-4|0);break;case 1:wi(K,_t-4|0);break;case 2:wi(N,_t);break}}function Ti(e,t){e=e|0;t=t|0;var i=0;i=(Tt[xt+be>>2]&0x06)>>1;switch(e|0){case 2:if((t|0)==(B|0))return 1;if((i|0)==(q|0)&(t|0)==(H|0))return 1;return 0;break;case 3:if(!((i|0)==(U|0)&(t|0)==(H|0)))return 1;break;case 4:if((t|0)==(B|0))return 1;return 0;break;case 5:if((t|0)!=(H|0))return 1;break;case 6:if((t|0)!=(W|0))return 1;break;case 7:return 1;break;case 11:if((i|0)==(U|0))return 1;break;case 13:if((i|0)==(U|0)&(t|0)!=(H|0))return 1;break;case 14:if((i|0)==(U|0)&(t|0)!=(W|0))return 1;break;case 15:if((i|0)==(U|0))return 1;break}r(S|0);s();return 0}function xi(e,t){e=e|0;t=t|0;var i=0;var a=0;var n=1;var o=0;var c=0;var h=0;var u=0;var d=0;var f=0;var p=0;var l=0;var b=0;var v=0;var m=0;i=Tt[xt+be>>2]>>17&0x1F;a=(Tt[xt+be>>2]&0x06)>>1;if((i|0)==0|(a|0)==(P|0))return e|0;if((i|0)!=8){r(D|0);s()}o=e&0xFFF;c=e>>>22|0;m=(Tt[xt+fe>>2]|0)+(c<<2)|0;h=Et[It+m>>2]|0;u=h>>1&0xF;d=h&0x01;if((d|0)==0){Di(e,t);return-1}if((u|0)>=2){if(!(Ti(u,t)|0)){r(w|0);s()}return(h>>10|e>>12&0x3FF)<<12|o}o=e&0xFFF;f=(h&0xFFFFFC00)<<2;p=e>>12&0x3FF;m=(f|0)+(p<<2)|0;l=Et[It+m>>2]|0;b=l>>1&0xF;v=l&0x01;n=n-1|0;if((v|0)==0){Di(e,t);return-1}if(!(Ti(b,t)|0)){Di(e,t);return-1}return l>>10<<12|o|0}function Ei(e,t){e=e|0;t=t|0;var i=0;var a=0;e=e<<2;switch(e|0){case 0xC:Tt[xt+e>>2]=t;break;case 0x1E40:Tt[xt+e>>2]=t;p(t|0);break;case 0x1E44:Tt[xt+e>>2]=t;l(t|0);break;case 0x1E00:Tt[xt+e>>2]=t;m(t|0);break;case 0xD14:a=0x90000000>>0;jt[It+a>>0]=t|0;if((t|0)==0xA)jt[It+a>>0]=0xD;break;case 0x1E04:Tt[xt+e>>2]=t;k(t|0);break;case 0xC00:Tt[xt+e>>2]=t;Ci();break;case 0x3C00:break;case 0x3C04:Tt[xt+e>>2]=t;break;case 0x3C40:Tt[xt+e>>2]=t;break;case 0xC04:Tt[xt+e>>2]=t;break;case 0xD10:i=0x2|0x08;Tt[xt+e>>2]=Tt[xt+e>>2]&~i|t&i;break;case 0xC10:i=0x2|0x08|0x20;Tt[xt+e>>2]=Tt[xt+e>>2]&~i|t&i;break;case 0x504:case 0xD04:Tt[xt+e>>2]=t;break;case 0xD08:Tt[xt+e>>2]=t;break;case 0x3508:Tt[xt+e>>2]=t;break;case 0xD0C:Tt[xt+e>>2]=t;break;case 0x350C:Tt[xt+e>>2]=t;break;case 0x400:Tt[xt+ae>>2]=t;Tt[xt+be>>2]=Tt[xt+be>>2]&~0x1F039;Tt[xt+be>>2]=Tt[xt+be>>2]|Tt[xt+ae>>2]&0x01;Tt[xt+be>>2]=Tt[xt+be>>2]|Tt[xt+ae>>2]&0x08;Tt[xt+be>>2]=Tt[xt+be>>2]|Tt[xt+ae>>2]&0x10;Tt[xt+be>>2]=Tt[xt+be>>2]|Tt[xt+ae>>2]&0xF000;Tt[xt+be>>2]=Tt[xt+be>>2]|Tt[xt+ae>>2]&0x10000;break;case 0x404:Tt[xt+e>>2]=t;break;case 0x510:i=0x2;Tt[xt+Te>>2]=Tt[xt+Te>>2]&~i|t&i;break;case 0x410:i=0x2|0x20;Tt[xt+ke>>2]=Tt[xt+ke>>2]&~i|t&i;break;case 0xD00:Tt[xt+e>>2]=t;break;case 0x500:Tt[xt+e>>2]=t;break;case 0x2400:Tt[xt+e>>2]=t;break;case 0x3000:Lt=t;Tt[xt+e>>2]=t;break;case 0x1C04:case 0x3404:case 0x2804:Tt[xt+e>>2]=t;break;case 0x1D04:case 0x3604:case 0x2A04:Tt[xt+e>>2]=t;break;case 0x3004:case 0x2404:Tt[xt+e>>2]=t;break;case 0xC84:case 0x484:Tt[xt+Te>>2]=Tt[xt+Te>>2]&~32;Tt[xt+e>>2]=t;break;case 0xD84:case 0x600:Tt[xt+e>>2]=t;break;case 0x04:case 0x08:Tt[xt+e>>2]=t;break;default:Tt[xt+e>>2]=t;r(T|0);s();break}}function Ii(e){e=e|0;var t=0;t=(Tt[xt+be>>2]&0x06)>>1;e=e<<2|0;switch(e|0){case 0xC:return 0x0;break;case 0x1E40:return d()|0;break;case 0x1E44:return f()|0;break;case 0x1E00:return b()|0;break;case 0xD14:return 0x0;break;case 0x1E04:return v()|0;break;case 0xC00:return Tt[xt+e>>2]|0;break;case 0x3C00:return Tt[xt+e>>2]|0;break;case 0x3C04:return Tt[xt+e>>2]|0;break;case 0x3C40:return Tt[xt+e>>2]|0;break;case 0xC04:return Tt[xt+e>>2]|0;break;case 0xC10:return Tt[xt+e>>2]|0;break;case 0x504:case 0xD04:return Tt[xt+e>>2]|0;break;case 0xD08:return Tt[xt+e>>2]|0;break;case 0x3508:return Tt[xt+e>>2]|0;break;case 0xD0C:return Tt[xt+e>>2]|0;break;case 0x350C:return Tt[xt+e>>2]|0;break;case 0x400:Tt[xt+ae>>2]=0x00;Tt[xt+ae>>2]=Tt[xt+ae>>2]|Tt[xt+be>>2]&0x01;Tt[xt+ae>>2]=Tt[xt+ae>>2]|Tt[xt+be>>2]&0x08;Tt[xt+ae>>2]=Tt[xt+ae>>2]|Tt[xt+be>>2]&0x10;Tt[xt+ae>>2]=Tt[xt+ae>>2]|Tt[xt+be>>2]&0xF000;Tt[xt+ae>>2]=Tt[xt+ae>>2]|Tt[xt+be>>2]&0x10000;return Tt[xt+ae>>2]|0;break;case 0x404:return Tt[xt+e>>2]|0;break;case 0xD10:return Tt[xt+e>>2]|0;break;case 0x510:return Tt[xt+Te>>2]&(0x2|0x20)|0;break;case 0x410:return Tt[xt+ke>>2]&(0x2|0x20)|0;break;case 0xD00:return Tt[xt+e>>2]|0;break;case 0x500:return Tt[xt+e>>2]|0;break;case 0x2400:return Lt|0;break;case 0x3000:return Lt|0;break;case 0x1C04:case 0x3404:case 0x2804:return Lt|0;break;case 0x1D04:case 0x3604:case 0x2A04:return Lt>>32|0;break;case 0x3004:case 0x2404:return Lt|0;break;case 0xC84:case 0x484:return Tt[xt+e>>2]|0;break;case 0xD84:case 0x600:return Tt[xt+e>>2]|0;break;case 0x04:case 0x08:return Tt[xt+e>>2]|0;break;default:r(x|0);s();return Tt[xt+e>>2]|0;break}return 0}function ji(e,t,i){e=e|0;t=t|0;i=i|0;var r=0,s=0;var a=0,n=0;var o=0,c=0;var h=0;var u=0;var d=0;var f=0;if(e>>>0<32767)if(t>>>0<65536){r=g(e|0,t|0)|0;s=(r|0)<0?-1:0;if((i|0)==0)return r|0;return s|0}a=e&0xFFFF;n=e>>>16;o=t&0xFFFF;c=t>>>16;h=g(a|0,o|0)|0;u=(h>>>16)+(g(n|0,o|0)|0)|0;d=u>>>16;u=(u&0xFFFF)+(g(a|0,c|0)|0)|0;d=d+(u>>>16)|0;f=d>>>16;d=(d&0xFFFF)+(g(n|0,c|0)|0)|0;f=f+(d>>>16)|0;r=(u&0xFFFF)<<16|h&0xFFFF;s=(f&0xFFFF)<<16|d&0xFFFF;if((i|0)==0)return r|0;return s|0}function Ai(e,t,i){e=e|0;t=t|0;i=i|0;var r=0,s=0;var a=0;if((e|0)==0)return 0;if((t|0)==0)return 0;if((e|0)>=-32768)if((e|0)<=32767)if((t|0)>=-32768)if((t|0)<=32767){r=g(e|0,t|0)|0;s=(r|0)<0?-1:0;if((i|0)==0)return r|0;return s|0}a=(e|0)<0^(t|0)<0;e=R(e|0)|0;t=R(t|0)|0;r=ji(e,t,0)|0;s=ji(e,t,1)|0;if(a){r=~r;s=~s;r=r+1|0;if((r|0)==0)s=s+1|0}if((i|0)==0)return r|0;return s|0}function _i(e,t,i){e=e|0;t=t|0;i=i|0;var r=0,s=0;var a=0;if((e|0)==0)return 0;if((t|0)==0)return 0;if((e|0)>=-32768)if((e|0)<=32767)if(t>>>0<65536){r=g(e|0,t|0)|0;s=(r|0)<0?-1:0;if((i|0)==0)return r|0;return s|0}a=(e|0)<0;e=R(e|0)|0;r=ji(e,t,0)|0;s=ji(e,t,1)|0;if(a){r=~r;s=~s;r=r+1|0;if((r|0)==0)s=s+1|0}if((i|0)==0)return r|0;return s|0}function Ci(){Wt=0xFFFF0000;Ht=-1;Ot=0xFFFF0000;zt=-1;Gt=0xFFFF0000;Nt=-1;Vt=0xFFFF0000;Xt=-1;Qt=0xFFFF0000;Kt=-1;Yt=0xFFFF0000;Jt=-1;Zt=0xFFFF0000;$t=-1;ei=0xFFFF0000;ti=-1;ii=0xFFFF0000;ri=-1;si=0xFFFF0000;ai=-1;ni=0xFFFF0000;oi=-1;ci=0xFFFF0000;hi=-1;ui=0xFFFF0000;di=-1}function Mi(){var e=0,t=0,i=0;e=Tt[xt+be>>2]|0;t=e&0xFFF;i=(t<<2|P)<<1&0xFFF;Tt[xt+be>>2]=(e>>12<<12)+i&0xFFFEFFFF}function Li(){var e=0,t=0,i=0;e=Tt[xt+be>>2]|0;t=e&0xFFF;i=t>>>3|(q<<1|0x1)<<9;Tt[xt+be>>2]=(e>>12<<12)+i;Ci()}function qi(e,t){e=e|0;t=t|0;var i=0x00;var a=0x00;var n=0x00;var o=0x00;var c=0x00;var h=0x00;var u=0x0;var d=0x0;var f=0.0;var p=0.0;var l=0.0;var b=0;var v=0;var m=0;var k=0;var S=0;var w=0;var D=0;var T=64;for(;;){if((Ft|0)!=(Pt|0)){D=Et[Pt>>2]|0;Pt=Pt+4|0;switch(D&0x7F){case 0x03:v=(mt[(D>>13&0x7C)>>2]|0)+(D>>20)|0;switch(D>>12&0x7){case 0x00:if((Ot^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;Ot=v|0;zt=(m^v)&0xFFFFF000}m=zt^v;mt[(D>>5&0x7C)>>2]=jt[It+m>>0]<<24>>24;continue;case 0x01:if((Vt^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;Vt=v|0;Xt=(m^v)&0xFFFFF000}m=Xt^v;mt[(D>>5&0x7C)>>2]=At[It+m>>1]<<16>>16;continue;case 0x02:if(v&3){r(E|0);s()}if((Yt^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;Yt=v|0;Jt=(m^v)&0xFFFFF000}m=Jt^v;mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;continue;case 0x04:if((Gt^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;Gt=v|0;Nt=(m^v)&0xFFFFF000}m=Nt^v;mt[(D>>5&0x7C)>>2]=jt[It+m>>0]&0xFF;continue;case 0x05:if((Qt^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;Qt=v|0;Kt=(m^v)&0xFFFFF000}m=Kt^v;mt[(D>>5&0x7C)>>2]=At[It+m>>1]&0xFFFF;continue;default:r(j|0);s();break}continue;case 0x23:v=(mt[(D>>13&0x7C)>>2]|0)+(D>>25<<5|D>>7&0x1F)|0;switch(D>>12&0x7){case 0x00:if((Zt^v)&0xFFFFF000){m=xi(v|0,W)|0;if((m|0)==-1)continue;Zt=v|0;$t=(m^v)&0xFFFFF000}m=$t^v;jt[It+m>>0]=mt[(D>>18&0x7C)>>2]&0xFF;continue;case 0x01:if((ei^v)&0xFFFFF000){m=xi(v|0,W)|0;if((m|0)==-1)continue;ei=v|0;ti=(m^v)&0xFFFFF000}m=ti^v;At[It+m>>1]=mt[(D>>18&0x7C)>>2]&0xFFFF;continue;case 0x02:if(v&3){r(I|0);s()}if((ii^v)&0xFFFFF000){m=xi(v|0,W)|0;if((m|0)==-1)continue;ii=v|0;ri=(m^v)&0xFFFFF000}m=ri^v;Et[It+m>>2]=mt[(D>>18&0x7C)>>2]|0;continue;default:r(j|0);s();break}continue;case 0x13:u=mt[(D>>13&0x7C)>>2]|0;switch(D>>12&0x7){case 0x00:mt[(D>>5&0x7C)>>2]=u+(D>>20)|0;continue;case 0x02:if((u|0)<D>>20)mt[(D>>5&0x7C)>>2]=0x01;else mt[(D>>5&0x7C)>>2]=0x00;continue;case 0x03:if(u>>>0<D>>20>>>0)mt[(D>>5&0x7C)>>2]=0x01;else mt[(D>>5&0x7C)>>2]=0x00;continue;case 0x04:mt[(D>>5&0x7C)>>2]=u^D>>20;continue;case 0x06:mt[(D>>5&0x7C)>>2]=u|D>>20;continue;case 0x07:mt[(D>>5&0x7C)>>2]=u&D>>20;continue;case 0x01:mt[(D>>5&0x7C)>>2]=u<<(D>>20&0x1F);continue;case 0x05:if((D>>25&0x7F)==0x00){mt[(D>>5&0x7C)>>2]=u>>>(D>>20&0x1F)}else if((D>>25&0x7F)==0x20){mt[(D>>5&0x7C)>>2]=u>>(D>>20&0x1F)}continue;default:r(j|0);s();break}continue;case 0x33:switch(D>>25&0x7F){case 0x00:u=mt[(D>>13&0x7C)>>2]|0;d=mt[(D>>18&0x7C)>>2]|0;switch(D>>12&0x7){case 0x00:mt[(D>>5&0x7C)>>2]=u+d;continue;case 0x02:if((u|0)<(d|0))mt[(D>>5&0x7C)>>2]=0x01;else mt[(D>>5&0x7C)>>2]=0x00;continue;case 0x03:if(u>>>0<d>>>0)mt[(D>>5&0x7C)>>2]=0x01;else mt[(D>>5&0x7C)>>2]=0x00;continue;case 0x07:mt[(D>>5&0x7C)>>2]=u&d;continue;case 0x06:mt[(D>>5&0x7C)>>2]=u|d;continue;case 0x04:mt[(D>>5&0x7C)>>2]=u^d;continue;case 0x01:mt[(D>>5&0x7C)>>2]=u<<(d&0x1F);continue;case 0x05:mt[(D>>5&0x7C)>>2]=u>>>(d&0x1F);continue}continue;case 0x20:u=mt[(D>>13&0x7C)>>2]|0;d=mt[(D>>18&0x7C)>>2]|0;switch(D>>12&0x7){case 0x00:mt[(D>>5&0x7C)>>2]=u-d;continue;case 0x05:mt[(D>>5&0x7C)>>2]=u>>(d&0x1F);continue}continue;case 0x01:u=mt[(D>>13&0x7C)>>2]|0;d=mt[(D>>18&0x7C)>>2]|0;switch(D>>12&0x7){case 0x00:h=g(u|0,d|0)|0;mt[(D>>5&0x7C)>>2]=h;continue;case 0x01:h=Ai(u,d,1)|0;mt[(D>>5&0x7C)>>2]=h;continue;case 0x02:h=_i(u,d>>>0,1)|0;mt[(D>>5&0x7C)>>2]=h;continue;case 0x03:h=ji(u>>>0,d>>>0,1)|0;mt[(D>>5&0x7C)>>2]=h;continue;case 0x04:if((d|0)==0)o=-1;else o=(u|0)/(d|0)|0;mt[(D>>5&0x7C)>>2]=o;continue;case 0x05:if((d|0)==0)o=0xFFFFFFFF;else o=(u>>>0)/(d>>>0)|0;mt[(D>>5&0x7C)>>2]=o;continue;case 0x06:if((d|0)==0)c=u;else c=(u|0)%(d|0)|0;mt[(D>>5&0x7C)>>2]=c;continue;case 0x07:if((d|0)==0)c=u>>>0;else c=(u>>>0)%(d>>>0)|0;mt[(D>>5&0x7C)>>2]=c;continue}continue;default:r(j|0);s();break}continue;case 0x37:mt[(D>>5&0x7C)>>2]=D&0xFFFFF000;continue;case 0x17:_t=Ct+(Pt-Bt)|0;mt[(D>>5&0x7C)>>2]=_t+(D&0xFFFFF000)-4|0;continue;case 0x6F:_t=Ct+(Pt-Bt)|0;mt[(D>>5&0x7C)>>2]=_t;i=(D>>21&0x3FF|(D>>20&0x1)<<10|(D>>12&0xFF)<<11|D>>31<<19)<<1;_t=_t+i-4|0;Ft=Pt;Mt=1;mt[0]=0;continue;case 0x67:_t=Ct+(Pt-Bt)|0;u=mt[(D>>13&0x7C)>>2]|0;mt[(D>>5&0x7C)>>2]=_t;_t=u+(D>>20)&0xFFFFFFFE|0;Ft=Pt;Mt=1;mt[0]=0;continue;case 0x63:u=mt[(D>>13&0x7C)>>2]|0;d=mt[(D>>18&0x7C)>>2]|0;switch(D>>12&0x7){case 0x00:if((u|0)!=(d|0))continue;Ft=Pt;Mt=1;i=(D>>31<<11|(D>>25&0x3F)<<4|D>>8&0x0F|(D>>7&0x01)<<10)<<1;_t=Ct+(Pt-Bt)|0;_t=_t+i-4|0;continue;case 0x01:if((u|0)==(d|0))continue;Ft=Pt;Mt=1;i=(D>>31<<11|(D>>25&0x3F)<<4|D>>8&0x0F|(D>>7&0x01)<<10)<<1;_t=Ct+(Pt-Bt)|0;_t=_t+i-4|0;continue;case 0x04:if((u|0)>=(d|0))continue;Ft=Pt;Mt=1;i=(D>>31<<11|(D>>25&0x3F)<<4|D>>8&0x0F|(D>>7&0x01)<<10)<<1;_t=Ct+(Pt-Bt)|0;_t=_t+i-4|0;continue;case 0x05:if((u|0)<(d|0))continue;Ft=Pt;Mt=1;i=(D>>31<<11|(D>>25&0x3F)<<4|D>>8&0x0F|(D>>7&0x01)<<10)<<1;_t=Ct+(Pt-Bt)|0;_t=_t+i-4|0;continue;case 0x06:if(u>>>0>=d>>>0)continue;Ft=Pt;Mt=1;i=(D>>31<<11|(D>>25&0x3F)<<4|D>>8&0x0F|(D>>7&0x01)<<10)<<1;_t=Ct+(Pt-Bt)|0;_t=_t+i-4|0;continue;case 0x07:if(u>>>0<d>>>0)continue;Ft=Pt;Mt=1;i=(D>>31<<11|(D>>25&0x3F)<<4|D>>8&0x0F|(D>>7&0x01)<<10)<<1;_t=Ct+(Pt-Bt)|0;_t=_t+i-4|0;continue;default:r(j|0);s();break}continue;case 0x73:i=D>>>20;u=mt[(D>>13&0x7C)>>2]|0;switch(D>>12&0x7){case 0x01:mt[(D>>5&0x7C)>>2]=Ii(i)|0;Ei(i,u);mt[0]=0;continue;case 0x02:mt[(D>>5&0x7C)>>2]=Ii(i)|0;Ei(i,Ii(i)|0|u);mt[0]=0;continue;case 0x03:mt[(D>>5&0x7C)>>2]=Ii(i)|0;Ei(i,(Ii(i)|0)&~u);mt[0]=0;continue;case 0x05:mt[(D>>5&0x7C)>>2]=Ii(i)|0;a=D>>15&0x1F;if((a|0)!=0)Ei(i,a>>0);mt[0]=0;continue;case 0x06:mt[(D>>5&0x7C)>>2]=Ii(i)|0;a=D>>15&0x1F;if((a|0)!=0)Ei(i,Ii(i)|0|a>>0);mt[0]=0;continue;case 0x07:mt[(D>>5&0x7C)>>2]=Ii(i)|0;a=D>>15&0x1F;if((a|0)!=0)Ei(i,(Ii(i)|0)&~(a>>0));mt[0]=0;continue;case 0x00:k=(Tt[xt+be>>2]&0x06)>>1;Ft=Pt;switch(D>>20&0xFFF){case 0x00:_t=Ct+(Pt-Bt)|0;switch(k|0){case 0x00:wi(Y,_t-4|0);break;case 0x01:wi(J,_t-4|0);break;case 0x02:wi(Z,_t-4|0);s();break;case 0x03:wi($,_t-4|0);break;default:r(A|0);s();break}continue;case 0x001:_t=Ct+(Pt-Bt)|0;wi(X,_t-4|0);continue;case 0x100:k=(Tt[xt+be>>2]&0x06)>>1;_t=Ct+(Pt-Bt)|0;if((k|0)<(U|0)){r(C|0);s();break}Li();switch(k|0){case 0x01:_t=Tt[xt+ue>>2]|0;break;case 0x02:_t=Tt[xt+le>>2]|0;s();break;case 0x03:_t=Tt[xt+ye>>2]|0;break;default:r(_|0);s();break}Mt=1;Ci();continue;case 0x102:S=Tt[xt+ke>>2]&Tt[xt+Te>>2];continue;case 0x305:_t=Ct+(Pt-Bt)|0;if((k|0)!=(P|0)){r(M|0);s();break}Tt[xt+be>>2]=Tt[xt+be>>2]&~0x6|0x02;Tt[xt+Ne>>2]=Tt[xt+De>>2];Tt[xt+Ge>>2]=Tt[xt+we>>2];Tt[xt+ue>>2]=Tt[xt+ye>>2];_t=Tt[xt+ne>>2]|0;Ci();Mt=1;continue;case 0x101:Ci();continue;default:r(j|0);s();break}continue;default:r(j|0);s();break}continue;case 0x07:v=(mt[(D>>13&0x7C)>>2]|0)+(D>>20)|0;switch(D>>12&0x7){case 0x02:if((si^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)break;si=v|0;ai=(m^v)&0xFFFFF000}m=ai^v;mt[0]=Et[It+m>>2]|0;gt[Rt+((D>>7&0x1F)<<3)>>3]=+wt[0];mt[0]=0;continue;case 0x03:if((ni^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;ni=v|0;oi=(m^v)&0xFFFFF000}m=oi^v;yt[St+((D>>7&0x1F)<<3)+0>>2]=Et[It+m+0>>2]|0;yt[St+((D>>7&0x1F)<<3)+4>>2]=Et[It+m+4>>2]|0;continue;default:r(j|0);r(D|0);s();break}continue;case 0x27:v=(mt[(D>>13&0x7C)>>2]|0)+(D>>25<<5|D>>7&0x1F)|0;switch(D>>12&0x7){case 0x02:wt[0]=+gt[Rt+((D>>20&0x1F)<<3)>>3];if((ci^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;ci=v|0;hi=(m^v)&0xFFFFF000}m=hi^v;Et[It+m>>2]=mt[0]|0;mt[0]=0;continue;case 0x03:if((ui^v)&0xFFFFF000){m=xi(v|0,B)|0;if((m|0)==-1)continue;ui=v|0;di=(m^v)&0xFFFFF000}m=di^v;Et[It+m+0>>2]=yt[St+((D>>20&0x1F)<<3)+0>>2]|0;Et[It+m+4>>2]=yt[St+((D>>20&0x1F)<<3)+4>>2]|0;continue;default:r(j|0);r(D|0);s();break}continue;case 0x53:switch(D>>25&0x7F){case 0x00:case 0x01:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];gt[Rt+((D>>7&0x1F)<<3)>>3]=+f+ +p;continue;case 0x04:case 0x05:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];gt[Rt+((D>>7&0x1F)<<3)>>3]=+f-+p;continue;case 0x50:case 0x51:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];switch(D>>12&0x7){case 0x0:if(+f<=+p)mt[(D>>5&0x7C)>>2]=1;else mt[(D>>5&0x7C)>>2]=0;continue;case 0x1:if(+f<+p)mt[(D>>5&0x7C)>>2]=1;else mt[(D>>5&0x7C)>>2]=0;continue;case 0x2:if(+f==+p)mt[(D>>5&0x7C)>>2]=1;else mt[(D>>5&0x7C)>>2]=0;continue;default:r(j|0);r(D|0);s();break}continue;
case 0x20:case 0x21:gt[Rt+((D>>7&0x1F)<<3)>>3]=+gt[Rt+((D>>15&0x1F)<<3)>>3];continue;case 0x60:mt[(D>>5&0x7C)>>2]=~~y(+gt[Rt+((D>>15&0x1F)<<3)>>3]);continue;case 0x68:case 0x69:gt[Rt+((D>>7&0x1F)<<3)>>3]=+(mt[(D>>13&0x7C)>>2]|0);continue;case 0x08:case 0x09:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];gt[Rt+((D>>7&0x1F)<<3)>>3]=+ +f*+p;continue;case 0x10:case 0x11:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];switch(D>>12&7){case 0:gt[Rt+((D>>7&0x1F)<<3)>>3]=+p<+0?-+R(+f):+R(+f);continue;case 1:gt[Rt+((D>>7&0x1F)<<3)>>3]=+p<+0?+R(+f):-+R(+f);continue;case 2:if(+f*+p<+0){gt[Rt+((D>>7&0x1F)<<3)>>3]=-+R(+f)}else{gt[Rt+((D>>7&0x1F)<<3)>>3]=+ +R(+f)}continue;default:r(j|0);r(D|0);s()}continue;case 0x61:mt[(D>>5&0x7C)>>2]=~~+gt[Rt+((D>>15&0x1F)<<3)>>3];continue;case 0x78:u=mt[(D>>13&0x7C)>>2]|0;mt[0]=u;gt[Rt+((D>>7&0x1F)<<3)>>3]=+wt[0];mt[0]=0;continue;default:r(j|0);r(D|0);s();break}continue;case 0x43:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];l=+gt[Rt+((D>>27&0x1F)<<3)>>3];gt[Rt+((D>>7&0x1F)<<3)>>3]=f*p+l;continue;case 0x47:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];l=+gt[Rt+((D>>27&0x1F)<<3)>>3];gt[Rt+((D>>7&0x1F)<<3)>>3]=f*p-l;continue;case 0x4B:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];l=+gt[Rt+((D>>27&0x1F)<<3)>>3];gt[Rt+((D>>7&0x1F)<<3)>>3]=-(f*p+l);continue;case 0x4F:f=+gt[Rt+((D>>15&0x1F)<<3)>>3];p=+gt[Rt+((D>>20&0x1F)<<3)>>3];l=+gt[Rt+((D>>27&0x1F)<<3)>>3];gt[Rt+((D>>7&0x1F)<<3)>>3]=-(f*p-l);continue;case 0x2F:u=mt[(D>>13&0x7C)>>2]|0;d=mt[(D>>18&0x7C)>>2]|0;m=xi(u|0,B)|0;if((m|0)==-1)continue;switch(D>>27&0x1F){case 0x01:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;Et[It+m>>2]=d|0;m=xi(u|0,W)|0;if((m|0)==-1)continue;mt[0]=0;continue;case 0x00:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=(mt[(D>>5&0x7C)>>2]|0)+(d|0)|0;mt[0]=0;continue;case 0x04:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=(mt[(D>>5&0x7C)>>2]|0)^(d|0)|0;mt[0]=0;continue;case 0x0C:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=(mt[(D>>5&0x7C)>>2]|0)&(d|0)|0;mt[0]=0;continue;case 0x08:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=mt[(D>>5&0x7C)>>2]|0|(d|0)|0;mt[0]=0;continue;case 0x10:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;if(d>>0>mt[(D>>5&0x7C)>>2]>>0)mt[0]=mt[(D>>5&0x7C)>>2];else mt[0]=d;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=mt[0]|0;mt[0]=0;continue;case 0x14:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;if(d>>0<mt[(D>>5&0x7C)>>2]>>0)mt[0]=mt[(D>>5&0x7C)>>2];else mt[0]=d;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=mt[0]|0;mt[0]=0;continue;case 0x18:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;if(d>>>0>mt[(D>>5&0x7C)>>2]>>>0)mt[0]=mt[(D>>5&0x7C)>>2];else mt[0]=d;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=mt[0]|0;mt[0]=0;continue;case 0x1C:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;if(d>>>0<mt[(D>>5&0x7C)>>2]>>>0)mt[0]=mt[(D>>5&0x7C)>>2];else mt[0]=d;m=xi(u|0,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=mt[0]|0;mt[0]=0;continue;case 0x02:mt[(D>>5&0x7C)>>2]=Et[It+m>>2]|0;qt=u;Ut=mt[(D>>5&0x7C)>>2]|0;mt[0]=0;continue;case 0x03:if((u|0)!=(qt|0)){mt[(D>>5&0x7C)>>2]=0x01;continue}if((Et[It+m>>2]|0)!=(Ut|0)){mt[(D>>5&0x7C)>>2]=0x01;continue}mt[(D>>5&0x7C)>>2]=0x00;m=xi(u,W)|0;if((m|0)==-1)continue;Et[It+m>>2]=d|0;mt[0]=0;continue;default:r(L|0);s();break}continue;case 0x0F:continue;case 0x0:default:r(j|0);r(D|0);s();break}}else{if(!(Mt|0))_t=Ct+(Pt-Bt)|0;T=T-(Pt-Bt>>2)|0;if((T|0)<0){T=T+64|0;e=e-64|0;if((e|0)<0)return 0;b=(Tt[xt+ge>>2]|0)-Lt|0;b=b+((b|0)<0?0xFFFFFFFF:0x0)|0;Lt=Lt+t|0;if((b|0)<(t|0)){Tt[xt+Te>>2]=Tt[xt+Te>>2]|0x20}k=(Tt[xt+be>>2]&0x06)>>1;S=Tt[xt+ke>>2]&Tt[xt+Te>>2];w=Tt[xt+be>>2]&0x01;if((k|0)<3|(k|0)==3&(w|0)){if((S|0)&0x8){wi(G,_t);continue}else if(fi|0){wi(z,_t);fi=0;continue}}if((k|0)<1|(k|0)==1&(w|0)){if((S|0)&0x2){wi(G,_t);continue}else if((S|0)&0x20){wi(O,_t);continue}}}if((Wt^_t)&0xFFFFF000){Pt=xi(_t|0,H)|0;if((Pt|0)==-1){Pt=Ft;continue}Wt=_t;Ht=(Pt^_t)&0xFFFFF000}Pt=It+(Ht^_t)|0;Bt=Pt;Ct=_t;Ft=(Pt>>12)+1<<12;Mt=0}}return 0}return{Reset:li,Init:pi,InvalidateTLB:Ci,Step:qi,TranslateVM:xi,GetCSR:Ii,SetCSR:Ei,GetTimeToNextInterrupt:vi,ProgressTime:ki,GetTicks:mi,GetPC:bi,AnalyzeImage:gi,RaiseInterrupt:yi,ClearInterrupt:Si}}e("cjs!../messagehandler"),e("cjs!../utils"),e("cjs!./disassemble");i.exports=t}()}),define("cjs!jor1k/worker/riscv/index",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!../imul","cjs!./safecpu","cjs!./fastcpu"],function(e,t,i){!function(){function t(e,t,i,r,a){var u=null,d={DebugMessage:s.Debug,abort:s.Abort,imul:Math.imul||n,MathAbs:Math.abs,Read32:t.Read32Little.bind(t),Write32:t.Write32Little.bind(t),Read16:t.Read16Little.bind(t),Write16:t.Write16Little.bind(t),Read8:t.Read8Little.bind(t),Write8:t.Write8Little.bind(t),ReadDEVCMDToHost:i.ReadDEVCMDToHost.bind(i),ReadDEVCMDFromHost:i.ReadDEVCMDFromHost.bind(i),WriteDEVCMDToHost:i.WriteDEVCMDToHost.bind(i),WriteDEVCMDFromHost:i.WriteDEVCMDFromHost.bind(i),ReadToHost:i.ReadToHost.bind(i),ReadFromHost:i.ReadFromHost.bind(i),WriteToHost:i.WriteToHost.bind(i),WriteFromHost:i.WriteFromHost.bind(i)};if("safe"===e)return new o(t,i);if("asm"===e)return u=c(h,d,r),u.Init(),u;throw new Error("invalid CPU name:"+e)}function r(e,i,r,s,a){return this.cpu=t(e,i,r,s,a),this.name=e,this.ncores=a,this.ram=i,this.heap=s,this.littleendian=!0,this}var s=e("cjs!../messagehandler"),a=e("cjs!../utils"),n=e("cjs!../imul"),o=e("cjs!./safecpu"),c=e("cjs!./fastcpu"),h={Int32Array:Int32Array,Int8Array:Int8Array,Int16Array:Int16Array,Float32Array:Float32Array,Float64Array:Float64Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Math:Math};r.prototype.switchImplementation=function(e){},r.prototype.toString=function(){var e=new Int32Array(this.heap,0),t=new Uint32Array(this.heap,8192),i="";i+="Current state of the machine\n",i+="undefined"!=typeof this.cpu.pc?"PC: "+a.ToHex(this.cpu.pc)+"\n":"PC: "+a.ToHex(this.cpu.GetPC())+"\n";for(var r=0;r<32;r+=4)i+="   r"+(r+0)+": "+a.ToHex(e[r+0])+"   r"+(r+1)+": "+a.ToHex(e[r+1])+"   r"+(r+2)+": "+a.ToHex(e[r+2])+"   r"+(r+3)+": "+a.ToHex(e[r+3])+"\n";return i+="mstatus: "+a.ToBin(t[768])+"\n",i+="mcause: "+a.ToHex(t[834])+" mbadaddress: "+a.ToHex(t[835])+" mepc: "+a.ToHex(t[833])+"\n"};var u=["Reset","Step","RaiseInterrupt","Step","AnalyzeImage","GetTicks","GetTimeToNextInterrupt","ProgressTime","ClearInterrupt"];u.forEach(function(e){r.prototype[e]=function(){return this.cpu[e].apply(this.cpu,arguments)}}),i.exports=r}()}),define("cjs!jor1k/worker/riscv/syscalls",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.ram=e,this.elf8mem=[],this.file_descriptor_table=[],this.file_size=[],this.file_pointer=[],this.file_descriptor_offset=9,this.elf8mem_offset=0}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=56,n=57,o=67,c=64,h=80,u=93,d=2011;t.prototype.HandleSysCall=function(e){e=0|e;var t=(this.ram,this.ram.Read32(e));r.Debug("syscall_id "+t);var i=["pk","a.out"];switch(t){case a:for(var f,p=this.ram.Read32(e+16),l="",b=0;f=this.ram.Read8(p+b),0!=f;b++)l+=String.fromCharCode(f);var v=l;s.LoadBinaryResourceII("../riscv-sys/"+v,this.OnFileLoaded.bind(this),!1,function(e){throw e}),this.ram.Write32(e,this.file_descriptor_offset);break;case o:for(var m,k=this.ram.Read32(e+8),g=this.file_descriptor_table[k],R=this.ram.Read32(e+16),y=this.ram.Read32(e+24),S=this.ram.Read32(e+32),w=this.file_size[k],b=0;b<y&&!(b+S>=w);b++)m=this.elf8mem[g+b+S],this.ram.Write8(R+b,m);this.file_pointer[k]+=b,this.ram.Write32(e,b);break;case n:this.ram.Write32(e,0);break;case h:var k=this.ram.Read32(e+8),D=this.ram.Read32(e+16);this.ram.Write32(D,0),this.ram.Write32(D+4,0),this.ram.Write16(D+8,33279),this.ram.Write16(D+10,0),this.ram.Write16(D+12,0),this.ram.Write16(D+14,0),this.ram.Write32(D+16,0),this.ram.Write32(D+20,0),this.ram.Write32(D+24,this.file_size[k]),this.ram.Write16(D+28,512),this.ram.Write16(D+30,0),this.ram.Write32(D+32,0),this.ram.Write32(D+36,0),this.ram.Write32(D+40,0),this.ram.Write32(D+44,0),this.ram.Write32(D+48,0),this.ram.Write32(D+52,0),this.ram.Write32(D+56,0),this.ram.Write16(D+60,0),this.ram.Write16(D+62,0),this.ram.Write32(e,1);break;case c:for(var T=this.ram.Read32(e+24),b=0,x=this.ram.Read32(e+16);b<T;){var f=this.ram.Read8(x+b++);this.ram.Write8Little(50331648,f),10==f&&this.ram.Write8(50331648,13)}this.ram.Write32(e,b);break;case u:r.Debug("Program exited with sys_exit for inst at PC "+s.ToHex(this.pc)),r.Abort();break;case d:var E=this.ram.Read32(e+8),T=this.ram.Read32(e+16);this.ram.Write32(E,i.length);for(var I=8*i.length+32,b=0;b<i.length;b++)this.ram.Write32(E+8+8*b,E+I),I+=i[b].length+1;I=8*i.length+32;for(var b=0;b<i.length;b++){for(var j=0;j<i[b].length;j++)this.ram.Write8(E+I,i[b].charCodeAt(j)),I++;I++}this.ram.Write32(e,0);break;default:r.Debug("unkown SysCall "+s.ToHex(t)+" at PC "+s.ToHex(this.pc)),r.Abort()}},t.prototype.OnFileLoaded=function(e){var t=new Uint8Array(e),i=t.length;r.Debug("On File Loaded "+i);for(var s=0;s<i;s++)this.elf8mem[s+this.elf8mem_offset]=t[s];this.file_descriptor_table[++this.file_descriptor_offset]=this.elf8mem_offset,this.elf8mem_offset+=i,this.file_size[this.file_descriptor_offset]=i,this.file_pointer[this.file_descriptor_offset]=0},i.exports=t}()}),define("cjs!jor1k/worker/riscv/htif",["require","exports","module","cjs!../messagehandler","cjs!../utils","cjs!../bzip2","cjs!./syscalls"],function(e,t,i){!function(){function t(e,t,i){for(var r=0;r<e.length;r++)t.Write8(i+r,e.charCodeAt(r));t.Write8(i+e.length,0)}function r(e,t){this.ram=e,this.identify="bcd",this.Send=t,this.charqueue=[],this.readpresent=!0,this.Read=function(e){this.readpresent=!0,0!=this.charqueue.length&&(this.Send(1,0,this.charqueue.shift()),this.readpresent=!1)},this.Write=function(e){this.ram.Write8(50331648,e),10==e&&this.ram.Write8(50331648,13)},this.ReceiveChar=function(e){this.charqueue=this.charqueue.concat(e),this.readpresent&&(this.Send(1,0,this.charqueue.shift()),this.readpresent=!1)},n.Register("htif.term0.Transfer",this.ReceiveChar.bind(this))}function s(e,t){this.ram=e,this.Send=t,this.syscallHandler=new o(this.ram),this.identify="syscall_proxy",this.Read=function(e){e>>>0>256?this.syscallHandler.HandleSysCall(e):(this.ram.Write8(50331648,e+48),n.Debug("return value: "+e),n.Abort()),this.Send(0,0,1)}}function a(e,t){this.ram=e,this.irqdev=t,this.device=[],this.device.push(new s(this.ram,this.Send.bind(this))),this.device.push(new r(this.ram,this.Send.bind(this))),this.devid=0,this.cmd=0,this.reg_tohost=0,this.reg_devcmdfromhost=0,this.fromhostqueue=[]}var n=e("cjs!../messagehandler"),o=(e("cjs!../utils"),e("cjs!../bzip2"),e("cjs!./syscalls"));a.prototype.Send=function(e,t,i){this.fromhostqueue.push({devid:e,cmd:t,data:i}),1==this.fromhostqueue.length&&(this.reg_devcmdfromhost=this.fromhostqueue[0].devid<<24|this.fromhostqueue[0].cmd<<16),this.irqdev.RaiseInterrupt(1)},a.prototype.ReadDEVCMDToHost=function(){return 0},a.prototype.ReadToHost=function(){return 0},a.prototype.WriteDEVCMDToHost=function(e){this.devid=e>>>24,this.cmd=e>>16&255},a.prototype.WriteToHost=function(e){this.reg_tohost=0|e,this.HandleRequest()},a.prototype.ReadDEVCMDFromHost=function(){return 0!=this.fromhostqueue.length?this.reg_devcmdfromhost:0},a.prototype.ReadFromHost=function(){return 0!=this.fromhostqueue.length?this.fromhostqueue[0].data:0},a.prototype.WriteDEVCMDFromHost=function(e){this.reg_devcmdfromhost=e},a.prototype.WriteFromHost=function(e){0==e&&0==this.reg_devcmdfromhost&&(this.fromhostqueue.shift(),this.fromhostqueue.length>0?(this.reg_devcmdfromhost=this.fromhostqueue[0].devid<<24|this.fromhostqueue[0].cmd<<16,this.irqdev.RaiseInterrupt(1)):this.irqdev.ClearInterrupt(1))},a.prototype.IsQueueEmpty=function(){return 0==this.fromhostqueue.length},a.prototype.HandleRequest=function(){if(255==this.cmd){var e=this.reg_tohost;return this.device[this.devid]?t(this.device[this.devid].identify,this.ram,e):this.ram.Write8(e+0,0),this.Send(this.devid,255,1),void(this.reg_tohost=0)}return 0==this.cmd?(this.device[this.devid]?this.device[this.devid].Read(this.reg_tohost):(n.Debug("Error in HTIF: unknown read from device"),n.Abort()),void(this.reg_tohost=0)):1==this.cmd?(this.device[this.devid]?this.device[this.devid].Write(this.reg_tohost):(n.Debug("Error in HTIF: unknown write from device"),n.Abort()),void(this.reg_tohost=0)):(n.Debug("Error HTIF: unknown request"),void n.Abort())},i.exports=a}()}),define("cjs!jor1k/worker/dev/clint",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.csr=e,this.Reset()}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=3137;t.prototype.Reset=function(){this.regs=new Uint32Array(12288)},t.prototype.ReadReg32=function(e){return r.Debug("CLINT: unknown ReadReg32: "+s.ToHex(e)),r.Abort(),0},t.prototype.WriteReg32=function(e,t){e=0|e,this.regs[e>>2]=t,16384==e&&(this.csr[a]=t)},i.exports=t}()}),define("cjs!jor1k/worker/dev/plic",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.cpuirqhandler=e,this.Reset()}var r=(e("cjs!../messagehandler"),e("cjs!../utils"),9);t.prototype.Reset=function(){this.regs=new Uint32Array(12288),this.mask=0},t.prototype.ReadReg32=function(e){var t=0;if(2097156==e)for(t=0;t<32;t++)if(this.mask&1<<t)return t;return 0},t.prototype.WriteReg32=function(e,t){},t.prototype.RaiseInterrupt=function(e){e=0|e,1!=e&&(this.mask|=1<<e,this.cpuirqhandler.RaiseInterrupt(r,-1))},t.prototype.ClearInterrupt=function(e){e=0|e,this.mask&=~(1<<e),0==this.mask&&this.cpuirqhandler.ClearInterrupt(r,-1)},i.exports=t}()}),define("cjs!jor1k/worker/dev/rom",["require","exports","module","cjs!../utils","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.rom=e,this.buffer32view=new Int32Array(this.rom),this.buffer16view=new Int16Array(this.rom),this.buffer8view=new Int8Array(this.rom)}e("cjs!../utils"),e("cjs!../messagehandler");t.prototype.Reset=function(){},t.prototype.ReadReg32=function(e){return this.buffer32view[e>>2]},t.prototype.ReadReg16=function(e){return this.buffer16view[e>>1]},t.prototype.ReadReg8=function(e){return this.buffer8view[e]},i.exports=t}()}),define("cjs!jor1k/worker/init_riscv",["require","exports","module","cjs!./messagehandler","cjs!./utils","cjs!./riscv","cjs!./riscv/htif","cjs!./dev/clint","cjs!./dev/plic","cjs!./dev/rom","cjs!./dev/uart","cjs!./dev/virtio","cjs!./dev/virtio/9p","cjs!./dev/virtio/dummy","cjs!./dev/virtio/net"],function(e,t,i){!function(){function t(e,t){r.Debug("Init RISCV SoC");var i=e;e.htif=new n(e.ram,e),e.cpu=new a(t.cpu,e.ram,e.htif,e.heap,e.ncores),e.devices.push(e.cpu),e.rom=new ArrayBuffer(8192);var l=new Int32Array(e.rom),b=new Uint8Array(e.rom);l[1024]=2147480215,l[1025]=1431,l[1026]=29722003,l[1027]=4047512947,l[1028]=163943,l[1029]=0,l[1030]=0,l[1031]=0,r.Debug("Load DTB"),s.LoadBinaryResourceII(t.dtbURL,function(e){for(var t=new Uint8Array(e),i=0;i<t.length;i++)b[4128+i]=t[i]}.bind(this),!1,function(e){throw e}),e.virtionetdev=new p(e.ram),e.virtiodummydev=new f(e.ram),e.virtiodev1=new d(i,3,e.ram,e.virtio9pdev),e.virtiodev2=new d(i,4,e.ram,e.virtionetdev),e.virtiodev3=new d(i,5,e.ram,e.virtiodummydev),e.virtiodev4=new d(i,6,e.ram,e.virtiodummydev),e.virtiodev5=new d(i,7,e.ram,e.virtiodummydev),e.romdev=new h(e.rom),e.uartdev0=new u(0,i,2),e.clintdev=new o(e.csr),e.plicdev=new c(e.cpu),e.devices.push(e.romdev),e.devices.push(e.uartdev0),e.devices.push(e.clintdev),e.devices.push(e.plicdev),e.devices.push(e.virtiodev1),e.devices.push(e.virtiodev2),e.devices.push(e.virtiodev3),e.devices.push(e.virtiodev4),e.devices.push(e.virtiodev5),e.devices.push(e.virtio9pdev),e.ram.AddDevice(e.romdev,0,7),e.ram.AddDevice(e.uartdev0,50331648,8192),e.ram.AddDevice(e.clintdev,33554432,8192),e.ram.AddDevice(e.plicdev,67108864,15728640),e.ram.AddDevice(e.virtiodev1,536870912,8192),e.ram.AddDevice(e.virtiodev2,805306368,8192),e.ram.AddDevice(e.virtiodev3,1073741824,8192),e.ram.AddDevice(e.virtiodev4,1342177280,8192),e.ram.AddDevice(e.virtiodev5,1610612736,8192)}var r=e("cjs!./messagehandler"),s=e("cjs!./utils"),a=e("cjs!./riscv"),n=e("cjs!./riscv/htif"),o=e("cjs!./dev/clint"),c=e("cjs!./dev/plic"),h=e("cjs!./dev/rom"),u=e("cjs!./dev/uart"),d=e("cjs!./dev/virtio"),f=(e("cjs!./dev/virtio/9p"),e("cjs!./dev/virtio/dummy")),p=e("cjs!./dev/virtio/net");i.exports=t}()}),define("cjs!jor1k/worker/filesystem/tar",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(e){this.fs=e,this.tarbuffer=new Uint8Array(512),this.tarbufferofs=0,this.tarmode=0,this.tarfileoffset=0}function r(e,t,i){for(var r="",s=0;s<i;s++){if(e[t+s]<32)return r;r+=String.fromCharCode(e[t+s])}return r}function s(e,t,i,r){for(var s=Math.min(r,e.length+1),a=0;a<s;a++)t[i+a]=e.charCodeAt(a);t[i+s-1]=0}var a=e("cjs!../messagehandler"),n=61440,o=40960,c=32768,h=16384;t.prototype.Unpack=function(e){if(this.tarbuffer[this.tarbufferofs++]=e,512==this.tarbufferofs){if(this.tarbufferofs=0,1==this.tarmode){for(var t=Math.min(512,this.tarfilebuffer.length-this.tarfileoffset),i=0;i<t;i++)this.tarfilebuffer[this.tarfileoffset++]=this.tarbuffer[i];return void(this.tarfileoffset>=this.tarfilebuffer.length&&(this.tarmode=0))}var s=r(this.tarbuffer,257,5);if("ustar"==s){var a=String.fromCharCode(this.tarbuffer[156]),n=r(this.tarbuffer,0,100),u=n.split("/"),t=u.length;0==u[t-1].length&&u.pop();for(var t=u.length,d=0,f=-1,i=0;i<t-1;i++){if(f=this.fs.Search(d,u[i]),f==-1)throw"Error in untar: Could not find inode.";d=f}if(f=this.fs.Search(d,u[u.length-1]),f==-1&&!(f!=-1&&"5"!=a||f!=-1&&"5"==a)){var p=this.fs.CreateInode();p.name=u[t-1],p.parentid=d,p.mode=parseInt(r(this.tarbuffer,100,8),8),p.uid=parseInt(r(this.tarbuffer,108,8),8),p.gid=parseInt(r(this.tarbuffer,116,8),8),p.atime=parseInt(r(this.tarbuffer,136,12),8),p.ctime=this.atime,p.mtime=this.atime;var l=parseInt(r(this.tarbuffer,124,12),8);switch(a){case"5":p.mode|=h;break;case"0":if(p.mode|=c,p.data=new Uint8Array(l),p.size=l,0==l)break;this.tarmode=1,this.tarfileoffset=0,this.tarfilebuffer=p.data;break;case"1":p.mode|=o,p.symlink="/"+r(this.tarbuffer,157,100);break;case"2":p.mode|=o,p.symlink=r(this.tarbuffer,157,100)}this.fs.PushInode(p)}}}},t.prototype.Pack=function(e){a.Debug("tar: "+e);var t=this.fs.SearchPath(e).id;if(t==-1)return new Uint8Array(0);var i=[];this.fs.GetRecursiveList(t,i);for(var r=0,u=0;u<i.length;u++)switch(this.fs.inodes[i[u]].mode&n){case o:case h:r+=512;break;case c:r+=512,r+=this.fs.inodes[i[u]].size,511&r&&(r&=-512,r+=512)}a.Debug("tar: "+this.fs.GetFullPath(t)+" size: "+r+" files: "+i.length),a.Debug(i);for(var d=new Uint8Array(r),f=0,u=0;u<i.length;u++){var p=this.fs.inodes[i[u]],l=p.mode&n;if(l==o||l==h||l==c){switch(s("ustar  ",d,f+257,8),s(this.fs.GetFullPath(i[u]),d,f+0,100),s("00000000000",d,f+124,12),s((4095&p.mode).toString(8),d,f+100,8),s(p.uid.toString(8),d,f+108,8),s(p.gid.toString(8),d,f+116,8),s(p.mtime.toString(8),d,f+136,12),d[f+148+0]=32,d[f+148+1]=32,d[f+148+2]=32,d[f+148+3]=32,d[f+148+4]=32,d[f+148+5]=32,d[f+148+6]=32,d[f+148+7]=32,l){case o:d[f+156]="2".charCodeAt(0),s(p.symlink,d,f+157,100);break;case h:d[f+156]="5".charCodeAt(0);break;case c:d[f+156]="0".charCodeAt(0),s(p.size.toString(8),d,f+124,12)}for(var b=0,v=0;v<512;v++)b+=d[f+v];if(s(b.toString(8),d,f+148,7),f+=512,l==c){for(var v=0;v<p.size;v++)d[f++]=p.data[v];511&f&&(f&=-512,f+=512)}}}return d},i.exports=t}()}),define("cjs!jor1k/worker/filesystem/fsloader",["require","exports","module","cjs!../messagehandler","cjs!../utils"],function(e,t,i){!function(){function t(e){this.fs=e}var r=e("cjs!../messagehandler"),s=e("cjs!../utils"),a=511,n=40960,o=32768,c=16384,h=2;t.prototype.HandleDirContents=function(e,t){for(var i in e){var s=e[i],u=this.fs.Search(t,s.name);if(u!=-1){if(!s.path&&!s.size){s.child&&this.HandleDirContents(s.child,u);continue}r.Debug("Overwriting non-directory!")}var d=this.fs.CreateInode();if(d.name=s.name,d.uid=0|s.uid,d.gid=0|s.gid,d.parentid=t,this.fs.inodes[d.parentid].nlinks++,d.mode=parseInt(s.mode,8),s.path)d.mode=n|a,d.symlink=s.path,this.fs.PushInode(d);else if("undefined"==typeof s.size)d.mode|=c,d.updatedir=!0,d.nlinks=2,this.fs.PushInode(d),s.child&&this.HandleDirContents(s.child,u!=-1?u:this.fs.inodes.length-1);else{s.lazy&&(d.lazy=s.lazy),d.mode|=o;var f=this.fs.inodes.length;d.status=h,d.compressed=!!s.c,d.size=0|s.size,this.fs.PushInode(d);var p=this.sysrootdir+(s.src?s.src:this.fs.GetFullPath(f));d.url=p,(s.load||this.fs.CheckEarlyload(this.fs.GetFullPath(f)))&&this.fs.LoadFile(f)}}},t.prototype.OnJSONLoaded=function(e){var t=JSON.parse(e);this.sysrootdir=t.src,String(this.sysrootdir)!==this.sysrootdir&&r.Debug("No sysroot (src tag)!"),this.sysrootdir=this.fs.userinfo.path+this.sysrootdir+"/",this.HandleDirContents(t.fs,0),r.Debug("processed "+this.fs.inodes.length+" inodes"),this.fs.Check()},t.prototype.LoadJSON=function(e){r.Debug("Load filesystem information from "+e),s.LoadTextResource(e,this.OnJSONLoaded.bind(this),function(e){throw e})},i.exports=t}()}),define("cjs!jor1k/worker/filesystem/lazyUint8Array",["require","exports","module","cjs!../messagehandler"],function(e,t,i){!function(){function t(){return this.lengthKnown||this.CacheLength(),this._length}function r(){return this.lengthKnown||this.CacheLength(),this._chunkSize}function s(e,i){this.fallbackLength=i,this.overlay=[],this.url=e,this.lengthKnown=!1,this.chunks=[],Object.defineProperty(this,"length",{get:t}),Object.defineProperty(this,"chunkSize",{get:r})}var a=e("cjs!../messagehandler");s.prototype.Set=function(e,t){e>this.length-1||e<0||(this.overlay[e]=t)},s.prototype.Get=function(e){if(!(e>this.length-1||e<0)){if("undefined"!=typeof this.overlay[e])return this.overlay[e];var t=e%this.chunkSize,i=e/this.chunkSize|0;return this.GetChunk(i)[t]}},s.prototype.DoXHR=function(e,t){e>t&&a.Error("Invalid range ("+e+", "+t+") or no bytes requested!"),t>this._length-1&&a.Error("Only "+this._length+" bytes available! programmer error!");var i=new XMLHttpRequest;if(i.open("GET",this.url,!1),this._length!==this._chunkSize&&i.setRequestHeader("Range","bytes="+e+"-"+t),i.responseType="arraybuffer",i.send(null),!(i.status>=200&&i.status<300||304===i.status))throw new Error("Couldn't load "+this.url+". Status: "+i.status);return new Uint8Array(i.response||[])},s.prototype.GetChunk=function(e){var t=e*this._chunkSize,i=(e+1)*this._chunkSize-1;return i=Math.min(i,this._length-1),"undefined"==typeof this.chunks[e]&&(this.chunks[e]=this.DoXHR(t,i)),this.chunks[e]},s.prototype.CacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",this.url+"?"+(new Date).getTime(),!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+this.url+". Status: "+e.status);this._length=Number(e.getResponseHeader("Content-length")),0===this._length&&(a.Warning("Server doesn't return Content-length, even though we have a cache defeating URL query-string appended"),this._length=this.fallbackLength),this._chunkSize=1048576;var t,i=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t;i||(this._chunkSize=this._length),this.lengthKnown=!0},i.exports=s}()}),define("cjs!jor1k/worker/filesystem/filesystem",["require","exports","module","cjs!./tar","cjs!./fsloader","cjs!../utils","cjs!../bzip2","cjs!../dev/virtio/marshall","cjs!../../lib/utf8","cjs!../messagehandler","cjs!./lazyUint8Array"],function(e,t,i){!function(){function t(){this.inodes=[],this.events=[],this.qidnumber=0,this.filesinloadingqueue=0,this.OnLoaded=function(){},this.tar=new r(this),this.fsloader=new s(this),this.userinfo=[],this.watchFiles={},this.watchDirectories={},h.Register("LoadFilesystem",this.LoadFilesystem.bind(this)),h.Register("MergeFile",this.MergeFile.bind(this)),h.Register("DeleteNode",this.DeleteNode.bind(this)),h.Register("DeleteDirContents",this.RecursiveDelete.bind(this)),h.Register("CreateDirectory",function(e){var t=this.SearchPath(e);t.id==-1&&t.parentid!=-1&&this.CreateDirectory(t.name,t.parentid)}.bind(this)),h.Register("Rename",function(e){var t=this.SearchPath(e.oldPath),i=this.SearchPath(e.newPath);if(t.id!=-1&&i.parentid!=-1)if(i.id==-1){if((this.inodes[i.parentid].mode&d)!=b)return;this.Rename(this.inodes[t.id].parentid,this.inodes[t.id].name,i.parentid,i.name)}else this.Rename(this.inodes[t.id].parentid,this.inodes[t.id].name,this.inodes[i.id].parentid,this.inodes[i.id].name)}.bind(this)),h.Register("WatchFile",function(e){this.watchFiles[e.name]=!0}.bind(this)),h.Register("WatchDirectory",function(e){this.watchDirectories[e.name]=!0}.bind(this)),h.Register("ReadFile",function(e){h.Send("ReadFile",this.ReadFile.bind(this)(e))}.bind(this)),h.Register("tar",function(e){h.Send("tar",this.tar.Pack(e))}.bind(this)),h.Register("sync",function(e){h.Send("sync",this.tar.Pack(e))}.bind(this)),this.CreateDirectory("",-1)}var r=e("cjs!./tar"),s=e("cjs!./fsloader"),a=e("cjs!../utils"),n=e("cjs!../bzip2"),o=e("cjs!../dev/virtio/marshall"),c=e("cjs!../../lib/utf8"),h=e("cjs!../messagehandler"),u=e("cjs!./lazyUint8Array"),d=61440,f=49152,p=40960,l=32768,b=16384,v=-1,m=0,k=2,g=3,R=4;t.prototype.LoadFilesystem=function(e){this.userinfo=e,this.fsloader.LoadJSON(this.userinfo.basefsURL),this.OnLoaded=function(){this.userinfo.extendedfsURL&&this.fsloader.LoadJSON(this.userinfo.extendedfsURL);for(var e=0;e<this.userinfo.lazyloadimages.length;e++)this.LoadImage(this.userinfo.lazyloadimages[e])}.bind(this)},t.prototype.AddEvent=function(e,t){var i=this.GetInode(e);return i.status==m?void t():void this.events.push({id:e,OnEvent:t})},t.prototype.HandleEvent=function(e){0==this.filesinloadingqueue&&(this.OnLoaded(),this.OnLoaded=function(){});for(var t=[],i=0;i<this.events.length;i++)this.events[i].id==e?this.events[i].OnEvent():t.push(this.events[i]);this.events=t},t.prototype.LoadImage=function(e){e&&a.LoadBinaryResource(e,function(e){var t=new Uint8Array(e);0!=e.byteLength&&n.simple(t,this.tar.Unpack.bind(this.tar))}.bind(this),function(t){h.Debug("Error: Could not load "+e+". Skipping.")}.bind(this))},t.prototype.CheckEarlyload=function(e){for(var t=0;t<this.userinfo.earlyload.length;t++)if(this.userinfo.earlyload[t]==e)return!0;return!1},t.prototype.AppendDateHack=function(e){if("home/user/.profile"==this.GetFullPath(e)){var t=this.inodes[e],i=new Date,r='\ndate -s "'+i.getUTCFullYear()+"-"+(i.getUTCMonth()+1)+"-"+i.getUTCDate()+" "+i.getUTCHours()+":"+i.getUTCMinutes()+":"+i.getUTCSeconds()+'" &>/dev/null\n',s=t.size;this.ChangeSize(e,s+r.length);for(var a=0;a<r.length;a++)t.data[a+s]=r.charCodeAt(a)}},t.prototype.LoadFile=function(e){var t=this.inodes[e];if(t.status==k){if(t.status=g,this.filesinloadingqueue++,t.compressed){t.data=new Uint8Array(t.size);var i=function(e){return function(t){var i=this.GetInode(e),r=new Uint8Array(t),s=0;n.simple(r,function(e){i.data[s++]=e}.bind(this)),i.status=m,this.filesinloadingqueue--,this.HandleEvent(e)}.bind(this)}.bind(this)(e);return void a.LoadBinaryResource(t.url+".bz2",i,function(e){throw e})}if(t.lazy){h.Debug("Using lazy file for "+t.url),t.data=new u(t.url,t.size);var r=t.size;return t.size=t.data.length,r!=t.size&&h.Warning("Size wrong for lazy loaded file: "+t.name),t.status=m,this.filesinloadingqueue--,void this.HandleEvent(e)}var i=function(e){return function(t){var i=this.GetInode(e);i.data=new Uint8Array(t),i.size!=i.data.length&&h.Warning("Size wrong for uncompressed non-lazily loaded file: "+i.name),i.size=i.data.length,i.status=m,this.filesinloadingqueue--,this.HandleEvent(e)}.bind(this)}.bind(this)(e);a.LoadBinaryResource(t.url,i,function(e){throw e})}},t.prototype.PushInode=function(e){return e.parentid!=-1?(this.inodes.push(e),this.inodes[e.parentid].updatedir=!0,e.nextid=this.inodes[e.parentid].firstid,void(this.inodes[e.parentid].firstid=this.inodes.length-1)):0==this.inodes.length?void this.inodes.push(e):(h.Debug("Error in Filesystem: Pushed inode with name = "+e.name+" has no parent"),void h.Abort())},t.prototype.CreateInode=function(){return this.qidnumber++,{updatedir:!1,parentid:-1,firstid:-1,nextid:-1,status:0,name:"",size:0,uid:0,gid:0,ctime:Math.floor((new Date).getTime()/1e3),atime:Math.floor((new Date).getTime()/1e3),mtime:Math.floor((new Date).getTime()/1e3),major:0,minor:0,data:new Uint8Array(0),symlink:"",nlinks:1,mode:493,qid:{type:0,version:0,path:this.qidnumber},url:"",compressed:!1}},t.prototype.CreateDirectory=function(e,t){var i=this.CreateInode();return i.name=e,i.parentid=t,i.mode=511|b,i.updatedir=!0,i.nlinks=2,t>=0&&(i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,i.mode=511&this.inodes[t].mode|b,this.inodes[t].nlinks++),i.qid.type=b>>8,this.PushInode(i),this.NotifyListeners(this.inodes.length-1,"newdir"),this.inodes.length-1},t.prototype.CreateFile=function(e,t){var i=this.CreateInode();return i.name=e,i.parentid=t,i.uid=this.inodes[t].uid,i.gid=this.inodes[t].gid,this.inodes[t].nlinks++,i.qid.type=l>>8,i.mode=438&this.inodes[t].mode|l,this.PushInode(i),this.NotifyListeners(this.inodes.length-1,"newfile"),this.inodes.length-1},t.prototype.CreateNode=function(e,t,i,r){var s=this.CreateInode();return s.name=e,s.parentid=t,s.major=i,s.minor=r,s.uid=this.inodes[t].uid,s.gid=this.inodes[t].gid,this.inodes[t].nlinks++,s.qid.type=f>>8,s.mode=438&this.inodes[t].mode,this.PushInode(s),this.inodes.length-1},t.prototype.CreateSymlink=function(e,t,i){var r=this.CreateInode();return r.name=e,r.parentid=t,r.uid=this.inodes[t].uid,r.gid=this.inodes[t].gid,this.inodes[t].nlinks++,r.qid.type=p>>8,r.symlink=i,r.mode=p,this.PushInode(r),this.inodes.length-1},t.prototype.CreateTextFile=function(e,t,i){var r=this.CreateFile(e,t),s=this.inodes[r];s.data=new Uint8Array(i.length),s.size=i.length;for(var a in i)s.data[a]=i.charCodeAt(a);return r},t.prototype.OpenInode=function(e,t){var i=this.GetInode(e);return(i.mode&d)==b&&this.FillDirectory(e),i.status==k?(this.LoadFile(e),!1):(".profile"==i.name&&this.AppendDateHack(e),!0)},t.prototype.CloseInode=function(e){var t=this.GetInode(e);t.status==R&&(t.status=v,t.data=new Uint8Array(0),t.size=0)},t.prototype.Rename=function(e,t,i,r){if(e==i&&t==r)return!0;var s=this.Search(e,t),a=this.GetFullPath(s);if(s==-1)return!1;var n=this.Search(i,r);n!=-1&&this.Unlink(n);var o=s,c=this.inodes[o];if(this.inodes[c.parentid].firstid==o)this.inodes[c.parentid].firstid=c.nextid;else{var u=this.FindPreviousID(o);u==-1&&(h.Debug("Error in Filesystem: Cannot find previous id of inode"),h.Abort()),this.inodes[u].nextid=c.nextid}return c.parentid=i,c.name=r,c.qid.version++,c.nextid=this.inodes[c.parentid].firstid,this.inodes[c.parentid].firstid=o,this.inodes[e].updatedir=!0,this.inodes[i].updatedir=!0,this.inodes[e].nlinks--,this.inodes[i].nlinks++,this.NotifyListeners(o,"rename",{oldpath:a}),!0},t.prototype.Write=function(e,t,i,r){this.NotifyListeners(e,"write");var s=this.inodes[e];if(s.data.length<t+i?(this.ChangeSize(e,Math.floor(3*(t+i)/2)),s.size=t+i):s.size<t+i&&(s.size=t+i),s.data instanceof Uint8Array)for(var a=0;a<i;a++)s.data[t+a]=r();else for(var a=0;a<i;a++)s.data.Set(t+a,r())},t.prototype.Search=function(e,t){for(var i=this.inodes[e].firstid;i!=-1;){if(this.inodes[i].parentid!=e&&h.Debug("Error in Filesystem: Found inode with wrong parent id"),this.inodes[i].name==t)return i;i=this.inodes[i].nextid}return-1},t.prototype.GetTotalSize=function(){for(var e=0,t=0;t<this.inodes.length;t++)e+=this.inodes[t].data.length;return e},t.prototype.GetFullPath=function(e){for(var t="";0!=e;)t="/"+this.inodes[e].name+t,e=this.inodes[e].parentid;return t.substring(1)},t.prototype.FindPreviousID=function(e){for(var t=this.GetInode(e),i=this.inodes[t.parentid].firstid;i!=-1;){if(this.inodes[i].nextid==e)return i;i=this.inodes[i].nextid}return i},t.prototype.Unlink=function(e){if(this.NotifyListeners(e,"delete"),0==e)return!1;var t=this.GetInode(e);if((t.mode&d)==b&&t.firstid!=-1)return!1;if(this.inodes[t.parentid].firstid==e)this.inodes[t.parentid].firstid=t.nextid;else{var i=this.FindPreviousID(e);i==-1&&(h.Debug("Error in Filesystem: Cannot find previous id of inode"),
h.Abort()),this.inodes[i].nextid=t.nextid}return this.inodes[t.parentid].updatedir=!0,this.inodes[t.parentid].nlinks--,t.status=R,t.nextid=-1,t.firstid=-1,t.parentid=-1,t.nlinks--,!0},t.prototype.GetInode=function(e){return isNaN(e)?(h.Debug("Error in filesystem: id is not a number "),0):e<0||e>this.inodes.length?(h.Debug("Error in filesystem: Attempt to get inode with id "+e),0):this.inodes[e]},t.prototype.ChangeSize=function(e,t){var i=this.GetInode(e);if(t!=i.size){var r=new Uint8Array(t);i.size=t;for(var s=Math.min(i.data.length,i.size),a=0;a<s;a++)r[a]=this.ReadByte(i,a);i.data=r}},t.prototype.ReadByte=function(e,t){return e.data instanceof Uint8Array?e.data[t]:e.data.Get(t)},t.prototype.SearchPath=function(e){e=e.replace("//","/");var t=e.split("/"),i=t.length;0==t[i-1].length&&t.pop(),0==t[0].length&&t.shift();for(var i=t.length,r=0,s=-1,a=0;a<i;a++){if(s=this.Search(r,t[a]),s==-1)return a<i-1?{id:-1,parentid:-1,name:t[a]}:{id:-1,parentid:r,name:t[a]};r=s}return{id:s,parentid:r,name:t[a]}},t.prototype.GetRecursiveList=function(e,t){for(var i=this.inodes[e].firstid;i!=-1;)t.push(i),(this.inodes[i].mode&d)==b&&this.GetRecursiveList(i,t),i=this.inodes[i].nextid},t.prototype.ReadFile=function(e){var t=this.SearchPath(e.name);if(t.parentid!=-1)return t.id==-1?null:(e.data=this.inodes[t.id].data,e.size=this.inodes[t.id].size,e)},t.prototype.MergeFile=function(e){h.Debug("Merge path:"+e.name);var t=this.SearchPath(e.name);t.parentid!=-1&&(t.id==-1&&(t.id=this.CreateFile(t.name,t.parentid)),this.inodes[t.id].data=e.data,this.inodes[t.id].size=e.data.length,this.inodes[t.id].mtime=Math.floor((new Date).getTime()/1e3),this.inodes[t.id].atime=this.inodes[t.id].mtime,this.inodes[t.id].ctime=this.inodes[t.id].mtime)},t.prototype.RecursiveDelete=function(e){var t=[],i=this.SearchPath(e);if(i.parentid!=-1&&i.id!=-1){this.GetRecursiveList(i.id,t);for(var r=t.length-1;r>=0;r--)this.Unlink(t[r])}},t.prototype.DeleteNode=function(e){var t=this.SearchPath(e);if(t.parentid!=-1&&t.id!=-1){if((this.inodes[t.id].mode&d)==l)return void this.Unlink(t.id);if((this.inodes[t.id].mode&d)==b){var i=[];this.GetRecursiveList(t.id,i);for(var r=i.length-1;r>=0;r--)this.Unlink(i[r]);return void this.Unlink(t.id)}}},t.prototype.NotifyListeners=function(e,t,i){void 0==i&&(i={});var r=this.GetFullPath(e);1==this.watchFiles[r]&&"write"==t&&h.Send("WatchFileEvent",r);for(var s in this.watchDirectories)if(this.watchDirectories.hasOwnProperty(s)){var a=r.indexOf(s);0!=a&&1!=a||h.Send("WatchDirectoryEvent",{path:r,event:t,info:i})}},t.prototype.Check=function(){for(var e=1;e<this.inodes.length;e++)if(this.inodes[e].status!=v){this.inodes[e].nextid==e&&(h.Debug("Error in filesystem: file points to itself"),h.Abort());var t=this.GetInode(e);t.parentid<0&&h.Debug("Error in filesystem: negative parent id "+e);var i=t.name.length;0==i&&h.Debug("Error in filesystem: inode with no name and id "+e);for(var r in t.name){var s=t.name.charCodeAt(r);s<32&&h.Debug("Error in filesystem: Unallowed char in filename")}}},t.prototype.FillDirectory=function(e){var t=this.GetInode(e);if(t.updatedir){var i=t.parentid;i==-1&&(i=0);for(var r=0,s=this.inodes[e].firstid;s!=-1;)r+=24+c.UTF8Length(this.inodes[s].name),s=this.inodes[s].nextid;r+=25,r+=26,t.data=new Uint8Array(r),t.size=r;var a=0;a+=o.Marshall(["Q","d","b","s"],[this.inodes[e].qid,a+13+8+1+2+1,this.inodes[e].mode>>12,"."],t.data,a),a+=o.Marshall(["Q","d","b","s"],[this.inodes[i].qid,a+13+8+1+2+2,this.inodes[i].mode>>12,".."],t.data,a);for(var s=this.inodes[e].firstid;s!=-1;)a+=o.Marshall(["Q","d","b","s"],[this.inodes[s].qid,a+13+8+1+2+c.UTF8Length(this.inodes[s].name),this.inodes[s].mode>>12,this.inodes[s].name],t.data,a),s=this.inodes[s].nextid;t.updatedir=!1}},t.prototype.PrepareCAPs=function(e){var t=this.GetInode(e);return t.caps?t.caps.length:(t.caps=new Uint8Array(12),t.caps[0]=0,t.caps[1]=0,t.caps[2]=0,t.caps[3]=1,t.caps[4]=255,t.caps[5]=255,t.caps[6]=255,t.caps[7]=255,t.caps[8]=255,t.caps[9]=255,t.caps[10]=255,t.caps[11]=255,t.caps.length)},i.exports=t}()}),define("cjs!jor1k/worker/system",["require","exports","module","cjs!./messagehandler","cjs!./utils","cjs!./ram","cjs!./bzip2","cjs!./elf","cjs!./timer","cjs!./init_openrisc","cjs!./init_riscv","cjs!./filesystem/filesystem","cjs!./dev/uart","cjs!./dev/irq","cjs!./dev/timer","cjs!./dev/framebuffer","cjs!./dev/ethmac","cjs!./dev/ata","cjs!./dev/rtc","cjs!./dev/clint","cjs!./dev/plic","cjs!./dev/rom","cjs!./dev/touchscreen","cjs!./dev/keyboard","cjs!./dev/sound","cjs!./dev/virtio","cjs!./dev/virtio/9p","cjs!./dev/virtio/dummy","cjs!./dev/virtio/input","cjs!./dev/virtio/net","cjs!./dev/virtio/block","cjs!./dev/virtio/gpu","cjs!./dev/virtio/console"],function(e,t,i){!function(){function t(){r.Register("LoadAndStart",this.LoadImageAndStart.bind(this)),r.Register("execute",this.MainLoop.bind(this)),r.Register("Init",this.Init.bind(this)),r.Register("Reset",this.Reset.bind(this)),r.Register("PrintOnAbort",this.PrintState.bind(this)),r.Register("GetIPS",function(e){r.Send("GetIPS",this.ips),this.ips=0}.bind(this))}var r=e("cjs!./messagehandler"),s=e("cjs!./utils"),a=e("cjs!./ram"),n=e("cjs!./bzip2"),o=e("cjs!./elf"),c=e("cjs!./timer"),h=e("cjs!./init_openrisc"),u=e("cjs!./init_riscv"),d=e("cjs!./filesystem/filesystem"),f=(e("cjs!./dev/uart"),e("cjs!./dev/irq"),e("cjs!./dev/timer"),e("cjs!./dev/framebuffer"),e("cjs!./dev/ethmac"),e("cjs!./dev/ata"),e("cjs!./dev/rtc"),e("cjs!./dev/clint"),e("cjs!./dev/plic"),e("cjs!./dev/rom"),e("cjs!./dev/touchscreen"),e("cjs!./dev/keyboard"),e("cjs!./dev/sound"),e("cjs!./dev/virtio"),e("cjs!./dev/virtio/9p")),p=(e("cjs!./dev/virtio/dummy"),e("cjs!./dev/virtio/input"),e("cjs!./dev/virtio/net"),e("cjs!./dev/virtio/block"),e("cjs!./dev/virtio/gpu"),e("cjs!./dev/virtio/console"),1),l=2,b=3;t.prototype.Reset=function(){this.status=l;for(var e=0;e<this.devices.length;e++)this.devices[e].Reset();this.ips=0},t.prototype.Init=function(e){r.Debug("Init with following JSON structure: "),r.Debug(e),this.status=l,this.arch=e.arch,this.memorysize=e.memorysize,this.ncores=e.ncores,e.ncores||(e.ncores=1),this.ips=0,this.idletime=0,this.idlemaxwait=0,this.ticksperms=2e4,this.loopspersecond=100,this.timer=new c(this.ticksperms,this.loopspersecond),r.Debug("Allocate "+this.memorysize+" MB"),"or1k"==e.arch&&"dynamic"==e.cpu&&"undefined"!=typeof WebAssembly?(r.Debug("Use webassembly memory"),this.memory=new WebAssembly.Memory({initial:16*this.memorysize,maximum:16*this.memorysize}),this.heap=this.memory.buffer):this.heap=new ArrayBuffer(1048576*this.memorysize);var t=1048576;this.memorysize--,this.ram=new a(this.heap,t),this.memory&&(this.ram.memory=this.memory),this.csr=new Int32Array(this.heap,8192,4096),this.devices=[],this.filesystem=new d,this.virtio9pdev=new f(this.ram,this.filesystem);try{if("or1k"==e.arch)h(this,e);else{if("riscv"!=e.arch)throw"Architecture "+e.arch+" not supported";u(this,e)}}catch(i){r.Debug("Error: failed to create SoC: "+i),r.Abort()}},t.prototype.RaiseInterrupt=function(e){if("riscv"==this.arch?this.plicdev.RaiseInterrupt(e):this.cpu.RaiseInterrupt(e,-1),this.status==b){this.status=p,clearTimeout(this.idletimeouthandle);var t=(s.GetMilliseconds()-this.idletime)*this.ticksperms;t>this.idlemaxwait&&(t=this.idlemaxwait),this.cpu.ProgressTime(t),this.MainLoop()}},t.prototype.ClearInterrupt=function(e){"riscv"==this.arch?this.plicdev.ClearInterrupt(e):this.cpu.ClearInterrupt(e,-1)},t.prototype.RaiseSoftInterrupt=function(e,t){this.cpu.RaiseInterrupt(e,t)},t.prototype.ClearSoftInterrupt=function(e,t){this.cpu.ClearInterrupt(e,t)},t.prototype.PrintState=function(){this.uartdev0&&this.uartdev0.Step(),this.uartdev1&&this.uartdev1.Step(),r.Debug(this.cpu.toString())},t.prototype.SendStringToTerminal=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e.charCodeAt(i));r.Send("tty0",t)},t.prototype.LoadImageAndStart=function(e){this.SendStringToTerminal("\r================================================================================"),"string"==typeof e?(this.SendStringToTerminal("\r\nLoading kernel and hard and basic file system from web server. Please wait ...\r\n"),s.LoadBinaryResource(e,this.OnKernelLoaded.bind(this),function(e){throw e})):this.OnKernelLoaded(e)},t.prototype.PatchKernel=function(e){for(var t=this.ram.uint8mem,i=0;i<e;i++)109===t[i+0]&&101===t[i+1]&&109===t[i+2]&&111===t[i+3]&&114===t[i+4]&&121===t[i+5]&&0===t[i+6]&&1===t[i+24]&&240===t[i+25]&&0===t[i+26]&&0===t[i+27]&&(t[i+24]=1048576*this.memorysize>>24,t[i+25]=1048576*this.memorysize>>16,t[i+26]=0,t[i+27]=0)},t.prototype.OnKernelLoaded=function(e){this.SendStringToTerminal("Decompressing kernel...\r\n");var t=new Uint8Array(e),i=e.byteLength;if(o.IsELF(t))o.Extract(t,this.ram);else if(n.IsBZIP2(t)){if(i=0,n.simple(t,function(e){this.ram.uint8mem[i++]=e}.bind(this)),o.IsELF(this.ram.uint8mem)){for(var s=new Uint8Array(i),a=0;a<i;a++)s[a]=this.ram.uint8mem[a];o.Extract(s,this.ram)}}else for(var a=0;a<i;a++)this.ram.uint8mem[a]=t[a];0==this.cpu.littleendian&&(this.PatchKernel(i),this.ram.Little2Big(i)),r.Debug("Kernel loaded: "+i+" bytes"),this.SendStringToTerminal("Booting\r\n"),this.SendStringToTerminal("================================================================================"),this.cpu.Reset(),this.cpu.AnalyzeImage(),r.Debug("Starting emulation"),this.status=p,r.Send("execute",0)},t.prototype.HandleHalt=function(){var e=this.cpu.GetTimeToNextInterrupt();if(e!=-1){this.idlemaxwait=e;var t=Math.floor(e/this.ticksperms/this.timer.correction+.5);t<=1||(t>1e3&&r.Debug("Warning: idle for "+t+"ms"),this.idletime=s.GetMilliseconds(),this.status=b,this.idletimeouthandle=setTimeout(function(){this.status==b&&(this.status=p,this.cpu.ProgressTime(e),this.MainLoop())}.bind(this),t))}},t.prototype.MainLoop=function(){if(this.status==p){r.Send("execute",0);var e=this.cpu.Step(this.timer.instructionsperloop,this.timer.timercyclesperinstruction),t=this.timer.instructionsperloop-e;t++,this.ips+=t,this.uartdev0&&this.uartdev0.Step(),this.uartdev1&&this.uartdev1.Step();var i=!!e;this.timer.Update(t,this.cpu.GetTicks(),i),i&&this.HandleHalt()}},i.exports=t}()}),define("cjs!jor1k/worker/worker",["require","exports","module","cjs!./messagehandler","cjs!./system"],function(e,t,i){!function(){var t=e("cjs!./messagehandler"),i=e("cjs!./system");new i,t.Send("WorkerReady",0)}()}),require.config({baseUrl:".",paths:{text:"bower_modules/requirejs-text/text",cjs:"bower_modules/cjs/cjs","amd-loader":"bower_modules/amd-loader/amd-loader",bootstrap:"bower_modules/bootstrap-sass/assets/javascripts/bootstrap.min",modernizr:"bower_modules/modernizr/modernizr",crossroads:"bower_modules/crossroads/dist/crossroads.min",hasher:"bower_modules/hasher/dist/js/hasher.min",jquery:"bower_modules/jquery/dist/jquery",knockout:"bower_modules/knockout/dist/knockout","knockout-projections":"bower_modules/knockout-projections/dist/knockout-projections",signals:"bower_modules/js-signals/dist/signals.min",marked:"bower_modules/marked/marked.min",videojs:"bower_modules/videojs/dist/video.min","jquery-ui":"bower_modules/jquery-ui/jquery-ui.min","jquery-ui-layout":"bower_modules/jquery-ui-layout/source/stable/jquery.layout_and_plugins.min","jquery-fullscreen":"bower_modules/jquery-fullscreen/jquery.fullscreen-min","jquery-notific8":"bower_modules/jquery-notific8/dist/jquery.notific8.min",ace:"bower_modules/ace/lib/ace","typeahead-jquery":"bower_modules/typeahead.js/dist/typeahead.jquery.min",bloodhound:"bower_modules/typeahead.js/dist/bloodhound.min",FileSaver:"bower_modules/FileSaver/dist/FileSaver.min",Blob:"bower_modules/Blob/Blob","bootstrap-contextmenu":"bower_modules/bootstrap-contextmenu/bootstrap-contextmenu",bootbox:"bower_modules/bootbox.js/bootbox","github-api":"bower_modules/github-api/github",jszip:"bower_modules/jszip/dist/jszip.min","app/config":"app/config/config.dev","js-base64":"app/github-int/github-base64",xmlhttprequest:"app/github-int/github-xmlhttpreq"},shim:{"github-api":{},bootstrap:{deps:["jquery"]},"jquery-ui":{deps:["jquery"]},"jquery-ui-layout":{deps:["jquery","jquery-ui"]},"jquery-fullscreen":{deps:["jquery"]},"typeahead-jquery":{deps:["jquery"]},bootbox:{deps:["jquery"]},"bootstrap-contextmenu":{deps:["bootstrap"]}},packages:[{name:"jor1k",location:"bower_modules/jor1k/js"}],map:{"jor1k/worker/init_openrisc":{"jor1k/worker/or1k":"jor1k/worker/or1k/index","jor1k/worker/or1k/index":"jor1k/worker/or1k/index"},"jor1k/worker/init_riscv":{"jor1k/worker/riscv":"jor1k/worker/riscv/index","jor1k/worker/riscv/index":"jor1k/worker/riscv/index","jor1k/worker/riscv/htif":"jor1k/worker/riscv/htif"}}}),define("app/require.config",function(){}),require(["cjs!jor1k/worker/worker"]),require.config({bundles:{}});